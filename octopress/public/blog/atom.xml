<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[QGIS-PT]]></title>
  <link href="http://qgis.pt/atom.xml" rel="self"/>
  <link href="http://qgis.pt/"/>
  <updated>2017-02-02T21:30:12+00:00</updated>
  <id>http://qgis.pt/</id>
  <author>
    <name><![CDATA[Grupo de Utilizadores QGIS PT]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Processamento De Dados De RADAR (Sentinel-1) Com O QGIS]]></title>
    <link href="http://qgis.pt/2017/02/02/processamento-de-dados-de-radar-sentinel-1-com-o-qgis/"/>
    <updated>2017-02-02T21:25:06+00:00</updated>
    <id>http://qgis.pt/2017/02/02/processamento-de-dados-de-radar-sentinel-1-com-o-qgis</id>
    <content type="html"><![CDATA[<p>No último post do bog, fez-se uma breve introdução à Deteção Remota e apresentaram-se algumas das capacidades do QGIS no domínio do Processamento Digital de Imagens óticas, centradas na parte do espectro eletromagnético que inclui a luz visível e a radiação infravermelha.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/1_espectro_eletromagnetico.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/1_espectro_eletromagnetico.png" width="500"  alt="Figura 1 - Espectro Eletromagnético [0].">
    </a>
</div>

<p>Falou-se, no entanto, da existência de dispositivos que trabalham na região das microondas, designados RADAR (“RAdio Detection And Ranging”) que, quando produzem o sinal que ilumina o alvo, são designados sistemas de Deteção Remota ativos (Fonseca & Fernandes, 2004 [1]).</p>

<p>Assim, o RADAR é uma forma “ativa” de Deteção Remota, na medida em que o sinal é gerado artificialmente pelo sensor e enviado para a Terra através de feixes, sendo depois medida a energia refletida pelos alvos, que pode ser convertida para grandezas geofísicas.</p>

<p>Como estes sistemas não dependem da energia do Sol, podem ser usados de dia e de noite e sob quaisquer condições atmosféricas, pois conseguem penetrar a cobertura de nuvens. Requerem, no entanto, muito mais energia para funcionar, e os dados obtidos são mais difíceis de processar e interpretar.</p>

<p>Neste artigo, após um breve enquadramento teórico do tema, necessário à compreensão das características desta vertente da Deteção Remota, vão apresentar-se algumas das capacidades do QGIS para o processamento de dados de RADAR.</p>

<!-- more -->

<br />

<h3>Detetores de RADAR</h3>

<p>As microondas cobrem a banda do espectro dos comprimentos de onda de 1mm a 1m, sensivelmente. Os detetores nestas bandas operam através das nuvens, nevoeiro, poeiras, assim como, através da chuva, dado que estes comprimentos de onda não são afetados pela dispersão atmosférica, que perturba comprimentos de onda mais curtos. Esta característica permite aos detetores de RADAR a recolha de imagens sob quaisquer condições atmosféricas (Fonseca & Fernandes, 2004 [1]).</p>

<p>A Deteção Remota passiva, na banda das microondas, baseia-se no facto de todos os objetos emitirem energia nessa região, embora em muito pequena quantidade. A energia emitida naturalmente pelos objetos está relacionada com a sua temperatura e teor de humidade. A Deteção Remota passiva nestas bandas tem aplicações meteorológicas, hidrológicas e oceanográficas.</p>

<p>Os detetores ativos de microondas são os mais utilizados, fornecendo, eles próprios, a fonte de radiação que ilumina os alvos na superfície terrestre.</p>

<p>A forma mais comum de detetores ativos de microondas é o RADAR (“RAdio Detection And Ranging”). O detetor emite um sinal de microondas em direção ao alvo e deteta a porção reenviada do sinal original. A intensidade do sinal reenviado é medida para discriminar entre diferentes alvos e o intervalo de tempo entre os sinais transmitido e refletido determina a distância ao alvo (Fonseca & Fernandes, 2004 [1]).</p>

<br />

<h3>Aquisição da Informação</h3>

<p>O sistema RADAR consiste essencialmente num transmissor, um recetor, uma antena e um sistema eletrónico de processamento e registo de dados. O emissor gera curtos impulsos sucessivos de microondas, a intervalos regulares, que são focados pela antena num feixe. O feixe RADAR ilumina a superfície terrestre obliquamente (Figura 2).</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/2_sistemas_radar.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/2_sistemas_radar.png" width="500"  alt="Figura 2 - Sistemas de obtenção de imagens do sistema RADAR (Sabins, 1997 [2]).">
    </a>
</div>

<p>A antena recebe uma porção da energia transmitida, retrorefletida por vários objetos. Medindo o intervalo de tempo entre o envio de um impulso e a receção do eco retrorefletido por diferentes alvos, pode determinar-se a sua distância relativamente ao sistema de RADAR e, consequentemente, a sua posição. Conforme a plataforma se desloca na sua trajetória, registando e processando os sinais retrorefletidos, é constituída uma imagem bidimensional da superfície (Fonseca & Fernandes, 2004 [1])</p>

<p>A intensidade do sinal recebido pela antena varia em função do tipo de mecanismo de retroreflexão, e este depende do tipo de superfície que recebe o sinal proveniente da antena. Uma superfície suave, como um corpo de água, dá origem a um sinal de baixa intensidade; uma superfície rugosa dá origem a um sinal de intensidade média a elevada; uma esquina ou canto (comum em zonas urbanas) dá origem a um sinal de intensidade muito elevada; a vegetação dá origem a sinais de intensidade média, com grande variabilidade espacial (Fonseca & Fernandes, 2004 [1]). A figura 3 mostra estes mecanismos de retroreflexão e a 4 apresenta a resposta do terreno a um impulso de RADAR.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/3_mecanismos_retroflexao.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/3_mecanismos_retroflexao.png" width="500"  alt="Figura 3 - Mecanismos de retroreflexão em função da superfície refletora (Fonseca & Fernandes, 2004 [1]).">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/4_resposta_do_terreno.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/4_resposta_do_terreno.png" width="500"  alt="Figura 4 - Resposta do terreno a um impulso de microondas (Sabins, 1997 [2]).">
    </a>
</div>

<p>A zona do espectro eletromagnético correspondente às microondas é muito larga, existindo várias bandas às quais foram atribuídas letras de código (Figura 5): bandas Ka, K, Ku, bandas muito curtas, usadas nos radares mais antigos; banda X, usada em sistemas militares de reconhecimento e cartografia; banda C, utilizada em sistemas como o AirSAR da NASA, o ERS-1, ERS-2 e o Sentinel-1 da ESA e o RADARSAT da Agência Espacial Canadiana; bandas S e L, utilizadas no satélite SEASAT da NASA, no JERS-1 da Agência Espacial Japonesa e no ALMAZ, da ex-URSS; a banda P, banda larga utilizada nos sistemas experimentais aerotransportados da NASA (Fonseca & Fernandes, 2004 [1]).</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/5_comprimentos_onda_radar.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/5_comprimentos_onda_radar.png" width="500"  alt="Figura 5 - Comprimentos de onda e frequências usados em Deteção Remota por RADAR. Entre parêntesis estão os comprimentos de onda mais comuns (Sabins, 1997 [2]).">
    </a>
</div>

<p>A polarização do sinal (orientação do campo elétrico) é importante no processo de aquisição de imagens de RADAR. Os impulsos de energia eletromagnética vibram em todas as direções. Em Deteção Remota por RADAR filtram-se os impulsos para que a vibração seja feita num único plano.</p>

<p>Os sistemas mais antigos apenas permitiam um modo de polarização (ou vertical ou horizontal). No entanto, para aumentar o conteúdo de informação dos sinais de RADAR, os novos sistemas possuem polarização múltipla, como é o caso do Sentinel-1 da ESA, havendo então 4 combinações possíveis de radiação transmitida e refletida:</p>

<ul>
    <li>HH: para transmissão horizontal e receção horizontal;</li>
    <li>VV: para transmissão vertical e receção vertical;</li>
    <li>HV: para transmissão horizontal e receção vertical (cruzada);</li>
    <li>VH: para transmissão vertical e receção horizontal (cruzada).</li>
</ul>

<br />

<h3>Geometria de Aquisição das Imagens de RADAR</h3>

<p>A geometria de aquisição é muito diferente da dos sistemas óticos.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/6_geometria_aquisicao_radar.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/6_geometria_aquisicao_radar.png" width="500"  alt="Figura 6 - Geometria de aquisição da imagem de RADAR (Fonseca & Fernandes, 2004 [1]).">
    </a>
</div>

<p>A plataforma progride na trajetória de voo, com o nadir a definir o traço da órbita na superfície terrestre. O feixe de microondas é transmitido obliquamente, num ângulo perpendicular à direção de voo, iluminando uma faixa afastada do nadir. O alcance refere-se à dimensão, à largura da faixa, perpendicular à direção de voo, enquanto o azimute se refere à dimensão, ao longo da faixa, paralela à direção de voo. A porção da faixa da imagem mais próxima do traço nadiral da trajetória da plataforma designa-se por alcance próximo, enquanto que a parte da faixa mais afastada do nadir se designa por alcance afastado (Fonseca & Fernandes, 2004 [1]).</p>

<p>Esta geometria de aquisição provoca distorções geométricas nas imagens. Essas distorções estão relacionadas com a geometria lateral de aquisição das imagens e com o facto do RADAR ser, essencialmente, um dispositivo de medição de distâncias. Existem, portanto, diversos tipos de distorções (de escala, encurtamento, cavalgamento, efeitos de sombra, etc.) que é necessário corrigir em fase de processamento das imagens.</p>

<br />

<h3>Vantagens do RADAR face aos Detetores Óticos</h3>

<p>O RADAR apresenta algumas características que o colocam em destaque sobre os detetores óticos, das quais se destacam:</p>

<ul>
    <li>a interação da radiação com as nuvens ou radiação é reduzida ou mesmo anulada, devido ao elevado comprimento de onda;</li>
    <li>enquanto a refletância nas imagens obtidas por detetores óticos está relacionada com as propriedades moleculares dos objetos, as imagens de RADAR dependem de características macroscópicas da superfície como: rugosidade, propriedades dielétricas (relacionadas com o teor de humidade), características geométricas das áreas urbanas, características estruturais da vegetação, orientação das estruturas relativamente à direção de visão do feixe, etc.;</li>
    <li>as imagens têm uma boa resolução espacial, são obtidas sob quaisquer condições meteorológicas, de dia ou de noite e independentemente das condições de iluminação; estas características fazem com que as imagens de RADAR sejam de grande utilidade para a monitorização da superfície em áreas de grande nebulosidade.</li>
</ul>

<p>Das aplicações mais comuns, destacam-se:</p>

<ul>
    <li>altimetria e topografia;</li>
    <li>agricultura: monitorização de culturas, estimativas de produção, etc.;</li>
    <li>controlo de tráfego e poluição marítimas (por exemplo, derrames de petróleo);</li>
    <li>aplicações militares;</li>
    <li>produção de cartas temáticas: geológicas, ocupação do solo, etc.;</li>
    <li>cartografia de zonas húmidas;</li>
    <li>monitorização de calotes polares, deteção e monitorização de icebergs, etc.;</li>
    <li>monitorização de cheias e inundações;</li>
    <li>monitorização da deformação da crusta terrestre, decorrente de fenómenos tectónicos (atividade sísmica e vulcânica) ou outros (subsidência causada pela sobre-exploração de georrecursos).</li>
</ul>

<br />

<h3>Aquisição de Dados Radar</h3>

<p>Tal como já foi referido para os dados óticos, o acesso a imagens de RADAR não esteve, durante muitos anos, ao alcance de todos, atendendo aos elevados custos e à necessidade de possuir conhecimentos e software específico para o seu processamento e interpretação.</p>

<p>Contudo, numa parceria entre a Comissão Europeia e a Agência Espacial Europeia (ESA), foi planeado e desenvolvido o programa Copernicus, do qual fazem parte 6 missões Sentinel, disponibilizando imagens de diversas regiões do espectro eletromagnético, de forma aberta e gratuita, sem interrupções ou hiatos. Dessas 6 missões, destaca-se a missão Sentinel-1, constituída por uma constelação de 2 satélites (Sentinel-1A e Sentinel-1B) que usam sensores de RADAR, com o objetivo de monitorizar a Terra - topografia, geologia, catástrofes naturais e humanitárias, calotes polares e sua dinâmica, floresta, água e solos, etc.</p>

<p>Assim, a missão Sentinel-1 constitui-se como uma fonte de dados de RADAR, na banda C da região das microondas, fornecendo informação sob quaisquer condições atmosféricas, de dia e de noite, com cobertura global e alta resolução espacial e temporal.</p>

<p>O Sentinel-1 poderá obter imagens, a intervalos regulares, de todas as massas continentais e oceânicas, zonas costeiras, assim como das rotas de navegação marítima, em águas europeias, com elevada resolução.</p>

<p>O Radar de Abertura Sintética (Synthetic Aperture Radar - SAR) do Sentinel-1 permite adquirir dados em 4 modos distintos (mantém-se a descrição original, para evitar erros de tradução) <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/overview" target="_blank">[3]</a>:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/7_modos_aquisicao_sentinel-1.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/7_modos_aquisicao_sentinel-1.jpg" width="500"  alt="Figura 7 - Modos de aquisição do Sentinel-1 [4].">
    </a>
</div>

<ul>
    <li><i>Stripmap (SM) - (80 km Swath, 5 x 5 m spatial resolution) - A standard SAR stripmap imaging mode where the ground swath is illuminated with a continuous sequence of pulses, while the antenna beam is pointing to a fixed azimuth and elevation angle;</i></li>
    <li><i>Interferometric Wide swath (IW) - (250 km Swath, 5x20 m spatial resolution) - Data is acquired in three swaths using the Terrain Observation with Progressive Scanning SAR (TOPSAR) imaging technique. In IW mode, bursts are synchronised from pass to pass to ensure the alignment of interferometric pairs. IW is Sentinel-1&#8217;s primary operational mode over land;</i></li>
    <li><i>Extra Wide swath (EW) - (400 km Swath, 25 x 100 m spatial resolution) - Data is acquired in five swaths using the TOPSAR imaging technique. EW mode provides very large swath coverage at the expense of spatial resolution;</i></li>
    <li><i>Wave (WV) - (20 km x 20 km, 5 x 20 m spatial resolution) - Data is acquired in small stripmap scenes called &#8220;vignettes&#8221;, situated at regular intervals of 100 km along track. The vignettes are acquired by alternating, acquiring one vignette at a near range incidence angle while the next vignette is acquired at a far range incidence angle. WV is Sentinel-1&#8217;s operational mode over open ocean.</i></li>
</ul>

<p>Os produtos Sentinel-1, distribuídos pela ESA, possuem os seguintes níveis de processamento:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/8_niveis_processamento_sentinel_1.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/8_niveis_processamento_sentinel_1.png" width="500"  alt="Figura 8 - Níveis de processamento das imagens Sentinel-1, em função do modo de aquisição [5].">
    </a>
</div>

<ul>
    <li><i>Level-0 Raw data (for specific usage);</i></li>
    <li><i>Level-1 Processed Single Look Complex (SLC) data comprising complex imagery with amplitude and phase (systematic distribution limited to specific relevant areas);</i></li>
    <li><i>Level-1 Ground Range Detected (GRD) Geo-referenced data with multi-looked intensity only (systematically distributed);</i></li>
    <li><i>Level-2 Ocean (OCN) data for retrieved geophysical parameters of the ocean (systematically distributed).</i></li>
</ul>

<p>As imagens Sentinel-1 possuem um nome com o seguinte significado:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/9_nome_imagens_sentinel_1.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/9_nome_imagens_sentinel_1.jpg" width="500"  alt="Figura 9 - Nome das imagens Sentinel-1 [6].">
    </a>
</div>

<p>Informações mais detalhadas acerca deste satélite e dos seus produtos podem ser obtidas no Sentinel-1 User Handbook <a href="https://sentinels.copernicus.eu/documents/247904/685163/Sentinel-1_User_Handbook" target="_blank">[7]</a>.</p>

<br />

<h3>Processamento de Dados RADAR no QGIS</h3>

<p>O QGIS, por si só, não possui ferramentas capazes de processar dados de RADAR, visto tratar-se de uma área específica da Deteção Remota. No entanto, à semelhança do que acontece em muitas outras vertentes, aproveitando a facilidade e as capacidades de integração disponibilizadas pelo QGIS, são já vários os plugins que permitem processar dados de RADAR, a partir da sua interface. De entre eles, destaca-se o plugin <b>Processing BEAM and SNAP algorithm Provider</b>, desenvolvido no âmbito do Water Observation Information System (WOIS), Projeto TIGER-NET, financiado pela Agência Espacial Europeia como parte de uma iniciativa mais alargada denominada TIGER, que pretende promover a utilização de dados de Observação da Terra para a melhoria da gestão integrada da água em África (Integrated Water Resources Management - IWRM) <a href="http://www.tiger-net.org" target="_blank">[8]</a>.</p>

<p>Este plugin faz a ponte entre o QGIS e o SNAP, um software Open Source de Processamento Digital de Imagem, da Agência Espacial Europeia. A integração processa-se de forma análoga ao GRASS, ao SAGA ou ao OTB, isto é, depois de instalado, as ferramentas surgem integradas no Processing, o que permite, não só, correr as ferramentas do SNAP a partir do QGIS, como também corrê-las em lote (batch) e inclusive integrar essas ferramentas em modelos gráficos, que depois são executados de modo sequencial, tal como acontece com os modelos do Processing.</p>

<br />

<h3>Preparação do Ambiente</h3>

<p>Antes de se instalar o plugin propriamente dito, começam por se instalar os pré-requisitos, neste caso, a última versão do SNAP (atualmente, a v5.0). Na página oficial do software <a href="http://step.esa.int/main/download" target="_blank">[9]</a>, existem binários para os diferentes Sistemas Operativos (Linux, Windows e MacOS). O ideal, caso não haja limitações de espaço em disco, será optar pelo instalador completo “All Toolboxes”, que inclui as ferramentas para processamento de dados das 3 missões Sentinel, e ainda das missões SMOS e PROBA-V.</p>

<p>Durante a instalação do SNAP, vai ser necessário ativar a interface snappy (SNAP Python module), que irá permitir “chamar” o SNAP a partir do QGIS e correr os algoritmos de forma transparente para o utilizador. Nota: no caso de estarem a instalar a versão de 64 bits do SNAP no Windows, a versão do Python terá também de ser de 64 bits. Caso não tenham essa versão instalada, basta descarregar o instalador adequado a partir do site do Python <a href="https://www.python.org/downloads/windows" target="_blank">[10]</a>.</p>

<p>Depois disso, basta correr o assistente de instalação do SNAP.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/10_snap_instalation_wizard.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/10_snap_instalation_wizard.png" width="500"  alt="Figura 10 - Assistente de instalação do SNAP.">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/11_snap_snappy.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/11_snap_snappy.png" width="500"  alt="Figura 11 - Ativação da interface snappy (SNAP Python module).">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/12_snap_instalation_wizard.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/12_snap_instalation_wizard.png" width="500"  alt="Figura 12 - Conclusão da instalação do SNAP.">
    </a>
</div>

<p>Ao executar o SNAP pela primeira vez, é feita uma verificação de atualizações disponíveis, devendo essas atualizações ser instaladas e o SNAP reiniciado.</p>

<p>Após a instalação do SNAP e da configuração da interface snappy, passa-se à instalação do plugin <b>Processing BEAM and SNAP algorithm Provider</b>, já no QGIS. O processo é muito simples, através do Gestor de Plugins do QGIS:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/13_gestor_plugins_qgis.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/13_gestor_plugins_qgis.png" width="500"  alt="Figura 13 - Instalação, a partir do Gestor de Plugins do QGIS.">
    </a>
</div>

<p>Por fim, no menu Processing -> Options -> Providers -> SNAP Toolbox, ativa-se a ferramenta, as diversas toolboxes e define-se o caminho para a pasta de instalação do SNAP, que irá depender do Sistema Operativo utilizado e da opção selecionada no assistente de instalação.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/14_plugin_config_linux_win.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/14_plugin_config_linux_win.png" width="500"  alt="Figura 14 - Exemplos de configuração do plugin em Linux e Windows.">
    </a>
</div>

<p>Para concluir, deve reiniciar-se o QGIS, ficando o plugin pronto a utilizar.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/15_plugin_processing.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/15_plugin_processing.png" width="500"  alt="Figura 15 - Processing com as ferramentas do plugin Processing BEAM and SNAP algorithm Provider.">
    </a>
</div>

<br />

<h3>Cartografia [quase-automática] de Cheias e Inundações no QGIS, com imagens Sentinel-1</h3>

<p>A cartografia de cheias e inundações é, como se viu anteriormente, uma entre as inúmeras aplicações das imagens de RADAR. Para exemplificar o uso e processamento de imagens Sentinel-1 no QGIS, irá fazer-se uma avaliação das áreas inundadas no Baixo Mondego, em Janeiro de 2016 <a href="http://sicnoticias.sapo.pt/pais/2016-01-12-Baixo-Mondego-recupera-das-cheias-duas-estradas-continuam-cortadas" target="_blank">[11]</a>.</p>

<p>A imagem seguinte apresenta um esquema da metodologia que irá ser utilizada para a identificação das áreas inundadas.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/16_modelo_cheias_inundacoes.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/16_modelo_cheias_inundacoes.png" width="500"  alt="Figura 16 - Modelo de processamento de imagens Sentinel-1, para a cartografia de áreas inundadas.">
    </a>
</div>

<p>A metodologia apresentada baseia-se na deteção de alterações (change detection) entre duas imagens do mesmo local, uma obtida antes do evento hidrológico e outra, de preferência, no pico do evento, embora isso esteja dependente da data de passagem do satélite. Esta metodologia segue, genericamente, os procedimentos descritos no âmbito do Projeto RASOR <a href="https://github.com/altamiraInformation/rasor-floodMap" target="_blank">[12]</a>.</p>

<p>De forma resumida, o modelo executa os seguintes processos:</p>

<ol>
	<li>Importação das duas imagens;</li>
    <li>Aplicação das informações precisas referentes à posição e velocidade do satélite, no momento da aquisição;</li>
    <li>Calibração Radiométrica dos pixéis das imagens, na polarização VV;</li>
    <li>Recorte das imagens pela área de interesse, escolhida pelo utilizador (este passo é importante, atendendo à dimensão das imagens, permitindo reduzir o tempo de processamento e limitando as operações à região de interesse);</li>
    <li>Co-registo das imagens, que inclui a união das bandas de polarização VV de cada uma das imagens e, através de uma correlação cruzada, o alinhamento preciso dos pixéis, assegurando que representam exatamente a mesma parcela de terreno, para que possam ser, posteriormente, comparados;</li>
    <li>Correção geométrica (ortorretificação) das imagens, utilizando um Modelo Digital do Elevação, para passar da geometria do satélite para a geometria do terreno;</li>
    <li>Cálculo de índices entre as duas imagens corrigidas (diferença, rácio, imagem pós-evento);</li>
    <li>Criação de uma imagem compósita (RGB), com as bandas resultantes do cálculo dos índices anteriores;</li>
    <li>Aplicação de um filtro para redução do ruído característico das imagens de RADAR, denominado speckle;</li>
    <li>Aplicação de uma classificação não-supervisionada (análise de clusters), que vai originar uma imagem com 5 classes, uma das quais representará as áreas inundadas.</li>
</ol>

<p>Como o modelo é de uso global, foi submetido para integração <a href="https://github.com/DHI-GRAS/processing_gpf/pull/35" target="_blank">[13]</a> no plugin, encontrando-se já à disposição, por defeito, de quem instala o <b>Processing BEAM and SNAP algorithm Provider</b> no QGIS.</p>

<br />

<h3>Download das imagens Sentinel-1</h3>

<p>As imagens das diversas missões Sentinel encontram-se à disposição dos utilizadores no site “Sentinels Scientific Data Hub” <a href="https://scihub.copernicus.eu/dhus/#/home" target="_blank">[14]</a>, bastando, para o efeito, fazer o registo (sign up) gratuito na plataforma.</p>

<p>De seguida, faz-se o login e pesquisam-se os dados pretendidos, selecionando a área de interesse, o intervalo de datas e o tipo de imagens.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/17_pesquisa_imagens_sentinel.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/17_pesquisa_imagens_sentinel.png" width="500"  alt="Figura 17 - Pesquisa de imagens Sentinel-1, entre dezembro de 2015 e janeiro de 2016, na região do Baixo Mondego.">
    </a>
</div>

<p>Para o presente exercício, devem descarregar-se as seguintes imagens:</p>

<pre>
    Mission: Sentinel-1; Instrument: SAR-C; Sensing Date: 2015-12-09T18:27:03.639Z; Size: 1.62 GB
    Nome: S1A_IW_GRDH_1SDV_20151209T182703_20151209T182728_008969_00CDAE_7536
</pre>

<pre>
    Mission: Sentinel-1; Instrument: SAR-C; Sensing Date: 2016-01-14T18:27:02.129Z; Size: 1.62 GB
    Nome: S1A_IW_GRDH_1SDV_20160114T182702_20160114T182727_009494_00DC7A_23D5
</pre>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/18_download_imagem_sentinel_1.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/18_download_imagem_sentinel_1.png" width="500"  alt="Figura 18 - Download da imagem Sentinel-1 de 2016-01-14.">
    </a>
</div>

<p>Os dados são descarregados em ficheiros comprimidos, do tipo ZIP, e assim devem ser mantidos.</p>

<br />

<h3>Execução do Modelo</h3>

<p>Coloca-se o QGIS com o Sistema de Referência EPSG: 4326 (WGS84 Lat/Lon): Project Properties -> CRS -> Enable ‘on the fly’ CRS transformation (OTF). Esta configuração é importante para, mais adiante, passar as coordenadas da área de interesse ao modelo, neste sistema de referência.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/19_configuracao_crs_wgs84.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/19_configuracao_crs_wgs84.png" width="500"  alt="Figura 19 - Configuração do CRS do QGIS em EPSG: 4326.">
    </a>
</div>

<p>De seguida, por exemplo com o plugin QuickMapServices, carrega-se uma imagem de base, como a Google Hybrid, centra-se a zona entre a Figueira da Foz e a Barragem da Aguieira no canvas e executa-se o modelo S1 Flood Analysis, disponível em Processing -> SNAP Toolbox -> S1 Graphs.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/20_interface_modelo_flood_analysis.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/20_interface_modelo_flood_analysis.png" width="500"  alt="Figura 20 - Interface do modelo S1 Flood Analysis.">
    </a>
</div>

<p>No modelo, apenas é necessário indicar o caminho para os ficheiros ZIP, da imagem de referência (slave) e da imagem do pico da inundação (master), no caso concreto, a imagem de 9 de dezembro de 2015 e a imagem de 14 de janeiro de 2016, respetivamente.</p>

<p>A data das imagens é muito importante, uma vez que vai ser necessário substituir [manualmente], nas fórmulas</p>

<ul>
    <li>Difference:
        <pre>
            log(abs(Sigma0_VV_mst_ddMMMYYYY – Sigma0_VV_slv1_ddMMMYYYY))
        </pre>
    </li>
    <li>Flood:
        <pre>
            Sigma0_VV_mst_ddMMMYYYY
        </pre>
    </li>
    <li>Ratio:
        <pre>
            log(abs(Sigma0_VV_mst_ddMMMYYYY / Sigma0_VV_slv1_ddMMMYYYY))
        </pre>
    </li>
</ul>

<p>os ddMMMYYYY, pelas datas das imagens de referência (slv1) e do pico da inundação (mst), na forma DiaMêsAno, sendo o dia indicado sempre com dois algarismos e o mês pelas três primeiras letras do mês, em inglês (Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec).</p>

<p>Assim, atendendo a que as imagens são de 9 de dezembro de 2015 e de 14 de janeiro de 2016, as fórmulas ficarão:</p>

<ul>
    <li>Difference:
        <pre>
            log(abs(Sigma0_VV_mst_14Jan2016 – Sigma0_VV_slv1_09Dec2015))
        </pre>
    </li>
    <li>Flood:
        <pre>
            Sigma0_VV_mst_14Jan2016
        </pre>
    </li>
    <li>Ratio:
        <pre>
            log(abs(Sigma0_VV_mst_14Jan2016 / Sigma0_VV_slv1_09Dec2015))
        </pre>
    </li>
</ul>

<p>No campo Extent coloca-se a extensão geográfica (xmin, xmax, ymin, ymax) da área a avaliar, em WGS84 Lat/Lon. Esta poderá ser obtida a partir do canvas do QGIS (Select extent on canvas).</p>

<p>Dependendo da capacidade do computador, a seleção de áreas muito grandes poderá conduzir a tempos de processamento de várias horas ou, em caso de máquinas com pouca memória RAM, a crashes do modelo. Por esse motivo, deve começar por se testar o modelo em áreas geográficas pequenas e utilizar um computador com, pelo menos, 8 GB de RAM.</p>

<p>Finalmente, escolhe-se a pasta e o nome para o ficheiro de saída, e executa-se o modelo.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/21_interface_modelo_flood_analysis_2.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/21_interface_modelo_flood_analysis_2.png" width="500"  alt="Figura 21 - Opções do modelo.">
    </a>
</div>

<p>No exemplo, selecionou-se uma área entre a Figueira da Foz e a Barragem da Aguieira, num computador com 16 GB de RAM e um processador i7-6700HQ, tendo o processamento demorado cerca de 1h15.</p>

<p>O resultado da execução do modelo é um raster inteiro de 8 bits, com o 255 como valor null, e com 5 classes (0, 1, 2, 3 e 4), cada uma agregando pixéis com características semelhantes. Nas propriedades desse raster, no QGIS, coloca-se o 255 como valor transparente (Additional no data value), e aplica-se uma simbologia &#8216;Singleband pseudocolor&#8217;, para distinguir os pixéis das diferentes classes.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/22_resultado_do_modelo.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/22_resultado_do_modelo.png" width="500"  alt="Figura 22 - Resultado do modelo.">
    </a>
</div>

<p>Facilmente se percebe que as zonas a vermelho (classe 4) serão zonas inundadas, enquanto a azul (classe 2) surgem os leitos habituais dos cursos de água, assim como alguns corpos de água interiores.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/23_resultado_do_modelo.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/23_resultado_do_modelo.png" width="500"  alt="Figura 23 - Resultado do modelo.">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/24_resultado_do_modelo.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/24_resultado_do_modelo.png" width="500"  alt="Figura 24 - Resultado do modelo.">
    </a>
</div>

<p>Pode reduzir-se o número de pixéis isolados, correndo a ferramenta GDAL Sieve <a href="http://www.gdal.org/gdal_sieve.html" target="_blank">[15]</a>, disponível no Processing.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/25_resultado_do_modelo_gdal_sieve.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/25_resultado_do_modelo_gdal_sieve.png" width="500"  alt="Figura 25 - Resultado do modelo, após uma remoção de pixéis isolados.">
    </a>
</div>

<p>Por fim, com a ferramenta r.to.vect <a href="https://grass.osgeo.org/grass72/manuals/r.to.vect.html" target="_blank">[16]</a> do GRASS (também disponível no Processing), pode converter-se o ficheiro raster para vetor. Após mais uma limpeza de polígonos espúrios, o resultado foi o seguinte:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/26_resultado_final.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/26_resultado_final.jpg" width="500"  alt="Figura 26 - Resultado final do modelo, em formato vetorial.">
    </a>
</div>

<br />

<h3>Conclusão</h3>

<p>Seria interessante dispor de dados de campo relativos à inundação de Janeiro de 2016, para validar os resultados obtidos e para determinar o nível de confiança do modelo utilizado.</p>

<p>Os parâmetros do modelo podem ser facilmente alterados, para testar valores distintos, assim como, em vez da classificação não-supervisionada, poderá ser usada uma classificação supervisionada, com áreas de treino em locais que se saiba terem sido afetados pelo evento. Desse modo, os resultados poderão ser mais precisos.</p>

<p>De qualquer forma, o modelo apresentado permite, muito rapidamente, conhecer o território e as populações afetadas por cheias e inundações, podendo ainda, com o Modelo Digital de Elevação, conhecer a altura da coluna de água em cada um dos locais, sendo então possível confrontar esses dados de observação por satélite, com caráter sinóptico, com os resultados de modelos hidrológicos e hidráulicos, e com dados de observação de campo.</p>

<p>Assim, pode constatar-se que o QGIS, sendo um software completo de Sistemas de Informação Geográfica, que inclui soluções Desktop, Web (Servidor e Cliente) e de campo <a href="http://www.qgis.org/en/site/about/features.html" target="_blank">[17]</a>, na vertente Desktop vai bem mais além das capacidades habituais de um software de SIG, possuindo valências avançadas no domínio do Processamento Digital de Imagens de sensores óticos e de sensores de RADAR, num ambiente bastante amigável e integrando todo esse ecossistema que pode ser utilizado em simultâneo, o que permite, por exemplo, no final deste processamento, disponibilizar rapidamente um serviço WMS com as áreas potencialmente inundadas, para utilização por outros serviços e entidades, em diferentes dispositivos, em gabinete ou no campo.</p>

<br />

<h3>Referências</h3>

<p>[0] <a href="http://www.seos-project.eu/modules/remotesensing/remotesensing-c01-p01.html" target="_blank">http://www.seos-project.eu/modules/remotesensing/remotesensing-c01-p01.html</a></p>
<p>[1] Fonseca, Ana & Fernandes, João - Detecção Remota. 1a Edição. Lisboa: Lidel, 2004.</p>
<p>[2] Sabins, Floyd F. - Remote Sensing - Principles and Interpretation. 3rd Edition. New York: W. H. Freeman and Company, 1997.</p>
<p>[3] <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/overview" target="_blank">https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/overview</a></p>
<p>[4] <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/acquisition-modes" target="_blank">https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/acquisition-modes</a></p>
<p>[5] <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/product-types-processing-levels" target="_blank">https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/product-types-processing-levels</a></p>
<p>[6] <a href="https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/naming-conventions" target="_blank">https://sentinels.copernicus.eu/web/sentinel/user-guides/sentinel-1-sar/naming-conventions</a></p>
<p>[7] <a href="https://sentinels.copernicus.eu/documents/247904/685163/Sentinel-1_User_Handbook" target="_blank">https://sentinels.copernicus.eu/documents/247904/685163/Sentinel-1_User_Handbook</a></p>
<p>[8] <a href="http://www.tiger-net.org" target="_blank">http://www.tiger-net.org</a></p>
<p>[9] <a href="http://step.esa.int/main/download" target="_blank">http://step.esa.int/main/download</a></p>
<p>[10] <a href="https://www.python.org/downloads/windows" target="_blank">https://www.python.org/downloads/windows</a></p>
<p>[11] <a href="http://sicnoticias.sapo.pt/pais/2016-01-12-Baixo-Mondego-recupera-das-cheias-duas-estradas-continuam-cortadas" target="_blank">http://sicnoticias.sapo.pt/pais/2016-01-12-Baixo-Mondego-recupera-das-cheias-duas-estradas-continuam-cortadas</a></p>
<p>[12] <a href="https://github.com/altamiraInformation/rasor-floodMap" target="_blank">https://github.com/altamiraInformation/rasor-floodMap</a></p>
<p>[13] <a href="https://github.com/DHI-GRAS/processing_gpf/pull/35" target="_blank">https://github.com/DHI-GRAS/processing_gpf/pull/35</a></p>
<p>[14] <a href="https://scihub.copernicus.eu/dhus/#/home" target="_blank">https://scihub.copernicus.eu/dhus/#/home</a></p>
<p>[15] <a href="http://www.gdal.org/gdal_sieve.html" target="_blank">http://www.gdal.org/gdal_sieve.html</a></p>
<p>[16] <a href="https://grass.osgeo.org/grass72/manuals/r.to.vect.html" target="_blank">https://grass.osgeo.org/grass72/manuals/r.to.vect.html</a></p>
<p>[17] <a href="http://www.qgis.org/en/site/about/features.html" target="_blank">http://www.qgis.org/en/site/about/features.html</a></p>
<p>Venâncio, Pedro - Aplicação de Dados de Detecção Remota à Cartografia Geológica da Região de Viseu. Coimbra: Departamento de Ciências da Terra da Faculdade de Ciências e Tecnologia da Universidade de Coimbra, 2007. Estágio Científico da Licenciatura em Geologia.</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/8248cd896ad16c4ef53d0558d8e62a18></img>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Deteção Remota Com O QGIS]]></title>
    <link href="http://qgis.pt/2016/12/14/detecao-remota-com-o-qgis/"/>
    <updated>2016-12-14T17:44:01+00:00</updated>
    <id>http://qgis.pt/2016/12/14/detecao-remota-com-o-qgis</id>
    <content type="html"><![CDATA[<p>A Deteção Remota é considerada uma técnica de observação de objetos e fenómenos à distância. Deste modo, pode dizer-se que os primeiros dados de Deteção Remota foram obtidos em 1858/59, em Paris, na forma de fotografia aérea, por Gaspard-Félix Tournachon, a partir de um balão de ar quente <a href="https://pt.wikipedia.org/wiki/F%C3%A9lix_Nadar" target="_blank">[0]</a>.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/1_scp_foto_aerea_paris.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/1_scp_foto_aerea_paris.png" width="500"  alt="Figura 1 - Vista aérea de Paris, 1859 [1]">
    </a>
</div>

<p>Mais tarde, em 1906, foi captada uma outra imagem aérea emblemática, por George Lawrence, mostrando a devastação provocada pelo sismo de São Francisco. Esta foi obtida por uma câmara com cerca de 22Kg, instalada a bordo de um papagaio <a href="http://www.bigmapblog.com/2012/kite-photo-of-post-quake-san-francisco-1906" target="_blank">[2]</a>.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/2_scp_sismo_sao_francisco.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/2_scp_sismo_sao_francisco.jpg" width="500"  alt="Figura 2 - Vista aérea da devastação provocada pelo terramoto de 1906 [3]">
    </a>
</div>

<p>Os grandes avanços na Deteção Remota deram-se durante as duas Grandes Guerras e durante a Guerra Fria. Com o términos desses conflitos, a técnica disseminou-se pela comunidade civil, aumentando progressivamente o leque de aplicações, sendo hoje infindável a lista de opções de utilização de dados de sensores remotos. Cartografia, agricultura, florestas, hidrologia, geologia, oceanografia, meteorologia, monitorização de fenómenos ambientais, de catástrofes naturais e tecnológicas, são apenas algumas das suas aplicações mais comuns.</p>

<p>Assim, a Deteção Remota é definida como a ciência da aquisição, processamento e interpretação de imagens obtidas por meios aéreos e por satélite, que registam a interação entre o terreno e a radiação eletromagnética. Dado que o conceito de Deteção Remota implica um distanciamento importante entre o sensor que capta o sinal e o objeto observado, esta pode ser considerada como o processo subjacente a todas as formas e técnicas de medição, tratamento e interpretação de fenómenos longínquos.</p>

<p>A Deteção Remota por satélite baseia-se no princípio de que todos os objetos da superfície terrestre interagem com a energia que recebem do Sol, ou do próprio satélite (no caso de sistemas de Deteção Remota ativos), sob a forma de energia eletromagnética (Rabaça, 2001 [4]).</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/3_scp_espectro_eletromagnetico.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/3_scp_espectro_eletromagnetico.png" width="500"  alt="Figura 3 – Espectro Eletromagnético [5]">
    </a>
</div>

<p>Os principais sistemas de Deteção Remota dividem-se, portanto, entre:</p>

<ul>
    <li>Sistemas óticos, que detetam a radiação eletromagnética refletida ou emitida pela superfície terrestre, designados sistemas de Deteção Remota passivos;</li>
    <li>Dispositivos de microondas, designados RADAR (“RAdio Detection And Ranging”) que, quando produzem o sinal que ilumina o alvo, são designados sistemas de Deteção Remota ativos (Fonseca & Fernandes, 2004 [6]).</li>
</ul>

<p>Os sistemas óticos centram-se numa parte do espectro que inclui a luz visível (aquela que é percetível pelos nossos olhos) e a radiação infravermelha (invisível para os nossos olhos). Esta região específica é onde tende a concentrar-se a maior parte da energia proveniente do Sol, que atinge a atmosfera terrestre, e onde a maioria dos processos vivos ocorrem, como por exemplo, a fotossíntese das plantas. Existe, nesta zona do espectro, uma denominada “janela atmosférica”, que permite a passagem de quase toda a radiação solar, através da atmosfera. Noutras zonas, como é o caso da região do ultravioleta, a atmosfera, através da camada do Ozono, absorve praticamente a totalidade da radiação solar.</p>

<p>Deste modo, percebe-se que os sensores instalados a bordo dos satélites conseguem captar radiação para além daquela que os olhos humanos conseguem percecionar, e isso trouxe grandes avanços à Observação da Terra. </p>

<p>Por exemplo, a clorofila das plantas, que conduz a fotossíntese, absorve a parte visível da radiação eletromagnética, essencialmente nos comprimentos de onda do azul e do vermelho. Já na região do infravermelho próximo (NIR), os pigmentos de clorofila não absorvem tanto a radiação, sendo grande parte dessa energia refletida, podendo ser captada pelos sensores infravermelhos dos satélites. </p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/4_scp_curva_espetral_vegetacao.gif" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/4_scp_curva_espetral_vegetacao.gif" width="500"  alt="Figura 4 – Curva espectral da vegetação [7]">
    </a>
</div>

<p>A imagem apresenta a curva espectral característica da vegetação, onde se pode observar precisamente esse comportamento, com dois picos de absorção na zona do azul e do vermelho (cerca de 90% da radiação é absorvida), e um pico de transmissão na região do infravermelho próximo (cerca de 40 a 50% da energia é refletida). O pequeno pico de refletância na zona do verde, é aquele que confere a tonalidade verde à vegetação aos olhos humanos.</p>

<p>Assim, as plantas aparecem muito brilhantes e claras nas imagens / bandas do infravermelho próximo. Quanto mais clorofila estiver presente na planta, mais saudável ela é, mais ativa é fotossinteticamente e mais refletância apresenta nessas bandas. O contraste da resposta da vegetação ao longo do espetro eletromagnético, permite criar imagens e índices (como por exemplo, o NDVI <a href="https://en.wikipedia.org/wiki/Normalized_Difference_Vegetation_Index" target="_blank">[8]</a>), onde se distinguem claramente zonas com e sem vegetação, bem como permite fazer a distinção entre tipos e estádios de desenvolvimento da vegetação. No infravermelho médio, observam-se três comprimentos de onda de forte absorção da radiação, devido essencialmente ao conteúdo em água da vegetação.</p>

<p>Desta pequena introdução se percebe a importância e o potencial da Deteção Remota nos diversos domínios do saber. </p>

<p>Contudo, existiram durante bastante tempo, duas grandes limitações à sua utilização generalizada, que se prendiam, essencialmente, com os custos das imagens e dos respetivos softwares de processamento.</p>

<p>Esta realidade começou a alterar-se com a disponibilização aberta e gratuita dos dados do programa norte-americano de Observação da Terra, Landsat <a href="https://en.wikipedia.org/wiki/Landsat_program" target="_blank">[9]</a>, cujo primeiro satélite foi lançado em 1972 (Landsat 1), encontrando-se atualmente em órbita o Landsat 8, lançado em 2013.</p>

<p>Mais recentemente, numa parceria entre a Comissão Europeia e a Agência Espacial Europeia (ESA), foi desenvolvido o programa Copernicus, do qual fazem parte 6 missões Sentinel, e que prevê uma continuidade a longo prazo e uma complementaridade entre os diversos sensores e instrumentos, para variadíssimas aplicações, desde as mais científicas, às mais aplicadas, disponibilizando essa informação, de forma aberta e gratuita, sem interrupções ou hiatos. 
Dessas 6 missões, 3 já possuem satélites em órbita:</p>

<ul>
    <li>Sentinel-1: constelação de 3 satélites (2 já lançados) que usam sensores RADAR, com o objetivo de monitorizar a Terra sólida - topografia, geologia, catástrofes naturais, calotes polares e sua dinâmica, etc.;</li>
    <li>Sentinel-2: constelação de 2 satélites, o primeiro lançado em 2015 e o segundo previsto para 2017, que usam sensores óticos multiespetrais, de alta resolução espacial (até 10m) e temporal (5 dias, a partir do lançamento do 2.º satélite). Têm como objetivo a monitorização da vegetação, solo, águas interiores e zonas costeiras, assim como o apoio aos serviços de emergência;</li>
    <li>Sentinel-3: constelação de 2 satélites, tendo o primeiro sido lançado recentemente, com a finalidade de monitorizar a superfície, a cor e a temperatura dos oceanos e dos continentes;</li>
    <li>Sentinel-4 : nova geração de satélites meteorológicos (geoestacionários);</li>
    <li>Sentinel-5 : nova geração de satélites meteorológicos de órbita polar;</li>
    <li>Sentinel-6 : nova geração de satélites de monitorização do nível do mar.</li>
</ul>

<p>A outra limitação referida, relativa aos custos dos softwares, também já foi amplamente ultrapassada, existindo, neste momento, diversos softwares open source de Deteção Remota <a href="http://gisgeography.com/open-source-remote-sensing-software-packages" target="_blank">[10]</a> <a href="http://www.grss-ieee.org/open-source-software-related-to-geoscience-and-remote-sensing" target="_blank">[11]</a>, onde também se inclui o SNAP da Agência Espacial Europeia <a href="http://step.esa.int/main/toolboxes/snap" target="_blank">[12]</a> e, naturalmente, o QGIS, que possui cada vez mais valências para Deteção Remota e Processamento Digital de Imagem, ao integrar ferramentas do GRASS <a href="https://grass.osgeo.org" target="_blank">[13]</a>, SAGA <a href="http://www.saga-gis.org" target="_blank">[14]</a>, Orfeo <a href="http://orfeo-toolbox.org" target="_blank">[15]</a>, GDAL <a href="http://www.gdal.org" target="_blank">[16]</a> e o Semi-Automatic Classification Plugin <a href="https://fromgistors.blogspot.com" target="_blank">[17]</a>.</p>

<p>O Semi-Automatic Classification Plugin (SCP) é um projeto desenvolvido pelo Luca Congedo <a href="https://www.linkedin.com/in/lucacongedogis" target="_blank">[18]</a>, um Engenheiro do Ambiente e investigador, que trabalha na área dos Sistemas de Informação Geográfica e da Deteção Remota desde 2009. O SCP é um plugin para o QGIS, que permite descarregar imagens Sentinel-2, Landsat e ASTER, fazer o pré-processamento, a classificação e o pós-processamento, de forma bastante simples e ágil, encontrando-se totalmente integrado no QGIS.</p>

<p>Este plugin possui um manual bastante completo e abrangente, sendo ainda complementado por uma série de vídeos/tutoriais disponibilizados pelo próprio autor <a href="https://fromgistors.blogspot.com" target="_blank">[17]</a>. Para além destes, começa a haver um grande conjunto de tutoriais dispersos pela Internet, sobre a utilização do SCP. O melhor e mais completo exemplo, em língua portuguesa, é o conjunto de tutoriais, em vídeo, disponibilizados pelo Professor Gonçalo Vieira <a href="http://vieira.weebly.com" target="_blank">[19]</a>, docente do IGOT (Universidade de Lisboa) e investigador do Centro de Estudos Geográficos, como suporte à unidade curricular de Deteção Remota e SIG aplicados ao Ordenamento do Território. Como se irá ver de seguida, este conjunto de vídeos percorre os diversos passos de um projeto de Deteção Remota.</p>

<p>O exemplo irá debruçar-se sobre a utilização de imagens do satélite <b>Sentinel-2A</b>, da ESA.</p>

<p>O gráfico seguinte apresenta, em comparação, as bandas dos satélites Sentinel-2, Landsat 7 e Landsat 8.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/5_scp_comparacao_bandas_sentinel_landsat.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/5_scp_comparacao_bandas_sentinel_landsat.png" width="500"  alt="Figura 5 - Comparação de bandas dos satélites Sentinel-2, Landsat 7 e Landsat 8 [20]">
    </a>
</div>

<h3>1) Instalação do Semi-Automatic Classification Plugin (SCP)</h3>

<p>O processo de instalação do SCP é feito exatamente da mesma forma que os restantes plugins. É, no entanto, necessário ter instalados, previamente, alguns pacotes de software, que são requisitos do SCP, nomeadamente: GDAL/OGR, Numpy, SciPy e Matplotlib. À partida, e independentemente do Sistema Operativo em que se estiver a trabalhar com o QGIS, o GDAL/OGR e o Matplotlib estarão já instalados, pois são acrescentados, por defeito, durante a instalação do QGIS. Os outros dois módulos (Numpy e SciPy), que acrescentam capacidades de computação científica à linguagem de programação Python, poderão, ou não, estar instalados. Este processo depende também do Sistema Operativo e da forma que se utilizou para a instalação do QGIS.</p>

<p><b>Linux -</b> usar um gestor de pacotes gráfico, como o Synaptic, ou a consola / terminal simplesmente com:</p>

<pre>
	sudo apt-get install python-numpy python-scipy python-matplotlib
</pre>

<p><b>Windows, instalação via OSGeo4W -</b> basta abrir o OSGeo4W, selecionar “Advanced Install”, pesquisar e instalar os pacotes (Libs) python-numpy, python-scipy e matplotlib, caso não estejam já instalados.</p>

<p><b>Windows, instalação Standalone -</b> à partida os pacotes estarão instalados mas, caso não estejam, sugere-se seguir o tutorial de instalação do plugin photo2shape <a href="http://qgis.pt/blog/2015/10/02/importar-fotografias-georreferenciadas-para-o-qgis" target="_blank">[21]</a>, na parte que diz respeito à instalação/utilização do PyPi (Python Package Index).</p>

<p>Depois destas dependências satisfeitas, instala-se o SCP propriamente dito, a partir do menu Módulos -> Gerir e Instalar Módulos. No gestor de módulos, faz-se a pesquisa por “Semi-Automatic Classification” e “Instalar módulo”.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/6_scp_instalacao_scp.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/6_scp_instalacao_scp.jpg" width="500"  alt="Figura 6 - Instalação do Semi-Automatic Classification Plugin">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/7_scp_qgis_com_scp.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/7_scp_qgis_com_scp.png" width="500"  alt="Figura 7 - QGIS com o Semi-Automatic Classification Plugin">
    </a>
</div>

<h3>2) Aquisição dos Dados / Imagens</h3>

<p>Existem inúmeras formas de aceder às imagens dos sensores de Deteção Remota, podendo o download ser feito a partir dos sites das respetivas agências <a href="https://scihub.copernicus.eu" target="_blank">[22]</a> <a href="http://earthexplorer.usgs.gov" target="_blank">[23]</a>, ou de sites de terceiros.</p>

<p>Contudo, o SCP facilita muito essa tarefa, na medida em que é possível fazer o download das imagens, diretamente a partir do QGIS. O vídeo seguinte (em inglês) apresenta o processo de download de imagens Sentinel-2 a partir do SCP (até ao minuto 4:41):</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/FcETq8OWM0k?start=35" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<h3>3) Pré-Processamento das Imagens - Correção Atmosférica</h3>

<p>O primeiro passo, após o download das imagens, consiste na aplicação da correção atmosférica (conversão do valor dos pixéis para reflectância). Este processo é explicado no vídeo seguinte, do Professor Gonçalo Vieira:</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/m3XFvvVrU24" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<h3>4) Pré-Processamento das Imagens - Recorte pela Área de Interesse</h3>

<p>As imagens Sentinel-2 têm uma grande extensão espacial e são bastante pesadas. Uma imagem Sentinel-2 completa possui mais de 6 GB e abrange uma faixa com 290 km de largura. No SCP é possível fazer o download de “granules” individuais mas, mesmo essas, possuem 109,8 km de lado, o que perfaz mais de 12.000 km2 de área, por cada “granule” individual.</p>

<p>Assim, é recomendável recortar as diversas bandas da imagem pela área de interesse, antes de efetuar qualquer processamento subsequente.</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/8UHey-bQJGs" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<h3>5) Criação de Imagens Compósitas RGB</h3>

<p>Um primeiro procedimento conducente à interpretação das imagens de satélite, consiste na criação de imagens RGB, isto é, imagens coloridas, que agregam informação de 3 bandas individuais, cada uma das quais pertencente a uma região específica do espetro eletromagnético. Este processo permite evidenciar, por exemplo, características que não são percetíveis ao olho humano, pois correspondem a regiões diferentes do visível.</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/LWvDEE1Evxg" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<h3>6) Classificação da Imagem</h3>

<p>Um dos processos fulcrais de análise de uma imagem de satélite consiste na sua classificação, que tem como principal objetivo a criação de cartografia temática, representativa da superfície terrestre.
O comportamento de um dado objeto ao longo do espectro eletromagnético traduz-se na sua assinatura espectral. A classificação surge como um processo de extração de informação que analisa as assinaturas espectrais de cada pixel, separando-os em classes consoante a similaridade das suas assinaturas, a qual é determinada pela refletância relativa do pixel ao longo dos diferentes comprimentos de onda [4]. </p>

<p>Existem dois tipos básicos de classificação digital:</p>

<ul>
    <li>Classificação Não-Supervisionada, na qual o software separa os pixéis por classes, sem qualquer tipo de intervenção do operador;</li>
    <li>Classificação Supervisionada, na qual o operador define, na imagem, áreas, designadas “áreas de treino”, que são representativas de cada classe.</li>
</ul>

<h3>6.1) Classificação Não-Supervisionada</h3>

<p>Este tipo de classificação é útil quando não se dispõe de um conhecimento prévio da área de trabalho. O método parte do pressuposto de que, considerando que as diferentes assinaturas espectrais se aglomeram, formando distintas classes espectrais, então estas deverão corresponder a diferentes classes temáticas.</p>

<p>No vídeo seguinte, o Professor Gonçalo Vieira apresenta duas formas de proceder à classificação não-supervisionada de imagens, através da aplicação de uma classificação em clusters, no QGIS.</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/9_OJEjdKOJc" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<h3>6.2) Classificação Supervisionada</h3>

<p>A classificação supervisionada requer um conhecimento prévio do terreno e implica a seleção de pequenas áreas representativas das classes, que posteriormente são utilizadas como referência estatística de toda a classificação. A fase que consiste na delimitação das várias classes que entram na classificação denomina-se fase de treino e é dela que depende, em grande medida, o sucesso da mesma.</p>

<p>Este processo é muito bem explicado pelo Professor Gonçalo Vieira no vídeo seguinte.</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/t5D6JT7adYY" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<h3>7) Pós-Processamento - Avaliação do Erro Associado à Classificação</h3>

<p>A avaliação quantitativa do erro associado a cada uma das classes resultantes do processo de classificação é um passo fundamental para determinar a precisão do mapa temático obtido e para validar os resultados. Esta tarefa consiste, basicamente, no confronto entre o mapa classificado e um conjunto de amostras independentes, isto é, amostras de classes conhecidas (áreas de validação) que não foram utilizadas como amostras de treino para o classificador, de forma a realizar uma classificação cruzada, que gera uma tabela ou matriz de contingências. No vídeo seguinte, o Professor Gonçalo Vieira mostra como gerar essa matriz no QGIS, com o SCP.</p>

<iframe width="640" height="360" src="https://www.youtube.com/embed/k1yjcJPb1WI" frameborder="0" allowfullscreen="allowfullscreen"> </iframe> <br />

<br />

<p>Desta forma, ficam patentes os principais procedimentos envolvidos num projeto de Deteção Remota com sensores óticos. Note-se que se podem utilizar exatamente os mesmos procedimentos, com imagens Landsat ou ASTER, ambas acessíveis diretamente a partir do SCP. </p>

<p>O  Semi-Automatic Classification Plugin dispõe, ainda, de diversos recursos adicionais, tanto de pré- como de pós-processamento, permitindo também executar operações de álgebra de mapas entre as diversas bandas das imagens, assim como correr as diversas ferramentas em modo “batch”.</p>

<p>O SCP veio, sem dúvida, enriquecer de forma substancial o QGIS em termos de capacidades no âmbito da Deteção Remota e do Processamento Digital de Imagem.</p>

<br />

<h3>Agradecimentos Especiais</h3>

<p><b>Professor Gonçalo Vieira</b> <a href="http://vieira.weebly.com" target="_blank">[19]</a>, pelos contributos e pela disponibilização da série de tutoriais aqui apresentados.</p>

<p><b>Luca Congedo</b> <a href="https://www.linkedin.com/in/lucacongedogis" target="_blank">[18]</a>, pelo desenvolvimento do SCP e pela elaboração do respetivo manual, conteúdos e tutoriais em vídeo, um dos quais aqui apresentado.</p>

<br />

<h3>Referências</h3>

<p>[0] <a href="https://pt.wikipedia.org/wiki/F%C3%A9lix_Nadar" target="_blank">https://pt.wikipedia.org/wiki/F%C3%A9lix_Nadar</a></p>
<p>[1] <a href="http://www.proprofs.com/flashcards/story.php?title=history-of-photography-midterm" target="_blank">http://www.proprofs.com/flashcards/story.php?title=history-of-photography-midterm</a></p>
<p>[2] <a href="http://www.bigmapblog.com/2012/kite-photo-of-post-quake-san-francisco-1906" target="_blank">http://www.bigmapblog.com/2012/kite-photo-of-post-quake-san-francisco-1906</a></p>
<p>[3] <a href="http://earthquake.usgs.gov/regional/nca/1906/kap/lawrence.php" target="_blank">http://earthquake.usgs.gov/regional/nca/1906/kap/lawrence.php</a></p>
<p>[4] Rabaça, Teresa - Caracterização Geoambiental da Região de Penamacor-Idanha por Aplicação de Técnicas de Detecção Remota. Coimbra: Departamento de Ciências da Terra da Faculdade de Ciências e Tecnologia da Universidade de Coimbra, 2001. Dissertação para obtenção do grau de Mestre.</p>
<p>[5] <a href="http://www.seos-project.eu/modules/remotesensing/remotesensing-c01-p01.html" target="_blank">http://www.seos-project.eu/modules/remotesensing/remotesensing-c01-p01.html</a></p>
<p>[6] Fonseca, Ana & Fernandes, João - Detecção Remota. 1a Edição. Lisboa: Lidel, 2004.</p>
<p>[7] <a href="http://www.gov.scot/Publications/2009/11/06110108/6" target="_blank">http://www.gov.scot/Publications/2009/11/06110108/6</a></p>
<p>[8] <a href="https://en.wikipedia.org/wiki/Normalized_Difference_Vegetation_Index" target="_blank">https://en.wikipedia.org/wiki/Normalized_Difference_Vegetation_Index</a></p>
<p>[9] <a href="https://en.wikipedia.org/wiki/Landsat_program" target="_blank">https://en.wikipedia.org/wiki/Landsat_program</a></p>
<p>[10] <a href="http://gisgeography.com/open-source-remote-sensing-software-packages" target="_blank">http://gisgeography.com/open-source-remote-sensing-software-packages</a></p>
<p>[11] <a href="http://www.grss-ieee.org/open-source-software-related-to-geoscience-and-remote-sensing" target="_blank">http://www.grss-ieee.org/open-source-software-related-to-geoscience-and-remote-sensing</a></p>
<p>[12] <a href="http://step.esa.int/main/toolboxes/snap" target="_blank">http://step.esa.int/main/toolboxes/snap</a></p>
<p>[13] <a href="https://grass.osgeo.org" target="_blank">https://grass.osgeo.org</a></p>
<p>[14] <a href="http://www.saga-gis.org" target="_blank">http://www.saga-gis.org</a></p>
<p>[15] <a href="http://orfeo-toolbox.org" target="_blank">http://orfeo-toolbox.org</a></p>
<p>[16] <a href="http://www.gdal.org" target="_blank">http://www.gdal.org</a></p>
<p>[17] <a href="https://fromgistors.blogspot.com" target="_blank">https://fromgistors.blogspot.com</a></p>
<p>[18] <a href="https://www.linkedin.com/in/lucacongedogis" target="_blank">https://www.linkedin.com/in/lucacongedogis</a></p>
<p>[19] <a href="http://vieira.weebly.com" target="_blank">http://vieira.weebly.com</a></p>
<p>[20] <a href="http://landsat.gsfc.nasa.gov/sentinel-2a-launches-our-compliments-our-complements" target="_blank">http://landsat.gsfc.nasa.gov/sentinel-2a-launches-our-compliments-our-complements</a></p>
<p>[21] <a href="http://qgis.pt/blog/2015/10/02/importar-fotografias-georreferenciadas-para-o-qgis" target="_blank">http://qgis.pt/blog/2015/10/02/importar-fotografias-georreferenciadas-para-o-qgis</a></p>
<p>[22] <a href="https://scihub.copernicus.eu" target="_blank">https://scihub.copernicus.eu</a></p>
<p>[23] <a href="http://earthexplorer.usgs.gov" target="_blank">http://earthexplorer.usgs.gov</a></p>
<p>Venâncio, Pedro - Aplicação de Dados de Detecção Remota à Cartografia Geológica da Região de Viseu. Coimbra: Departamento de Ciências da Terra da Faculdade de Ciências e Tecnologia da Universidade de Coimbra, 2007. Estágio Científico da Licenciatura em Geologia.</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/8248cd896ad16c4ef53d0558d8e62a18></img>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Análise De Redes Com O QGIS]]></title>
    <link href="http://qgis.pt/2016/02/21/analise-de-redes-com-o-qgis/"/>
    <updated>2016-02-21T08:32:24+00:00</updated>
    <id>http://qgis.pt/2016/02/21/analise-de-redes-com-o-qgis</id>
    <content type="html"><![CDATA[<p>Graças ao trabalho do Médéric Ribreux <a href="https://medspx.fr/" target="_blank">[0]</a>, o QGIS passará a integrar, a partir da versão 2.14 LTR, um conjunto de funcionalidades de análise de redes, através das ferramentas v.net.* <a href="https://grass.osgeo.org/grass70/manuals/v.net.html" target="_blank">[1]</a> do GRASS, integradas no Processing.</p>

<p>Apesar destas ferramentas provirem e serem executadas pelo GRASS, o modelo de implementação no Processing permite que a sua utilização no QGIS seja significativamente mais simples e intuitiva do que na versão original, já que a construção do modelo topológico de redes é feito de forma transparente para o utilizador.</p>

<!-- more -->

<p>Assim, para executar a maior parte das análises, basta dispor de uma layer de linhas (arcs) e outra[s] de pontos (nodes).</p>

<p>Para já, estas ferramentas só funcionam com o GRASS 7.0.x como base. No entanto, está prevista a adaptação para utilização com o GRASS 6.4 e com o GRASS 7.1.x <a href="https://github.com/qgis/QGIS/pull/2628" target="_blank">[2]</a>.</p>

<p>De seguida apresentam-se alguns exercícios de aplicação destas ferramentas.</p>

<h3>Preparação da layer de linhas (rede viária)</h3>

<p>A layer de linhas a utilizar pode, por exemplo, conter a rede viária de um determinado local. No presente caso, vai utilizar-se um extrato da rede viária da cidade de Pinhel.</p>

<p>Em termos de estrutura não é necessário seguir nenhum modelo rígido, bastando que a rede esteja topologicamente correta. Uma questão importante prende-se com os troços de sentido único ou de trânsito proibido, já que as ferramentas que se irão utilizar, permitem distinguir essas situações através da tabela de atributos.</p>

<p>Desta forma, nos troços de sentido único, vai ser necessário verificar o sentido em que a linha foi vetorizada.</p>

<p>A figura seguinte apresenta, a verde, os troços das ruas com duplo sentido, e a vermelho, os troços de sentido único. Note-se que a seta representa o sentido em que cada um desses troços foi digitalizado.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/1_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/1_analise_redes.jpg" width="500"  alt="Rede viária da cidade de Pinhel">
    </a>
</div>

<p>Analisando a imagem em pormenor, pode verificar-se que existe um troço que tem o sentido de vetorização contrário ao sentido de trânsito, o que iria causar um erro na análise de redes. Portanto, é importante verificar todos os troços e orientar a direção dos que forem de sentido único na direção em que se processa o trânsito. </p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/2_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/2_analise_redes.jpg" width="500"  alt="Troço com sentido de vetorização contrário ao sentido de trânsito">
    </a>
</div>

<p>Para corrigir este erro, é necessário inverter a direção do troço. Para o efeito, pode utilizar-se o plugin &#8220;Swap Vector Direction&#8221; do QGIS (Menu Plugins -> Manage and Install Plugins…):</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/3_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/3_analise_redes.jpg" width="500"  alt="Plugin Swap Vector Direction">
    </a>
</div>

<p>Depois de instalado, basta colocar a layer em edição, selecionar o(s) troço(s) a inverter e clicar no ícone da ferramenta:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/4_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/4_analise_redes.jpg" width="500"  alt="Inverter a direção da geometria">
    </a>
</div>

<p>Após as geometrias estarem de acordo com o sentido de trânsito, vai ser necessário indicar, num campo da tabela de atributos, que estes troços são de sentido único. Para isso, é necessário compreender a noção de &#8220;custo&#8221; nas análises de redes. Para  interiorizar este conceito, basta pensar nas pesquisas que vulgarmente se fazem nas aplicações de GPS para automóvel. Quando se pretende deslocar do ponto A para o ponto B, a aplicação questiona se se deseja calcular a rota mais curta ou a rota mais rápida. Nesse caso, a aplicação coloca à disposição do utilizador dois parâmetros que vão servir de &#8220;custo&#8221; para o cálculo do percurso: a distância e o tempo de deslocação.</p>

<p>A distância é o parâmetro de “custo” mais simples de utilizar, já que basta calcular o comprimento de cada troço da rede viária (no QGIS, Field Calculator -> função $length).</p>

<p>Para usar o tempo de deslocação também não é complexo, mas é necessário saber qual é a velocidade média/máxima em cada troço. Tendo esse valor em Km/h, basta aplicar a fórmula no Field Calcular:</p>

<pre>
	($length/1000) x 60 / [Velocidade média em Km/h]
</pre>

<p>Seguindo a mesma lógica, podem usar-se outros parâmetro para o &#8220;custo&#8221;, nomeadamente, o declive dos troços.</p>

<p>Nos exemplos seguintes vai usar-se, simplesmente, a distância.</p>

<p>Desta forma, cria-se um campo na tabela de atributos para calcular o comprimento de todos os troços (Field calculator -> Novo campo decimal (real) -> &#8220;dois_senti&#8221;):</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/5_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/5_analise_redes.jpg" width="500"  alt="Comprimento de todos os troços">
    </a>
</div>

<p>De seguida, cria-se um novo campo, mas com o nome &#8220;um_senti&#8221;:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/6_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/6_analise_redes.jpg" width="500"  alt="Comprimento dos troços no sentido inverso">
    </a>
</div>

<p>Finalmente, selecionam-se todos os troços com sentido único da rede viária e atribui-se-lhe o valor &#8220;-1&#8221;:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/7_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/7_analise_redes.jpg" width="500"  alt="Troços de sentido unico">
    </a>
</div>

<p>Com isto vai poder indicar-se que o troço está bloqueado no sentido inverso ao da vetorização. Todos os restantes troços serão praticáveis em ambos os sentidos e terão, para um lado e para o outro, um &#8220;custo&#8221; semelhante. Se se estivesse a considerar o declive do terreno no parâmetro &#8220;custo&#8221;, então já se poderia refletir aqui um &#8220;custo&#8221; distinto, consoante a direção fosse a da subida ou da descida da rua.</p>

<p>Deste modo, a layer de linhas está pronta para ser utilizada.</p>

<h3>Distância entre dois pontos (v.net.distance)</h3>

<p>Para calcular a distância entre dois pontos, criam-se duas novas layers de pontos, uma para inserir o ponto de início e outra o ponto de destino.</p>

<p>De seguida, corre-se a ferramenta v.net.distance do Processing, indicando: a layer da rede viária; a layer com o ponto de início; a layer com o ponto de destino; a margem que deve ser dada para unir os pontos de início e destino à rede, caso estes não estejam sobrepostos; o campo com o valor do &#8220;custo&#8221; para todos os troços; o campo com o valor do &#8220;custo&#8221; para os troços de sentido único</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/8_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/8_analise_redes.jpg" width="500"  alt="Ferramenta v.net.distance">
    </a>
</div>

<p>Curiosamente, a ferramenta calcula o percurso no sentido contrário, ou seja, do ponto de destino para o ponto de início, pelo que se se pretender o percurso exatamente na direção início -> destino, têm de se inverter as layers que se definem na ferramenta v.net.distance. O resultado é o da figura seguinte, onde se pode observar que o sentido do trânsito foi devidamente respeitado.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/9_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/9_analise_redes.jpg" width="500"  alt="Caminho mais curto com a ferramenta v.net.distance">
    </a>
</div>

<p>Utilizando a mesma ferramenta, poderia calcular-se a distância de &#8220;muitos-para-muitos&#8221;, como mostra o exemplo do seu manual <a href="https://grass.osgeo.org/grass70/manuals/v.net.distance.html" target="_blank">[3]</a>, onde é calculado o caminho mais curto e a distância a partir de um conjunto de escolas (círculos a verde), até às unidades de saúde mais próximas (cruzes a vermelho).</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/10_analise_redes.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/10_analise_redes.png" width="500"  alt="Caminho mais curto das escolas para os hospitais">
    </a>
</div>

<h3>Divisão da rede através de isolinhas de custo (v.net.iso)</h3>

<p>Esta ferramenta é muito útil quando se está a usar o tempo de deslocação como parâmetro de &#8220;custo&#8221;, uma vez que devolve como resultado, as isócronas dos tempos de deslocação.</p>

<p>Neste caso, vai calcular-se a distância a partir de um conjunto de serviços existentes na cidade de Pinhel, com a ferramenta v.net.iso.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/11_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/11_analise_redes.jpg" width="500"  alt="Ferramenta v.net.iso">
    </a>
</div>

<p>Nota apenas para o campo &#8220;Costs for isolines&#8221;, onde se definem os valores de &#8220;custo&#8221; que, neste caso, diz respeito à distância em metros. O resultado é o da figura seguinte.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/12_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/12_analise_redes.jpg" width="500"  alt="Isócronas com a ferramenta v.net.iso">
    </a>
</div>

<h3>O problema do caixeiro-viajante (v.net.salesman)</h3>

<p>O Problema do Caixeiro Viajante é um problema que tenta determinar a menor rota para percorrer uma série de cidades (visitando uma única vez cada uma delas), regressando à cidade de origem. Trata-se de um problema de otimização NP-difícil inspirado na necessidade dos vendedores realizarem entregas em diversos locais (as cidades), percorrendo o menor caminho possível e reduzindo, dessa forma, o tempo necessário para a viagem e os possíveis custos com transporte e combustível <a href="https://pt.wikipedia.org/wiki/Problema_do_caixeiro-viajante" target="_blank">[4]</a>.</p>

<p>Este algoritmo também se encontra no Processing e vai usar-se para calcular o percurso mais curto que permite percorrer todos os serviços inventariados no exemplo anterior.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/13_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/13_analise_redes.jpg" width="500"  alt="Ferramenta v.net.salesman">
    </a>
</div>

<p>São devolvidos dois resultados, um correspondendo à geometria do percurso otimizado, e o outro a uma tabela alfanumérica onde é apresentada a sequência ótima de visita aos serviços, identificados pelo respetivo ID (9 -> 4 -> 5 -> 6 -> 7 -> 8 -> 3 -> 1 -> 2), bem como o &#8220;custo&#8221; associado.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/14_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/14_analise_redes.jpg" width="500"  alt="Percurso otimizado com a ferramenta v.net.salesman">
    </a>
</div>

<br />

<p>Para além das apresentadas, existem mais 17 ferramentas v.net.* no Processing, prontas para resolver muitos problemas de análise de redes.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/15_analise_redes.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/15_analise_redes.jpg" width="500"  alt="Ferramentas de análise de redes disponíveis no Processing">
    </a>
</div>

<br />

<h3>Referências</h3>

<p>[0] <a href="https://medspx.fr/" target="_blank">https://medspx.fr/</a></p>
<p>[1] <a href="https://grass.osgeo.org/grass70/manuals/v.net.html" target="_blank">https://grass.osgeo.org/grass70/manuals/v.net.html</a></p>
<p>[2] <a href="https://github.com/qgis/QGIS/pull/2628" target="_blank">https://github.com/qgis/QGIS/pull/2628</a></p>
<p>[3] <a href="https://grass.osgeo.org/grass70/manuals/v.net.distance.html" target="_blank">https://grass.osgeo.org/grass70/manuals/v.net.distance.html</a></p>
<p>[4] <a href="https://pt.wikipedia.org/wiki/Problema_do_caixeiro-viajante" target="_blank">https://pt.wikipedia.org/wiki/Problema_do_caixeiro-viajante</a></p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/8248cd896ad16c4ef53d0558d8e62a18></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Visualizar Dados Dos Censos 2011 Com O QGIS]]></title>
    <link href="http://qgis.pt/2016/02/14/visualizar-dados-dos-censos-2011-com-o-qgis/"/>
    <updated>2016-02-14T21:16:37+00:00</updated>
    <id>http://qgis.pt/2016/02/14/visualizar-dados-dos-censos-2011-com-o-qgis</id>
    <content type="html"><![CDATA[<style>
img {
    max-width:100%;
    height: auto;
    display: block;
    margin: 0 auto;
    }
</style>

<p>A Base Geográfica de Referenciação da Informação (BGRI), que outrora foi paga, está há já algum tempo disponível a todos até ao nível da subsecção estatística e com um total de 122 variáveis dos censos 2011 (organizados por população residente, população presente, famílias, alojamento e edifícios). A <a href="http://mapas.ine.pt/download/index2011.phtml">página</a> para download, permite descarregar os dados totais para Portugal, ou por regiões e concelhos.</p>

<!-- more -->

<a href="http://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2013-05-03-194654.png"><img class="aligncenter size-large wp-image-157" src="http://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2013-05-03-194654.png?w=584" alt="Screenshot from 2013-05-03 19:46:54" width="584" height="450" /></a>

<p>O zip descarregado contém diversos ficheiros, nomeadamente um shapefile (shp, shx e dbf) com os poligonos das subsecções estatísticas e um ficheiro de texto (csv) contendo os valores das variáveis dos censos 2011 (assim como  uma nota explicativa das mesmas).</p>

<p>A página de ajuda refere que é possível abrir estes dados recorrendo a software open source, como o <a href="http://qgis.org/">QGIS</a> ou <a href="http://www.gvsig.org/web/">gvSIG</a>, mas não exemplifica como fazê-lo. A tarefa, embora não seja difícil, obriga a uns quanto passos. Vamos ver quais são.</p>

<h2>Abrir os ficheiros no QGIS</h2>

<h3>Dados geográficos (SHP)</h3>
<p>Os dados geográficos, ao nível da subsecção estatística, estão guardados no ficheiro <em>ESRI Shapefile</em> (*.shp) que abrimos usando o botão <em><strong>Adicionar camada vectorial <img class="alignnone  wp-image-1346" src="https://sigsemgrilhetas.files.wordpress.com/2013/05/add_vector.png" alt="add_vector" width="21" height="21" />  (</strong></em>ou através do menu <em><strong>camada &gt; adicionar camada &gt; Adicionar camada vectorial&#8230;</strong></em>). Usando o botão <em><strong>pesquisar</strong></em> indique a localização do ficheiro com a extensão &#8220;*.shp&#8221; (lembre-se que terá de ter opção &#8220;Todos os Ficheiros&#8221; ou &#8220;ESRI Shapefile&#8221; para que o ficheiros esteja visível). Para evitar problemas com acentos e cedilhas deve escolher uma <em><strong>codificação</strong></em> que suporte os nossos caracteres especiais, nomeadamente o &#8220;ISO-8859-1&#8221; ou &#8220;latin1&#8221;, que, como podem ver neste <a href="https://pt.wikipedia.org/wiki/ISO_8859-1">link</a>, é essencialmente a mesma coisa).</p>

<img src="https://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2016-02-13-144846.png" alt="Screenshot from 2016-02-13 14:48:46" width="521" height="251" />

<p>Depois de aberto o ficheiro, há que definir o sistema de coordenadas de referência correcto para a camada, que, tal como podemos ver pelos <a  href="http://mapas.ine.pt/download/metadados/bgri11.html">metadados</a>, para portugal continental é o ETRS89/PT-TM06 (EPSG:3763). Isso é feito clicando com botão direito sobre a camada e escolhendo a opção <em><strong>Definir SRC da camada</strong></em>. A forma mais fácil de encontrar o sistema desejado é introduzir o seu código EPSG no campo do filtro.</p>

<img src="https://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2016-02-13-144928.png" alt="Screenshot from 2016-02-13 14:49:28" width="534" height="591" />

<h3>Dados alfanuméricos (CSV)</h3>

<p>Os dados alfanuméricos dos censos 2011 são guardados num ficheiro CSV (<em>Comma Separated Values</em>), que não é mais que ficheiros simples de texto em que os valores são separados por vírgulas, ponto-e-vírgulas, ou espaços, e podem ser delimitados, por exemplo, por aspas, e que podem ter ou não uma linha de cabeçalho com os nomes dos campos.</p>

<p>Como se pode ver no excerto abaixo, no nosso caso os valores são  separados por ponto e vírgula, e contêm uma linha de cabeçalho com os nomes dos campos.</p>

<pre>ANO;GEO_COD;GEO_COD_DSG;NIVEL;NIVEL_DSG;N_EDIFICIOS_CLASSICOS;N_EDIFICIOS_CLASSICOS_1OU2;...
2011;'PT;PT;1;Total Nacional;3544389;3219791;...
2011;'1;Continente;2;NUT1;3353610;3035969;...
2011;'17;Lisboa;3;NUT2;448957;322603;...
2011;'171;Grande Lisboa;4;NUT3;277387;184975;...
...</pre>

<p>Por omissão, o QGIS (através do <a href="http://www.gdal.org/ogr/">OGR</a>) lê todos os campos do CSV como sendo do tipo texto (string). No entanto, se quisermos definir explicitamente o tipo de dados de cada campo, podemos usar uma técnica que aprendi com o <a href="http://www.linkedin.com/in/hfpmartins">Hugo Martins</a>. Na mesma pasta, cria-se um ficheiro de texto com o mesmo nome que o csv, mas com a extensão .csvt, e, numa só linha, separado por virgulas e dentro de aspas, especificamos cada um dos tipos de dados dos campos (<em>integer</em>, <em>real</em>, <em>string</em>, <em>date</em> (YYYY-MM-DD), <em>time</em> (HH:MM:SS+nn) e <em>datetime</em> (YYYY-MM-DD HH:MM:SS+nn)).</p>

<p>Para facilitar, criei um ficheiro csvt com as características necessárias que podem descarregá-lo <a href="https://dl.dropboxusercontent.com/u/5088211/BGRI2011_PT.csvt">aqui</a>. (Nota: o nome do ficheiro terá de ser alterado consoante o nível a que descarregaram a informação, e.g., BGRI2011_PT.csvt &#8211;&gt; BGRI2011_1105.csvt.</a></p>

<p>Depois de preparado o CSVT e de o colocarmos na mesma pasta que o CSV, podemos abrir o CSV no QGIS. Para isso usamos o botão <strong>Adicionar camada de texto delimitado <img class="alignnone  wp-image-1429" src="https://sigsemgrilhetas.files.wordpress.com/2013/05/icon_texto_delimitado.png" alt="icon_texto_delimitado" width="20" height="20" /> </strong>(ou através do menu <strong>camada &gt; adicionar camada &gt; Adicionar camada de texto delimitado&#8230;</strong></em>). Começamos por indicar a localização do ficheiro usando o botão <em><strong>Procurar&#8230;</strong></em>. Mais uma vez, devemos garantir que usamos uma codificação compatível, a ISO-8859-1. Em formato de ficheiro escolhemos <em><strong>Delimitadores personalizados</strong></em> e, como já tínhamos visto anteriormente, seleccionamos a opção <em><strong>Ponto e vírgula. </strong></em>Seleccionamos a caixa <em><strong>Primeiro registo tem nome dos campos </strong></em>e escolhemos<em><strong> Sem geometria </strong></em>em Definição de geometria.</p>

<p>No final da caixa de diálogo podemos ver uma amostra de como ficará o nosso ficheiro dentro do QGIS. Se repararem no campo <em>GEO_COD</em> todos os valores têm antes um apóstrofe (&#8216;) - penso que colocado propositadamente para obrigar os valores a serem considerados texto em programas como o Excel ou o Calc - de que nos vamos ter de livrar. Para isso, voltamos às opções de <em><strong>Delimitadores personalizados</strong></em> e na opção <em><strong>Escape</strong></em> colocamos um apóstrofe (&#8216;) que será ignorado em <strong><span style="text-decoration: underline;">todos os campos e respectivos valores</span></strong> (felizmente, no nosso caso não existem apóstrofes noutros campos, caso contrário teríamos de editar o ficheiro num editor de texto para os salvaguardar) . A caixa de diálogo com todas as opções necessárias deve parecer-se com a imagem abaixo.</p>

<img src="https://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2016-02-14-010426.png" alt="Screenshot from 2016-02-14 01:04:26" width="962" height="571" />

<h2>Unir as tabelas de atributos</h2>

<p>Agora que temos as duas camadas no QGIS, já só falta relacionar a componente geográfica à alfanumérica. Uma vez que têm ambas um campo em comum isto pode ser feito através de uma união (virtual). Para isso, temos de abrir as propriedades da camada &#8220;geométrica&#8221; (botão direito do rato sobre a camada, <em><strong>Propriedades</strong></em>)  e, no separador <strong><em>Uniões</em></strong>, adicionar uma nova união clicando no botão <img class="alignnone  wp-image-1514" src="https://sigsemgrilhetas.files.wordpress.com/2013/05/mactionsignplus.png" alt="mActionSignPlus" width="17" height="17" />. No menu seguinte, é necessário definir a <em><strong>Camada a unir</strong></em> a tabela resultante do CSV, o <em><strong>Campo a unir</strong></em> como &#8220;GEO_COD&#8221; e o <em><strong>Campo alvo</strong></em> como &#8220;BGRI11&#8221; (contém o código da subsecção estatística). Podemos ainda definir quais os campos do CSV queremos unir, e que prefixo lhe dar. Para tornar a visualização dos dados mais rápida, aconselha-se a seleccionar a opção de memorizar a camada unida em memória virtual.</p>

<img src="https://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2016-02-14-152402.png" alt="Screenshot from 2016-02-14 15:24:02" width="505" height="423" />

<p>Finalizado o processo, a camada com os dados geográficos tem agora novos campos originários do CSV, tantos quantos os escolhidos,  e precedidos de um prefixo. No meu caso apenas adicionei um campo N_INDIVIDUOS_RESIDENT e usei o prefixo BGRI11_, como se pode constatar na imagem abaixo.</p>

<img src="https://sigsemgrilhetas.files.wordpress.com/2013/05/screenshot-from-2016-02-14-152628.png" alt="Screenshot from 2016-02-14 15:26:28" width="690" height="383" />

<p> Assim, torna-se possível usar os dados dos Censos 2011 para efectuar análise espacial, ou simplesmente para criar mapas. </p>

<img src="https://sigsemgrilhetas.files.wordpress.com/2013/05/censos2011_porto.jpeg" alt="censos2011_porto" width="566" height="566" />

<p><strong>Nota:</strong> Neste exemplo trabalhou-se ao nível da subsecção estatística, mas poderia usar-se outro nível de informação desde que combinasse os campos e se dissolvesse os polígonos de antemão.</p>

<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/bcce6e29a8bf37a2008f957238d69feb></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Análise Fisiográfica: Relevo - Hipsometria - Declive - Exposição De Encostas]]></title>
    <link href="http://qgis.pt/2016/02/14/analise-fisiografica-relevo-hipsometria-declive-exposicao-de-encostas/"/>
    <updated>2016-02-14T21:13:13+00:00</updated>
    <id>http://qgis.pt/2016/02/14/analise-fisiografica-relevo-hipsometria-declive-exposicao-de-encostas</id>
    <content type="html"><![CDATA[<p>O presente tutorial QGIS apresenta um conjunto alargado de procedimentos para análise fisiográfica.</p>

<p>São levadas a cabo duas abordagens distintas:</p>

<ul>
    <li>Escala média - a região do Algarve será utilizada como <i>case study</i>;</li>
    <li>Escala semi-detalhada - o concelho de Lagoa será utilizado como <i>case study</i>.</li>
</ul>

<!-- more -->

<p>Na análise fisiográfica à escala média utilizam-se três modelos digitais do terreno (MDT) que estão disponíveis na Internet (ASTER GDEM, EU-DEM e SRTM). O <i>case study</i> aqui apresentado pode, por isso, ser replicado com muita facilidade, quer para outras regiões de Portugal, quer para outros países.</p>

<p>Para este <i>case study</i> foi, adicionalmente, feita uma avaliação da qualidade dos MDT através da comparação com a Carta Militar de Portugal à escala 1:25.000, com o intuito de escolher um dos três modelos e, depois, utilizar o melhor para uma caracterização da hipsometria, dos declives e da exposição de encostas na região.</p>

<p>Na análise fisiográfica à escala semi-detalhada, os modelos digitais do terreno são construídos a partir de cartografia topográfica digital, recorrendo a um procedimento de triangulação (TIN) e a uma interpolação. É, consequentemente, mais difícil replicar o <i>case study</i> aqui apresentado, porque é indispensável ter acesso a essa fonte de informação, o que nem sempre é simples ou possível.</p>

<p>É, igualmente, feita uma análise comparativa entre o DTM obtido a partir de cartografia topográfica digital, o DTM obtido por detecção remota e a Carta Militar de Portugal.</p>

<br />

<p align="center">
<iframe src="https://www.slideshare.net/slideshow/embed_code/key/2aXFqJFwutyOSA" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/nlourei/tutorial-qgis-sobre-anlise-fisiogrfica" title="Tutorial QGIS sobre Análise Fisiográfica" target="_blank">Tutorial QGIS sobre Análise Fisiográfica</a> </strong> from <strong><a href="//www.slideshare.net/nlourei" target="_blank">Nuno de Santos Loureiro</a></strong> </div>
</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/250855cc7650a361d33fba560b47a4a9></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Preparação De Mapas Com Quadrículas Quilométricas UTM WGS84 Para a Apresentação Em Atlas De Distribuição]]></title>
    <link href="http://qgis.pt/2015/12/28/preparacao-de-mapas-com-quadriculas-quilometricas-utm-wgs84-para-a-apresentacao-em-atlas-de-distribuicao/"/>
    <updated>2015-12-28T12:06:53+00:00</updated>
    <id>http://qgis.pt/2015/12/28/preparacao-de-mapas-com-quadriculas-quilometricas-utm-wgs84-para-a-apresentacao-em-atlas-de-distribuicao</id>
    <content type="html"><![CDATA[<p>O tutorial <strong>Preparação de mapas com quadrículas quilométricas UTM WGS84 para a apresentação em atlas de distribuição</strong> apresenta um conjunto de procedimentos executados em QGIS, quer para a criação da própria grelha UTM WGS84, quer para a execução dos mapas com dados específicos relativos a uma situação concreta.</p>

<!-- more -->

<p>Adicionalmente, é apresentada uma funcionalidade que permite atribuir a cada registo pontual a indicação da quadrícula UTM WGS84 em que se insere.</p>

<p>Por fim, é apresentada a possibilidade de inserir nos mapas um tema adicional, como forma de enriquecer a informação a representar e comunicar.</p>

<br />

<p align="center">
<iframe src="https://www.slideshare.net/slideshow/embed_code/key/FkCRdwFDMOxPB0" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/nlourei/qgis-tutorial-sobre-preparao-de-mapas-com-quadrcula-utm-wgs84" title="QGIS - tutorial sobre preparação de mapas com quadrícula UTM WGS84" target="_blank">QGIS - tutorial sobre preparação de mapas com quadrícula UTM WGS84</a> </strong> from <strong><a href="http://www.slideshare.net/nlourei" target="_blank">Nuno de Santos Loureiro</a></strong> </div>
</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/250855cc7650a361d33fba560b47a4a9></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Introdução Aos Sistemas De Informação Geográfica Com QGIS]]></title>
    <link href="http://qgis.pt/2015/11/24/introducao-aos-sistemas-de-informacao-geografica-com-qgis/"/>
    <updated>2015-11-24T08:44:10+00:00</updated>
    <id>http://qgis.pt/2015/11/24/introducao-aos-sistemas-de-informacao-geografica-com-qgis</id>
    <content type="html"><![CDATA[<p>O Grupo de Utilizadores QGIS PT, por intermédio do Pedro Venâncio, em conjunto com a Comissão de Curso do Mestrado em Sistemas de Informação Geográfica da Universidade da Beira Interior, organizaram um Workshop de Introdução ao QGIS, no passado dia 7 de Novembro de 2015, na Covilhã.</p>

<p>Os objetivos do Workshop passaram pela apresentação do QGIS e de todas as suas valências, bem como da sua história, evolução, modelo de desenvolvimento e suporte. Foi também abordada a filosofia do Software Livre e de Código Aberto.</p>

<!-- more -->

<p>A apresentação elaborada para o Workshop disponibiliza-se de seguida.</p>

<br />

<p align="center">
<iframe src="https://www.slideshare.net/slideshow/embed_code/key/Lj30m10BbkdMWI" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/secret/Lj30m10BbkdMWI" title="Introdução aos Sistemas de Informação Geográfica com QGIS" target="_blank">Introdução aos Sistemas de Informação Geográfica com QGIS</a> </strong> from <strong><a href="http://www.slideshare.net/PedroNGV" target="_blank">Pedro Venâncio</a></strong> </div>
</p>

<p>A segunda parte do Workshop foi dedicada à resolução de 3 exercícios com o QGIS, abordando áreas como a georreferenciação de imagens raster, a criação de novas layers (pontos, linhas e polígonos), a vetorização de geometrias, a criação de atributos alfanuméricos, a definição de regras topológicas básicas, a aplicação de simbologia, o cálculo de áreas, perímetros e comprimentos, a transformação de coordenadas, a agregação de dados alfanuméricos a partir de fontes externas, a execução de operações de pesquisa por atributos e pesquisa espacial, a preparação de layouts de impressão, a execução de análise espacial sobre dados vetoriais, operações de geoprocessamento (buffer, intersect, difference, etc.) e análises multicritério.</p>

<p>Este Workshop contou com a presença de 20 participantes, entre alunos, ex-alunos e docentes das diversas Licenciaturas e Mestrados da Faculdade de Engenharia da UBI.</p>

<!-- Cartaz -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_cartaz.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_cartaz.jpg" width="500"  alt="Cartaz">
    </a>
</div>

<!-- Fotos do Workshop -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_foto_1.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_foto_1.jpg" width="500"  alt="Foto 1">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_foto_2.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_foto_2.jpg" width="500"  alt="Foto 2">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_foto_3.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_foto_3.jpg" width="500"  alt="Foto 3">
    </a>
</div>

<p>Entretanto, foi solicitado aos participantes que respondessem a um pequeno inquérito, sendo os resultados apresentados de seguida.</p>

<!-- Resultados do Inquerito -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_1.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_1.png" width="500"  alt="Em que área trabalha?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_2.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_2.png" width="500"  alt="Em que nível considera encontrar-se em relação aos SIG?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_3.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_3.png" width="500"  alt="Que softwares SIG já tinha utilizado?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_4.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_4.png" width="500"  alt="Quais os aspetos que considera mais importantes no Software Livre e de Código Aberto?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_5.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_5.png" width="500"  alt="Já tinha tido contacto com o QGIS antes desta sessão?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_6.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_6.png" width="500"  alt="Antes desta sessão, sabia que o QGIS era tão utilizado em Portugal e no Mundo?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_7.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_7.png" width="500"  alt="Antes desta sessão, como avaliava o QGIS, numa escala de 1 a 5?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_8.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_8.png" width="500"  alt="Depois desta sessão, como avalia o QGIS, numa escala de 1 a 5?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_9.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_9.png" width="500"  alt="Depois desta sessão, acha que será mais fácil resolver os exercícios apresentados no QGIS ou no ArcGIS?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_10.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_10.png" width="500"  alt="Acha que as disciplinas de SIG na Universidade deveriam utilizar mais Software Livre e de Código Aberto?">
    </a>
</div>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/ws_ubi_grafico_11.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ws_ubi_grafico_11.png" width="500"  alt="Como avalia este Workshop de Iniciação ao QGIS?">
    </a>
</div>

<p>Dado o sucesso e o interesse demonstrado pelos destinatários deste Workshop, o Grupo de Utilizadores QGIS Portugal irá continuar a realizar ações do mesmo género, junto de instituições de ensino superior e outras entidades.</p>


<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/8248cd896ad16c4ef53d0558d8e62a18></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Importar Fotografias Georreferenciadas Para O QGIS]]></title>
    <link href="http://qgis.pt/2015/10/02/importar-fotografias-georreferenciadas-para-o-qgis/"/>
    <updated>2015-10-02T21:25:47+01:00</updated>
    <id>http://qgis.pt/2015/10/02/importar-fotografias-georreferenciadas-para-o-qgis</id>
    <content type="html"><![CDATA[<p>Um Plugin que para mim é indispensável no QGIS é o photo2shape <a href="https://plugins.qgis.org/plugins/photo2shape/" target="_blank">[0]</a>, desenvolvido pelo Alexander Bruy <a href="http://wiki.osgeo.org/wiki/User:Alexbruy" target="_blank">[1]</a>.</p>

<p>Basicamente, este plugin cria uma shapefile de pontos com a localização de fotografias obtidas com máquinas fotográficas que possuem a tecnologia Geotagging.</p>

<p>Esta tecnologia está presente na esmagadora maioria dos smartphones atuais e, através dela, é possível adicionar um conjunto relativamente vasto de metadados às fotografias e vídeos, recorrendo à especificação Exchangeable image file format (Exif). De entre esses metadados, encontramos as coordenadas latitude / longitude (datum WGS84 - EPSG:4326), o que vai permitir, através do photo2shape, identificar o local onde a fotografia foi tirada.</p>

<!-- more -->

<p>A precisão da posição vai depender de muitas variáveis, nomeadamente a qualidade do recetor GNSS instalado no equipamento, as diversas interferências que afetam o sinal no seu trajeto desde as constelações de satélites em órbita (do americano GPS ou do russo GLONASS, penso que ainda não existem smartphones que consigam obter sinal de outras constelações, como o europeu Galileo ou o chinês BeiDou) até ao equipamento recetor, o tempo de recolha, a configuração dos satélites no horizonte, etc. Apesar das muitas fontes de erro, hoje em dia consegue-se uma precisão bastante aceitável com um simples smartphone de poucas dezenas/centenas de euros.</p>

<p>Vamos então à instalação do photo2shape. Tal como a maioria dos plugins do QGIS, a sua instalação é feita a partir do menu Módulos > Gerir e Instalar Módulos. No gestor de módulos, fazemos a pesquisa por &#8220;photo2shape&#8221; e verificamos que o plugin possui uma dependência que tem de ser satisfeita, caso contrário não irá funcionar: &#8220;Requires exifread >= 2.0.0&#8221;</p>

<!-- Imagem do Gestor de Módulos -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_1_dependencia_exifread.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_1_dependencia_exifread.jpg" width="500"  alt="Gestor de Módulos">
    </a>
</div>

<p>O ExifRead <a href="https://pypi.python.org/pypi/ExifRead/2.1.2" target="_blank">[2]</a> é um módulo Python muito simples, que permite extrair a informação dos metadados Exif de imagens tiff e jpeg. Infelizmente o ExifRead não é distribuído por omissão no instalador OSGeo4W, usado para instalar o QGIS em Windows (e para criar o instalador &#8220;standalone&#8221;), nem nos repositórios de software das distribuições Linux mais comuns (Ubuntu ou Debian), pelo que vamos ter de o acrescentar manualmente.</p>

<p>Para isso, o método mais simples é fazer a instalação através do PyPI (Python Package Index), que não é mais do que um repositório de software para a linguagem de programação Python. Vamos instalar o PyPI e o módulo ExifRead.</p>


<h3>Instalação em Linux</h3>

<ol>
	<li>Começa por se descarregar o ficheiro get-pip.py:<br /><a href="https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py" target="_blank">https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py</a></li>
	<li>Abrimos o terminal/consola, na pasta onde guardámos o ficheiro get-pip.py e executamos:
		<pre>
			sudo python get-pip.py
		</pre>
		Note que tivemos de usar o super user porque para executar esta instalação é necessário possuir privilégios de administração. 
	</li>
	<li>Uma vez instalado o PyPI, instalamos o módulo ExifRead, executando no terminal (também com privilégios de administração):
		<pre>
			sudo pip install exifread
		</pre>
	</li>
	<li>Para verificar se a instalação foi bem sucedida, executamos:
		<pre>
			EXIF.py -v
		</pre>
		e a resposta deverá ser algo do tipo:
		<pre>
			Version 2.1.2 on Python2
		</pre>
	</li>
	<li>Se o ExifRead já estiver instalado e quisermos atualizá-lo para a versão mais recente:
		<pre>
			sudo pip install --upgrade exifread
		</pre>
	</li>
</ol>

<h3>Instalação em Windows para QGIS instalado via OSGeo4W</h3>

<ol>
	<li>Começa por se descarregar o ficheiro get-pip.py:<br /><a href="https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py" target="_blank">https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py</a></li>
	<li>Abrimos a linha de comandos do OSGeo4W, localizada (na instalação por defeito) em C:\OSGeo4W64\OSGeo4W.bat ou C:\OSGeo4W\OSGeo4W.bat &#8220;como administrador&#8221; (botão direito do rato > &#8220;Executar como administrador&#8221;)</li>
	<li>Na linha de comandos navegamos para a pasta onde se guardou o ficheiro get-pip.py. Por exemplo, se ele ficou na pasta d:\downloads:
		<pre>
			d:
			cd downloads
		</pre>
	</li>
	<li>Executamos o comando de instalação:
		<pre>
			python.exe get-pip.py
		</pre>
	</li>
	<li>Uma vez instalado o PyPI, instalamos o módulo ExifRead, executando:
		<pre>
			pip install exifread
		</pre>
	</li>
	<li>Para verificar se a instalação foi bem sucedida, executamos:
		<pre>
			EXIF.py -v
		</pre>
		e a resposta deverá ser algo do tipo:
		<pre>
			Version 2.1.2 on Python2
		</pre>
	</li>
	<li>Se o ExifRead já estiver instalado e quisermos atualizá-lo para a versão mais recente:
		<pre>
			sudo pip install --upgrade exifread
		</pre>
	</li>
</ol>

<p>A partir deste momento temos tudo preparado para instalar o plugin photo2shape mas, antes disso, vamos constatar a simplicidade e as potencialidades do módulo ExifRead para fazer a leitura dos metadados de uma fotografia. Podem usar <a href="https://cld.pt/dl/download/1354d7a6-ae3d-430c-bb04-2fa2003165ad/IMG_20140217_105805.jpg" target="_blank">a fotografia seguinte como exemplo</a>, tirada com um smartphone Nexus 4:</p>

<div class="post-img">
    <a href="https://cld.pt/dl/download/1354d7a6-ae3d-430c-bb04-2fa2003165ad/IMG_20140217_105805.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="https://cld.pt/dl/download/1354d7a6-ae3d-430c-bb04-2fa2003165ad/IMG_20140217_105805.jpg"  alt="Nexus 4">
    </a>
</div>

<p>O comando é muito simples:</p>
	<pre>
		EXIF.py IMG_20140217_105805.jpg
	</pre>
<p>Vejam o resultado:</p>
	<pre>
		Opening: IMG_20140217_105805.jpg
		File has JPEG thumbnail
		EXIF ColorSpace (Short): sRGB
		EXIF ComponentsConfiguration (Undefined): YCbCr
		EXIF DateTimeDigitized (ASCII): 2014:02:17 10:58:05
		EXIF DateTimeOriginal (ASCII): 2014:02:17 10:58:05
		EXIF ExifImageLength (Long): 2448
		EXIF ExifImageWidth (Long): 3264
		EXIF ExifVersion (Undefined): 0220
		EXIF ExposureTime (Ratio): 1/438
		EXIF FNumber (Ratio): 53/20
		EXIF FlashPixVersion (Undefined): 0100
		EXIF FocalLength (Ratio): 23/5
		EXIF ISOSpeedRatings (Short): 100
		EXIF InteroperabilityOffset (Long): 360
		GPS GPSAltitude (Ratio): 775799/1000
		GPS GPSAltitudeRef (Byte): 0
		GPS GPSDate (ASCII): 2014:02:17
		GPS GPSImgDirection (Ratio): 171
		GPS GPSImgDirectionRef (ASCII): M
		GPS GPSLatitude (Ratio): [40, 37, 19531/625]
		GPS GPSLatitudeRef (ASCII): N
		GPS GPSLongitude (Ratio): [7, 4, 50781/2500]
		GPS GPSLongitudeRef (ASCII): W
		GPS GPSProcessingMethod (ASCII): ASCII
		GPS GPSTimeStamp (Ratio): [10, 58, 10]
		Image ExifOffset (Long): 134
		Image GPSInfo (Long): 390
		Image Make (ASCII): LGE
		Image Model (ASCII): Nexus 4
		Image ResolutionUnit (Short): Pixels/Inch
		Image XResolution (Ratio): 72
		Image YCbCrPositioning (Short): Centered
		Image YResolution (Ratio): 72
		Interoperability InteroperabilityIndex (ASCII): R98
		Interoperability InteroperabilityVersion (Undefined): [48, 49, 48, 48]
		Thumbnail Compression (Short): JPEG (old-style)
		Thumbnail JPEGInterchangeFormat (Long): 733
		Thumbnail JPEGInterchangeFormatLength (Long): 56878
		Thumbnail ResolutionUnit (Short): Pixels/Inch
		Thumbnail XResolution (Ratio): 72
		Thumbnail YResolution (Ratio): 72
	</pre>

<p>É então parte desta informação que vai ser usada pelo photo2shape para georreferenciar as fotografias.</p>

<p>Voltamos ao menu Módulos > Gerir e Instalar Módulos, pesquisamos por “photo2shape” e fazemos a instalação.</p>

<p>Após a instalação, o plugin fica disponível no menu &#8220;Vector&#8221; e na Barra de Ferramentas &#8220;Vector Toolbar&#8221;.</p>

<!-- Logotipo do photo2shape -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_logo.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_logo.png"  alt="Logo do photo2shape">
    </a>
</div>

<p>Abrimos o plugin</p>

<!-- Interface do photo2shape -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_2_interface.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_2_interface.jpg" width="500"  alt="Interface do photo2shape">
    </a>
</div>

<p>e verificamos como a sua interface é simples.</p>

<p>Basta selecionar a pasta onde se encontram as fotografias e escolher o caminho para a shapefile de saída.</p>

<!-- Interface do photo2shape preenchida -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_3_interface_preenchida.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_3_interface_preenchida.jpg" width="500"  alt="Interface do photo2shape preenchida">
    </a>
</div>

<p>O resultado é apresentado no QGIS:</p>

<!-- Shapefile criada pelo photo2shape -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_4_shapefile_qgis.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_4_shapefile_qgis.jpg" width="500"  alt="Shapefile criada pelo photo2shape">
    </a>
</div>

<p>Podemos agora aproveitar algumas das potencialidades do QGIS para tornar a informação mais completa e dinâmica. Atendendo a que dispomos do azimute das fotografias na tabela de atributos, podemos usar essa informação para orientar a simbologia das fotos, utilizando uma seta. Para o efeito, selecionamos o estilo Marcador simples, escolhemos a seta como símbolo, e na propriedade Ângulo usamos o campo &#8220;azimuth&#8221; para controlar a direção da seta. Por vezes é necessário acertar a direção, adicionando ou subtraindo algum valor ao campo azimute. No meu caso usei a expressão &#8220;azimuth&#8221; + 90, uma vez que as fotos foram tiradas com o smartphone na horizontal.</p>

<!-- Rotação do símbolo -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_5_rotacao_simbolo.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_5_rotacao_simbolo.jpg" width="500"  alt="Rotação do símbolo">
    </a>
</div>

<p>O resultado permite ter uma noção clara acerca da área abrangida por cada fotografia.</p>

<!-- Orientação das fotos -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_6_orientacao_fotos.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_6_orientacao_fotos.jpg" width="500"  alt="Orientação das fotos">
    </a>
</div>

<p>Podemos também configurar uma Ação para abrir a fotografia automaticamente quando se clica no símbolo da seta. Para isso, nas Propriedades da camada > Acções, configuramos a ação conforme a imagem seguinte, utilizando o campo &#8220;filepath&#8221; da tabela de atributos, que contém o caminho para a pasta onde as imagens se encontram guardadas. </p>

<!-- Configuração da ação -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_7_config_acao_abrir.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_7_config_acao_abrir.jpg" width="500"  alt="Configuração da ação">
    </a>
</div>

<p>Depois é só executar a ação para abrir as fotografias correspondentes a cada elemento da shapefile:</p>

<!-- Execução da ação -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_8_execucao_acao_abrir.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_8_execucao_acao_abrir.jpg" width="500"  alt="Execução da ação">
    </a>
</div>

<p>Não se esqueçam que, se alterarem as fotografias de pasta, têm de atualizar a ação. Nessa situação é preferível usar o campo &#8220;filename&#8221; em vez do &#8220;filepath&#8221; para configurar a ação:</p>

<pre>
	[%'caminho_para_a_pasta_que_contém_as_fotos' || "filename" %]
</pre>

<p>Uma última nota para quem está a configurar ações em ambiente Windows, pois o caminho para as imagens tem de ter a dupla barra invertida. Por exemplo, se as fotografias estivessem na pasta d:\downloads, a expressão da ação seria:</p>

<pre>
	[%'d:\\Downloads\\' || "filename" %]
</pre>

<p>Para terminar, podemos fazer a transformação do sistema de referência da shapefile originada pelo photo2shape, que está em WGS84, para PT-TM06/ETRS89. Para o efeito, é suficiente selecionar a camada na tabela de conteúdos, com o botão direito do rato fazer &#8220;Guardar como…&#8221; e, na janela seguinte, definir o caminho para a pasta onde se pretende guardar a nova shapefile e seleccionar o SRC EPSG:3763 - ETRS89 / Portugal TM06.</p>

<!-- Transformação de coordenadas -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/p2s_9_wgs84_to_etrs89.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/p2s_9_wgs84_to_etrs89.jpg" width="500"  alt="Transformação de coordenadas">
    </a>
</div>

<p>Neste caso, não precisamos de nos preocupar com os parâmetros de transformação de datum porque, para este nível de precisão, podemos considerar o WGS84 igual ao ETRS89 <a href="http://qgis.pt/blog/2014/07/13/transformacao-de-coordenadas-e-utilizacao-das-grelhas-ntv2-no-qgis/" target="_blank">[3]</a>.</p>

<h3>Referências</h3>
<p>[0] <a href="https://plugins.qgis.org/plugins/photo2shape/" target="_blank">https://plugins.qgis.org/plugins/photo2shape/</a></p>
<p>[1] <a href="http://wiki.osgeo.org/wiki/User:Alexbruy" target="_blank">http://wiki.osgeo.org/wiki/User:Alexbruy</a></p>
<p>[2] <a href="https://pypi.python.org/pypi/ExifRead/2.1.2" target="_blank">https://pypi.python.org/pypi/ExifRead/2.1.2</a></p>
<p>[3] <a href="http://qgis.pt/blog/2014/07/13/transformacao-de-coordenadas-e-utilizacao-das-grelhas-ntv2-no-qgis/" target="_blank">Transformação De Coordenadas E Utilização Das Grelhas NTv2 No QGIS</a></p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/8248cd896ad16c4ef53d0558d8e62a18></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Instalar Duas Versões De QGIS Em Linux]]></title>
    <link href="http://qgis.pt/2015/10/01/instalar-duas-versoes-de-qgis-em-linux/"/>
    <updated>2015-10-01T07:43:11+01:00</updated>
    <id>http://qgis.pt/2015/10/01/instalar-duas-versoes-de-qgis-em-linux</id>
    <content type="html"><![CDATA[<p>Em altura de testes à versão em desenvolvimento do QGIS (versão master), dá jeito  ter também instalada a última versão estável do QGIS. Em windows isso não representa um problema, uma vez que se podem instalar várias versões do QGIS em paralelo (tanto via Osgeo4w como standalone). Em linux, o processo não é tão directo pelo facto da instalação se realizar por obtenção de diversos pacotes disponíveis nos repositórios, não sendo por isso possível instalar mais do que uma versão sem que se originem quebras de dependências. Assim, instalando a versão estável através dos repositórios, as alternativas para instalação da versão em desenvolvimento são:</p>
<ul>
	<li>Compilar o QGIS master do código fonte;</li>
	<li>Instalar o QGIS master num docker;</li>
	<li>Instalar o QGIS master numa máquina virtual;</li>
</ul>
<p>Neste artigo vou mostrar como compilar o código fonte em <strong>Ubuntu 14.04</strong>. Afinal não é tão difícil quanto parece. Meia dúzia de comandos e um pouco de paciência e vai-se lá. Usei como base as indicações do ficheiro <a href="https://github.com/qgis/QGIS/blob/master/INSTALL">INSTALL.TXT</a> disponível no código fonte com umas pequenas alterações.</p>

<!-- more -->

<h4>Instalar todas as dependências necessárias</h4>

<p>Num terminal correr o seguinte comando para instalar todas as dependências e ferramentas necessárias à compilação do QGIS. (adicionei o ccmake e o git ao comando original)</p>
<pre>
	sudo apt-get install bison cmake doxygen flex git graphviz grass-dev libexpat1-dev libfcgi-dev libgdal-dev libgeos-dev libgsl0-dev libopenscenegraph-dev libosgearth-dev libpq-dev libproj-dev libqscintilla2-dev libqt4-dev libqt4-opengl-dev libqtwebkit-dev libqwt5-qt4-dev libspatialindex-dev libspatialite-dev libsqlite3-dev lighttpd pkg-config poppler-utils pyqt4-dev-tools python-all python-all-dev python-qt4 python-qt4-dev python-sip python-sip-dev spawn-fcgi txt2tags xauth xfonts-100dpi xfonts-75dpi xfonts-base xfonts-scalable xvfb cmake-curses-gui
</pre>
<h4>Configurar o ccache</h4>
<p>Este passo permite optimizar a compilação e tornar a compilação mais rápida nas próximas vezes que se fizer:</p>
<pre>
	cd /usr/local/bin
	sudo ln -s /usr/bin/ccache gcc
	sudo ln -s /usr/bin/ccache g++
</pre>
<h4> Obter o código fonte do Github</h4>
<p>O código fonte pode ser colocado numa pasta à escolha de cada um. Seguindo a sugestão do ficheiro de instruções acabei por colocar tudo na minha pasta home/alexandre/dev/cpp.</p>
<pre>
	mkdir -p ${HOME}/dev/cpp
	cd ${HOME}/dev/cpp
</pre>
<p>Já dentro da pasta home/alexandre/dev/cpp, podemos obter o código do qgis executando o seguinte comando git:</p>
<pre>
	git clone git://github.com/qgis/QGIS.git
</pre>
<p><strong>Nota:</strong> Se pretendesse fazer alterações ao código e experimentar se funcionava, então deveria fazer o clone do fork do qgis do meu próprio repositório, ou seja:</p>
<pre>
	git clone https://github.com/SrNetoChan/Quantum-GIS
</pre>
<h4>Preparar directorias de compilação e instalação</h4>
<p>O código fonte tem de ser compilado e instalado em locais próprios para evitar conflitos com outras versões do QGIS. Por isso, há que criar uma pasta para efectuar a instalação:</p>
<pre>
	mkdir -p ${HOME}/apps
</pre>
<p>E outra onde será feita a compilação:</p>
<pre>
	cd QGIS
	mkdir build-master
	cd build-master
</pre>
<h4>Configuração</h4>
<P>Já na pasta build-master damos início ao processo de compilação. O primeiro passo é a configuração, onde vamos dizer onde queremos instalar o QGIS master. Para isso executamos o seguinte comando (não esquecer os dois pontos):</P>
<pre>
	ccmake ..
</pre>
<p>Na configuração é necessário alterar o valor do CMAKE_INSTALL_PREFIX que define onde vai ser feita a instalação, no meu caso usei a pasta já criada &#8216;home/alexandre/apps&#8217;. Para editar o valor há que mover o cursor até à linha em causa e carregar em [enter], depois de editar, volta-se a carregar em [enter]. Depois há que carregar em [c] para refazer a configuração e depois em &#8216;g&#8217; para gerar a configuração.</P>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/screenshot-from-2014-10-08-233339.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/screenshot-from-2014-10-08-233339.png"  alt="Menu de configuração">
    </a>
</div>

<h4> Compilação e instalação</h4>
<p>Já com tudo configurado resta compilar o código e depois instalá-lo:</p>
<pre>
	make
	sudo make install
</pre>
<p><strong>Nota:</strong> Estes dois passos podem demorar um bocadinho, principalmente na primeira vez que o código for compilado.</p>

<p>Depois de instalado podemos correr o QGIS master a partir da pasta de instalação:</p>
<pre>
	cd ${HOME}/apps/bin/
	export LD_LIBRARY_PATH=/home/alexandre/apps/lib
	export QGIS_PREFIX_PATH=/home/alexandre/apps
	${HOME}/apps/bin/qgis
</pre>
<p>Para se tornar mais cómodo, podemos colocar os últimos 3 comandos num ficheiro .sh e gravá-lo num local acessível (desktop ou home) para executarmos o qgis sempre que necessário.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/screenshot-from-2014-10-09-003652.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/screenshot-from-2014-10-09-003652.png"  alt="Qgis master a arrancar">
    </a>
</div>

<h4>Actualizar a versão master</h4>
<h4>Como já foi referido num comentário, a versão em desenvolvimento está constantemente a ser alterada, por isso para testar se determinados bugs foram entretanto corrigidos há que a actualizar. Trata-se de um processo bastante simples. O primeiro passo é actualizar o código fonte:</h4>
<pre>
	cd ${HOME}/dev/cpp/qgis
	git pull origin master
</pre>
<p>E depois é voltar a correr a compilação (que desta feita será mais rápida):</p>
<pre>
	cd build-master
	ccmake ..
	make
	sudo make install
</pre>
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/bcce6e29a8bf37a2008f957238d69feb></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Definição De Simbologia Através De Campo RGBA]]></title>
    <link href="http://qgis.pt/2015/09/30/definicao-de-simbologia-atraves-de-campo-rgba/"/>
    <updated>2015-09-30T09:29:19+01:00</updated>
    <id>http://qgis.pt/2015/09/30/definicao-de-simbologia-atraves-de-campo-rgba</id>
    <content type="html"><![CDATA[<p>	Este post aborda o processo de configuração de simbologia através do 
	atributo RGBA, permite ultrapassar uma limitação do QGIS, que se 
	encontra ainda por resolver (<a href="http://hub.qgis.org/issues/11491">http://hub.qgis.org/issues/11491</a>).
	Resultou da necessidade de produzir a simbologia oficial para a carta 
	de ocupação de solos Corine Land Cover (CLC) com base nos valores RGB.</p>

<!-- more -->

<h4>Objetivo inicial:</h4>

<p>	Simbolizar a carta de ocupação de solos Corine Land Cover 2006 
	(CLC2006), por classes utilizando o sistema de cores RGBA.</p>
<p>	A preparação da informação consistiu:</p>
<ol>
	<li>
		União da tabela de atributos da CLC2006 com a tabela da 
		nomenclatura que possuía os valores RGB. (Fig. 1)
		<div class="post-img">
			<a href="http://qgis.pt/blog/images/posts/ms_fig1_unir_camadas.png" rel="prettyPhoto" title="">
				<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig1_unir_camadas.png" width="500"  alt="Unir as camadas">
			</a>
        </div>
    
	</li>
	<li>
		Criação de novo campo denominado <strong>[rbga]</strong> do tipo 
		texto com a concatenação dos campos R, G, B e a criação do parâmetro A 
		(alfa) que corresponde ao grau de opacidade (Fig. 2).
		<div class="post-img">
			<a href="http://qgis.pt/blog/images/posts/ms_fig2_criar_campo_RGBA.png" rel="prettyPhoto" title="">
				<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig2_criar_campo_RGBA.png" width="500"  alt="Unir as camadas">
			</a>
        </div>
		<strong>Nota:</strong> Os valores do campo devem variar entre 
		0 e 255 separados por vírgula, o valor da opacidade é 255 
		para todas as classes (Fig. 3)
		<div class="post-img">
			<a href="http://qgis.pt/blog/images/posts/ms_fig3_tabela_de_atributos.png" rel="prettyPhoto" title="">
				<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig3_tabela_de_atributos.png" width="500"  alt="Unir as camadas">
			</a>
        </div>
	</li>
	<li>
Com a coluna rgba criada na tabela de atributos, procedeu-se à 
	configuração do estilo.
<div class="post-img">
	<a href="http://qgis.pt/blog/images/posts/ms_fig5_configurar_estilo.png" rel="prettyPhoto" title="">
	<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig5_configurar_estilo.png" width="500"  alt="Unir as camadas">
	</a>
</div>
</li>	
</ol>
<h4>Problema</h4>

<p>	O mapa aparece corretamente simbolizado, mas a legenda não reflete 
	as categorias criadas, todas aparecem a negro, não permitindo uma 
	interpretação correta da informação.</p>
<div class="post-img">
	<a href="http://qgis.pt/blog/images/posts/ms_fig6_estilos_a_preto.png" rel="prettyPhoto" title="">
	<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig6_estilos_a_preto.png" width="500"  alt="Unir as camadas">
	</a>
</div>
<p>	Identificou-se que se trata-se de uma limitação do QGIS, que se 
	encontra ainda por resolver (<a href="http://hub.qgis.org/issues/11491">http://hub.qgis.org/issues/11491</a>)</p>

<h4>Solução</h4>

<p>	Criar um script python que faça a associação da cor à classe respetiva.</p>
<p>	Com a ajuda do  Alexandre Neto do grupo de utilizadores do QGIS PT, 
	que produziu o seguinte script, é possível ultrapassar com sucesso 
	o problema. Script disponível <a href="http://qgis.pt/blog/images/dados/script_rgba.py">aqui</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span>
</span><span class='line'>
</span><span class='line'><span class="n">iface</span> <span class="o">=</span> <span class="n">qgis</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">iface</span>
</span><span class='line'><span class="n">mc</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">layer</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">currentLayer</span><span class="p">()</span>
</span><span class='line'><span class="n">features</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
</span><span class='line'>    <span class="n">cat</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&#39;designacao&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">rgba_value</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s">&#39;rbga&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">color_dict</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba_value</span>
</span><span class='line'>
</span><span class='line'><span class="n">renderer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">rendererV2</span><span class="p">()</span>
</span><span class='line'><span class="n">categories</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">categories</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
</span><span class='line'>    <span class="n">value</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
</span><span class='line'>    <span class="n">cat_id</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">categoryIndexForValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">cat_id</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s">u&#39;&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="n">rgba</span> <span class="o">=</span> <span class="n">color_dict</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">rgba</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rgba</span> <span class="p">]</span>
</span><span class='line'>        <span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="n">rgba</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rgba</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">rgba</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">rgba</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">symbol</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>
</span><span class='line'>        <span class="n">symbol</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</span><span class='line'>        <span class="n">renderer</span><span class="o">.</span><span class="n">updateCategorySymbol</span><span class="p">(</span><span class="n">cat_id</span><span class="p">,</span><span class="n">symbol</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mc</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</span><span class='line'><span class="n">qgis</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">legendInterface</span><span class="p">()</span><span class="o">.</span><span class="n">refreshLayerSymbology</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>Procedimentos de utilização do script:</p>
<ol>
	<li>Abrir a consola python (Módulos > Consola Python);</li>
	<div class="post-img">
		<a href="http://qgis.pt/blog/images/posts/ms_fig7_abrir_consola.png" rel="prettyPhoto" title="">
		<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig7_abrir_consola.png" width="500"  alt="Abrir consola">
		</a>
	</div>
	<li>Dentro da consola abrir o script;</li>
	<div class="post-img">
		<a href="http://qgis.pt/blog/images/posts/ms_fig8_carregar_script.png" rel="prettyPhoto" title="">
		<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig8_carregar_script.png" width="500"  alt="Abrir script">
		</a>
	</div>
	<li>Editar as linhas 12 e 13 e adaptar ao nome das colunas relativas 
	ao campo das categorias e ao campo com os valores RBGA. Gravar.</li>
	<div class="post-img">
		<a href="http://qgis.pt/blog/images/posts/ms_fig9_editar_campos_script.png" rel="prettyPhoto" title="">
		<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig9_editar_campos_script.png" width="500"  alt="Editar campos do script">
		</a>
	</div>
	<li>Definir estilo categorizado utilizando o campo respetivo;</li>
	<div class="post-img">
		<a href="http://qgis.pt/blog/images/posts/ms_fig10_atribuir_estilo.png" rel="prettyPhoto" title="">
		<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig10_atribuir_estilo.png" width="500"  alt="Definir estilo categorizado">
		</a>
	</div>
	<li>Desativar a opção Substituir dados definidos;</li>
	<div class="post-img">
		<a href="http://qgis.pt/blog/images/posts/ms_fig11_desligar_data_defined_properties.png" rel="prettyPhoto" title="">
		<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig11_desligar_data_defined_properties.png" width="500"  alt="Desligar o data-defined properties">
		</a>
	</div>
	<li>Correr o script.</li>
	<div class="post-img">
		<a href="http://qgis.pt/blog/images/posts/ms_fig12_correr_script.png" rel="prettyPhoto" title="">
		<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig12_correr_script.png" width="500"  alt="Correr o script">
		</a>
	</div>
</ol>

<h4>Resultado final</h4>
<p>Mapa corretamente simbolizado com a respetiva legenda!</p>
<div class="post-img">
	<a href="http://qgis.pt/blog/images/posts/ms_fig13_resultado_final.png" rel="prettyPhoto" title="">
	<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms_fig13_resultado_final.png" width="500"  alt="Mapa corretamente simbolizado com a respetiva legenda">
	</a>
</div>

<h4>Simbologia CLC2006 em .QML</h4>

<p>Para aqueles que apenas necessitam da legenda da CLC2006, podem 
descarregar <a href="http://qgis.pt/blog/images/dados/CLC2006_oficial.qml">aqui</a> a simbologia no formato qml.</p>
<p>Espero que tenha sido útil, Bom trabalho !</p>
<p>Manuela Sampayo</p>


<h4>REFERÊNCIAS</h4>
<a href="http://www.dgterritorio.pt/cartografia_e_geodesia/cartografia/cartografia_tematica/cartas_de_ocupacao_do_solo/corine_land_cover/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/cartografia/cartografia_tematica/cartas_de_ocupacao_do_solo/corine_land_cover/</a></p>

<div class="post-img">
	<img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/ms.png"  alt="Manuela Sampayo">
</div>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[QGIS: Instalar a Versão De Desenvolvimento E Ajudar Nos Testes]]></title>
    <link href="http://qgis.pt/2015/09/29/qgis-instalar-a-versao-de-desenvolvimento-e-ajudar-nos-testes/"/>
    <updated>2015-09-29T19:06:55+01:00</updated>
    <id>http://qgis.pt/2015/09/29/qgis-instalar-a-versao-de-desenvolvimento-e-ajudar-nos-testes</id>
    <content type="html"><![CDATA[<p>QGIS é um software SIG Open Source que está a ter um sucesso extraordinário e que tem um modelo de desenvolvimento que é o do Open Source em geral, seguindo a regra típica neste casos: &#8221;<i>release early, release often</i>&#8221;. Isso traduz-se em 3/4 versões novas do programa cada ano. O número de versão acaba com um número par no caso das versões estáveis (exemplo: 2.6, 2.8, 2.10, 2.12, etc.) mas existem também versões intermédias, com número de versão que acaba com um número impar (exemplo: 2.7, 2.9, 2.11, 2.13, etc.), as chamadas versões de desenvolvimento ou &#8221;<i>master</i>&#8221; (ou às vezes &#8221;<i>nightly</i>&#8221;), ou seja as versões de QGIS que se irão tornar a próxima versão estável.</p>

<!-- more -->

<p>Estas versões de desenvolvimento são actualizadas diariamente, e podem ser instaladas sem grande problemas pois não causam nenhum conflito com as versões estáveis instaladas no mesmo computador.</p>

<p>Instalar QGIS &#8221;<i>master</i>&#8221; é importante por varias razões:</p>

<ul>
<li>pode haver uma nova funcionalidade que pode ser muito útil no nosso trabalho</li>

<li>pode ser que um bug conhecido já esteja resolvido</li>

<li>usando esta versão participamos de facto na fase de testes das novas versões do QGIS: isso leva a ter versões de QGIS melhores para todos. É particularmente importante na fase chamada &#8221;<i>feature freeze</i>&#8221;, que inicia 1 mês antes da disponibilização da nova versão estável, uma fase onde não são acrescentadas novas funcionalidade e que é completamente dedicada à resolução de bugs.</li>
</ul>

<p>De seguida são descritos os passos para a instalação de QGIS &#8221;<i>master</i>&#8221; em ambiente Windows (quem queira instalar QGIS &#8221;<i>master</i>&#8221; em ambiente Linux pode seguir o <a href="http://qgis.pt/blog/2015/10/01/instalar-duas-versoes-de-qgis-em-linux/">tutorial do Alexandre Neto</a> o usar os <a href="http://qgis.org/en/site/forusers/alldownloads.html#linux">repositórios</a> disponíveis para diferentes distribuições):</p>

<ul>
<li>descarregar o instalador OSGEO4W (<a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe">32 bit</a> ou <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe">64 bit</a>)</li>

<li>correr o instalador, seguir a &#8220;advanced install&#8221;</li>

<li>nos passos seguintes escolher todas as opções por omissão, até chegar a janela &#8220;Select Packages&#8221;</li>

<li>na categoria &#8220;Desktop&#8221; seleccionar para instalação o package &#8220;qgis-dev&#8221;</li>

<li>carregar em &#8220;next&#8221; e finalizar a instalação</li>
</ul>

<!-- Imagem -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/osgeo4w_master2.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/osgeo4w_master2.png" width="500"  alt="QGIS master pronto a usar">
    </a>
</div>

<p>As mesmas operações poderão ser repetidas diariamente, pois todos os dias QGIS &#8221;<i>master</i>&#8221; é actualizado de forma incluir as novas funcionalidades e correcções de bugs feitas nas 24 horas anteriores.</p>

<p>Se usando QGIS master irão encontrar problemas (em modo especial os que não ocorrem nas versões estáveis) sugere-se é que o utilizador relate o mesmo no <a href="http://hub.qgis.org/projects/quantum-gis/issues">QGIS bug tracker</a>.</p>


<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/d87344818a5e1792a1eb6cdd85725f74></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[QGIS: Ajuda, Suporte, Desenvolvimento]]></title>
    <link href="http://qgis.pt/2015/09/29/qgis-ajuda-suporte-desenvolvimento/"/>
    <updated>2015-09-29T15:02:58+01:00</updated>
    <id>http://qgis.pt/2015/09/29/qgis-ajuda-suporte-desenvolvimento</id>
    <content type="html"><![CDATA[Quais os meios/modalidades que os utilizadores QGIS (finais, entidades, empresas) têm a disposição para obter suporte/assistência? Ou ainda como podem criar novas funcionalidades ou resolver bugs? A seguinte apresentação foi feita no <a href="http://osgeopt.pt/sasig2015/">SASIG 2015</a>, o congresso sobre SIG livres da comunidade Portuguesa, com o objectivo de esclarecer as duvidas sobre este assuntos aos muitos utilizadores QGIS presentes no congresso.

<br />

<!-- more -->

<br />

<p align="center">
<iframe frameborder="0" src="http://www.slideshare.net/slideshow/embed_code/key/RoLWXQr3MmT04" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/GiovanniManghi/qgis-ajuda-suporte-desenvolvimento" title="QGIS: ajuda, suporte, desenvolvimento" target="_blank">QGIS: ajuda, suporte, desenvolvimento</a> </strong> from <strong><a href="//www.slideshare.net/GiovanniManghi" target="_blank">Giovanni Manghi</a></strong> </div>
</p>


<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/d87344818a5e1792a1eb6cdd85725f74></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Imprimir E Descarregar Mapas Bing E Google]]></title>
    <link href="http://qgis.pt/2015/09/28/imprimir-e-descarregar-mapas-bing-e-google/"/>
    <updated>2015-09-28T18:30:07+01:00</updated>
    <id>http://qgis.pt/2015/09/28/imprimir-e-descarregar-mapas-bing-e-google</id>
    <content type="html"><![CDATA[<h4>O problema</h4>

<p>O <i>plugin</i> <b><a href="http://plugins.qgis.org/plugins/openlayers_plugin/"> OpenLayers</a></b> do QGIS permite acrescentar nos projectos camadas de fontes tais como Bing e Google: as camadas acrescentadas desta forma são obviamente muito úteis mas este <i>datasources</i> possuem algumas desvantagens:</p>

<!-- more -->

<ul>
<li>nos <i>layouts</i> de impressão, uma vez que os mesmos forem exportados para PDF/imagem (ou impressos em papel) há um desvio entre as imagens e as <i>features</i> raster/vectoriais presentes no projecto</li>

<li>este camadas não podem ser usadas como input para operações de geoprocessamento ou analise</li>

<li>não se pode definir a transparência geral assim como nenhuma outra propriedade das camadas (visibilidade baseada em escala, transparência de pixeis com valor especifico, etc.)</li>
</ul>

<!-- Imagem -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/desvio.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/desvio.jpg" width="500"  alt="Desvio provocado pelo plugin OpenLayers">
    </a>
</div>

<h4>A solucão</h4> 

<ul>
<li><b>Não usar o plugin OpenLayers</b></li>

<li>Gravar os seguintes ficheiros xml (carregar no link com o botão direito do rato &#8220;gravar link como&#8221;). A seguir acrescentar este ficheiros/camadas no QGIS como se fossem <i>rasters</i>:</li>
<ul>
<li><a href="http://www.gdal.org/frmt_wms_virtualearth.xml">http://www.gdal.org/frmt_wms_virtualearth.xml</a></li>

<li><a href="http://www.gdal.org/frmt_wms_googlemaps_tms.xml">http://www.gdal.org/frmt_wms_googlemaps_tms.xml</a></li>
</ul>
</ul>

<p>O primeiro link é o <i>datasource</i> para as imagens Bing Maps/Virtual Earth e pode ser usado directamente. O segundo link é o <i>datasource</i> para camadas Google. Este ficheiro deverá ser editado com um editor de texto para: 1) mudar o CRS de 900913 para 3857, 2) escolher a camada Google que se pretende visualizar. Por exemplo o ficheiro deverá ser editado da seguinte forma para visualizar as imagens de satélite/aéreas:
</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;GDAL_WMS&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- Data is subject to term of use detailed at http://code.google.com/intl/nl/apis/maps/terms.html and</span>
</span><span class='line'><span class="c">     http://www.google.com/intl/en_ALL/help/terms_maps.html --&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;Service</span> <span class="na">name=</span><span class="s">&quot;TMS&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="c">&lt;!-- &lt;ServerUrl&gt;http://mt.google.com/vt/lyrs=m&amp;amp;x=${x}&amp;amp;y=${y}&amp;amp;z=${z}&lt;/ServerUrl&gt;--&gt;</span> <span class="c">&lt;!-- Map --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;ServerUrl&gt;</span>http://mt.google.com/vt/lyrs=s<span class="ni">&amp;amp;</span>x=${x}<span class="ni">&amp;amp;</span>y=${y}<span class="ni">&amp;amp;</span>z=${z}<span class="nt">&lt;/ServerUrl&gt;</span> <span class="c">&lt;!-- Satellite --&gt;</span>
</span><span class='line'>        <span class="c">&lt;!-- &lt;ServerUrl&gt;http://mt.google.com/vt/lyrs=y&amp;amp;x=${x}&amp;amp;y=${y}&amp;amp;z=${z}&lt;/ServerUrl&gt; --&gt;</span> <span class="c">&lt;!-- Hybrid --&gt;</span>
</span><span class='line'>        <span class="c">&lt;!-- &lt;ServerUrl&gt;http://mt.google.com/vt/lyrs=t&amp;amp;x=${x}&amp;amp;y=${y}&amp;amp;z=${z}&lt;/ServerUrl&gt; --&gt;</span> <span class="c">&lt;!-- Terrain --&gt;</span>
</span><span class='line'>        <span class="c">&lt;!-- &lt;ServerUrl&gt;http://mt.google.com/vt/lyrs=p&amp;amp;x=${x}&amp;amp;y=${y}&amp;amp;z=${z}&lt;/ServerUrl&gt; --&gt;</span> <span class="c">&lt;!-- Terrain, Streets and Water  --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Service&gt;</span>
</span><span class='line'>    <span class="nt">&lt;DataWindow&gt;</span>
</span><span class='line'>        <span class="nt">&lt;UpperLeftX&gt;</span>-20037508.34<span class="nt">&lt;/UpperLeftX&gt;</span>
</span><span class='line'>        <span class="nt">&lt;UpperLeftY&gt;</span>20037508.34<span class="nt">&lt;/UpperLeftY&gt;</span>
</span><span class='line'>        <span class="nt">&lt;LowerRightX&gt;</span>20037508.34<span class="nt">&lt;/LowerRightX&gt;</span>
</span><span class='line'>        <span class="nt">&lt;LowerRightY&gt;</span>-20037508.34<span class="nt">&lt;/LowerRightY&gt;</span>
</span><span class='line'>        <span class="nt">&lt;TileLevel&gt;</span>20<span class="nt">&lt;/TileLevel&gt;</span>
</span><span class='line'>        <span class="nt">&lt;TileCountX&gt;</span>1<span class="nt">&lt;/TileCountX&gt;</span>
</span><span class='line'>        <span class="nt">&lt;TileCountY&gt;</span>1<span class="nt">&lt;/TileCountY&gt;</span>
</span><span class='line'>        <span class="nt">&lt;YOrigin&gt;</span>top<span class="nt">&lt;/YOrigin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/DataWindow&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Projection&gt;</span>EPSG:3857<span class="nt">&lt;/Projection&gt;</span>
</span><span class='line'>    <span class="nt">&lt;BlockSizeX&gt;</span>256<span class="nt">&lt;/BlockSizeX&gt;</span>
</span><span class='line'>    <span class="nt">&lt;BlockSizeY&gt;</span>256<span class="nt">&lt;/BlockSizeY&gt;</span>
</span><span class='line'>    <span class="nt">&lt;BandsCount&gt;</span>3<span class="nt">&lt;/BandsCount&gt;</span>
</span><span class='line'>    <span class="nt">&lt;MaxConnections&gt;</span>5<span class="nt">&lt;/MaxConnections&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Cache</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/GDAL_WMS&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>As camadas acrescentadas desta forma são <i><b>rasters</b></i> WMS, sendo portanto possível: visualizar a escalas arbitrarias, reprojectar, mudar transparência, configurar a visibilidade baseada em escalas, etc.</p>

<p>O mais importante é que estas camadas <b>não irão criar problemas de desvios quando usadas no <i>print composer</i> do QGIS.</b></p>

<!-- Imagem -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/certo.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/certo.jpg" width="500"  alt="Problema resolvido usando os datasource WMS da biblioteca GDAL">
    </a>
</div>

<h4>Notas:</h4>

<ul>
<li>o sistema de coordenadas deste camadas é o com código <b>EPSG 3857</b>, ou seja <i>Google Mercator</i></li>

<li>a resolução deste camadas é respectivamente: Google Satellite: <b>15cm</b> , Bing Aerial: <b>30cm</b></li>

<li>o QGIS permite fazer a operação <i>save as</i> (&#8220;gravar como&#8221;) também para camadas <i>rasters</i>. Isso significa que é possível gravar localmente (sob forma de ficheiros GeoTIFF) mapas com imagens Google/Bing (gravar localmente  desta forma áreas grandes com resolução elevada irá significar tempos de processamento muito compridos).</li>

<li>ler com <b>atenção</b> as condições de uso deste provedores de dados. O autor e o grupo QGIS-PT não se responsabilizam para o uso impróprio deste mapas</li>

<li>para mais informações: <a href="http://www.gdal.org/frmt_wms.html">http://www.gdal.org/frmt_wms.html</a></li>

</ul>

<!-- Imagem -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/raster_save_as.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/raster_save_as.png" width="500"  alt="Operação save as rasters no QGIS">
    </a>
</div>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/d87344818a5e1792a1eb6cdd85725f74></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mostrar Automáticamente O SRC Do Projecto Numa Etiqueta Do Compositor De Impressão]]></title>
    <link href="http://qgis.pt/2015/09/27/mostrar-dinamicamente-o-src-do-projecto-numa-etiqueta/"/>
    <updated>2015-09-27T08:43:18+01:00</updated>
    <id>http://qgis.pt/2015/09/27/mostrar-dinamicamente-o-src-do-projecto-numa-etiqueta</id>
    <content type="html"><![CDATA[<p>Este artigo mostra como podemos mostrar automaticamente o sistema de coordenadas do projecto numa etiqueta da compositor de impressão do QGIS.</p>

<h4>O problema</h4>
<p>No QGIS por vezes precisamos de exportar mapas que mostrem o sistema de coordenadas do projecto.</p>

<!-- more -->

<p>Actualmente o QGIS não tem uma função que permita inserir no compositor de impressão o SRC do projecto. Nestas situações recorre-se à introdução manual do sistema de coordenadas numa etiqueta, mas este método por vezes não é prático, pois no caso de se usarem templates de impressão, esta etiqueta deverá ser alterada manualmente caso o SRC do projecto mude.</p>

<h4>A solução</h4>
<p>Com o seguinte código é criada uma função que permite a actualização automática do SRC numa etiqueta do compositor de impressão. O código pode ser executado na consola python do QGIS ou pode ser gravado num ficheiro .py a seguir colocado na pasta &#8220;.qgis2&#8221; do QGIS.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">crs</span><span class="o">=</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">mapSettings</span><span class="p">()</span><span class="o">.</span><span class="n">destinationCrs</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="n">crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span> <span class="o">+</span><span class="s">&#39; - &#39;</span><span class="o">+</span> <span class="n">crs</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

<p>O código da função pode ser introduzido no separador &#8220;Editor de Funções&#8221; da calculadora de campos do QGIS (que permite atribuir um nome à função). Em alternativa copie o ficheiro <a href="http://qgis.pt/blog/images/dados/crs.py">crs.py</a> na pasta /.qgis2/python/expressions - reinicie o QGIS, e a nova função estará num novo grupo &#8220;CRS&#8221; da calculadora de campos.</p>


<!-- Imagem do Editor de funções -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/crs_field_calculator.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/crs_field_calculator.png" width="500"  alt="Editor de Funções">
    </a>
</div>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">qgis.utils</span> <span class="kn">import</span> <span class="n">iface</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@qgsfunction</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s">&#39;CRS&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">crslabel</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span><span class="n">feature</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Returns the project CRS </span>
</span><span class='line'><span class="sd">    </span>
</span><span class='line'><span class="sd">    &lt;h4&gt;Syntax&lt;/h4&gt;</span>
</span><span class='line'><span class="sd">    &lt;p&gt;crslabel(&lt;i&gt;value&lt;/i&gt;)&lt;/p&gt;</span>
</span><span class='line'><span class="sd">    &lt;h4&gt;Arguments&lt;/h4&gt;</span>
</span><span class='line'><span class="sd">    &lt;p&gt;&lt;i&gt;none&lt;/i&gt; &amp;rarr; 0&lt;/p&gt;</span>
</span><span class='line'><span class="sd">    &lt;h4&gt;Example&lt;/h4&gt;</span>
</span><span class='line'><span class="sd">    &lt;p&gt;&lt;!-- Show example of function.--&gt;</span>
</span><span class='line'><span class="sd">    crslabel &amp;rarr; EPSG:4326 - WGS84&lt;/p&gt;</span>
</span><span class='line'><span class="sd">    &lt;h4&gt;Note:&lt;/h4&gt;</span>
</span><span class='line'><span class="sd">    &lt;p&gt;This function only produces the EPSG code and the description.</span>
</span><span class='line'><span class="sd">    &lt;/p&gt;</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="n">crs</span><span class="o">=</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">mapSettings</span><span class="p">()</span><span class="o">.</span><span class="n">destinationCrs</span><span class="p">()</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span> <span class="o">+</span><span class="s">&#39; - &#39;</span><span class="o">+</span> <span class="n">crs</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>
<p></p>

<!-- Resultado no Compositor de mapas -->
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/crs_composer_layout.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/crs_composer_layout.png" width="500"  alt="Função aplicada no compositor de mapas">
    </a>
</div>

<p>Veja aqui a função em acção:</p>
<!-- Vídeo a mostrar a funcionalidade -->
<p align="center"><iframe frameborder="0" src="https://drive.google.com/file/d/0B98hU-Ebn7VvckRzWTl2WjQ0R3c/preview" width="640" height="480"></iframe></p>

<h4>Problemas encontrados</h4>
<p>Se o projecto for configurado de forma a usar um SRC personalizado e este não tiver um nome associado então na etiquetas serão mostrados os parametros PROJ4 do SRC. Além disso em vez de aparecer &#8220;ESPG:&#8221; irá aparece &#8220;USER:&#8221;. A possível solução poderá passar por remover o <i>crs.auth.id()</i> da função e deixar apenas a descrição do sistema de coordenadas.</p>

<h4>Notas Futuras</h4>
<p>Pretendo enviar esta função para o projecto QGIS de forma a ser integrada no conjunto de expressões disponíveis por defeito. Gostava ainda de adicionar outras funções que permitam adicionar informações para além do CRS. Eventualmente este tipo de funcionalidade poderá se tornar um botão/painel dentro do compositor impressão.</p>

<h4>Considerações Finais e Agradecimentos</h4>
<p>Este código foi escrito durante o Encontro de Programadores QGIS realizado em <a href="https://qgis2015.wordpress.com/">Nødebo, Dinamarca</a>. O espírito de equipa e a capacidade de entreajuda são coisas fortes nesta comunidade. Quero agradecer ao Raymond Nijssen, Nyall Dawson e Matthias Khun pelas orientações e dicas que me deram durante o encontro de programadores.
</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/0edb9f3a1e5191476215ce32183d80a4></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Plugin refFunctions]]></title>
    <link href="http://qgis.pt/2015/05/06/plugin-reffunctions/"/>
    <updated>2015-05-06T07:24:31+01:00</updated>
    <id>http://qgis.pt/2015/05/06/plugin-reffunctions</id>
    <content type="html"><![CDATA[<p>Este tutorial pretende exemplificar como é possível utilizar operações espaciais no QGIS para preencher um campo na tabela de atributos com informação retirada da relação espacial existente
entre dois layers.<!-- more --> Isso é possível com recurso ao plugin <a href="http://planet.qgis.org/plugins/refFunctions/" target="_blank"><i><b>refFunctions</b></i></a>.</p>

<p>Vamos então supor que temos um layer de pontos referentes aos clientes de uma empresa e um layer de polígonos com os limites de território de cada loja da empresa. O objetivo é então criar e preencher um determinado campo da tabela de atributos dos pontos, fazendo uso do posicionamento espacial existente entre cada um e o polígono onde está inserido.</p>

<h4>1º Instalação do Plugin</h4>
<ul>
    <li>No menu <i><b>Plugins</b></i>, escolher a opção <i><b>Manage and Install Plugins</b></i></li>
    <li>Pesquise o plugin <i><b>refFunctions</b></i> e proceda à sua instalação</li>
</ul>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/install_plugin.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/install_plugin.png" width="500"  alt="Pesquisa do plugin">
    </a>
</div>

<h4>2º Utilização do Plugin</h4>
<ul>
    <li>Abra a tabela de atributos do layer de pontos e coloque em modo de edição</li>
    <li>Aceda ao <i><b>Field Calculator</b></i></li>
	<li>Na seção <i><b>Create a new field</b></i>, crie um novo campo segundo as suas necessidades</li>
	<li>Agora na seção central onde estão listadas todas as categorias de funções, irá encontrar uma nova entrada, designada por <i><b>Reference</b></i>. Das opções existentes, efetue duplo clique sobre a função <i><b>geomintersects</b></i></li>
	<li>Segundo a sintax que é mostrado no help da função, teremos de definir o layer e o campo alvo onde se irá buscar a informação para preencher o nosso campo. Neste exemplo, será então o layer Lojas e o campo Loja</li>
	<li>Por fim, mande correr o processo, o qual poderá demorar ou não em função da quantidade de objectos geográficos que os layers possuem</li>
</ul>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/field_calculator.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/field_calculator.png" width="500"  alt="Utilização da função geomintersects do plugin">
    </a>
</div>
<ul>
    <li>Após a conclusão deste processo, o resultado será então a criação do novo campo, preenchido com indicação da loja em que cada ponto está inserido</li>
</ul>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/attributes.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/attributes.png" width="500"  alt="Resultado na tabela de atributos">
    </a>
</div>

<p></p>
<p>Para mais informação sobre o plugin, <a href="https://geogear.wordpress.com/2014/11/13/reffunctions-v1-0/" target="_blank">https://geogear.wordpress.com/2014/11/13/reffunctions-v1-0/</a></p>

<p>Esperamos que esta dica vos seja de ajuda. Caso tenha dúvidas, não hesite em usar a <i>mailing list qgis-pt</i> para as esclarecer.</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/05f6bd472ad4f53459ea278dda190b6f></img>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Participação No Hackfest Do QGIS]]></title>
    <link href="http://qgis.pt/2014/10/04/participacao-no-hackfest-do-qgis/"/>
    <updated>2014-10-04T09:28:33+01:00</updated>
    <id>http://qgis.pt/2014/10/04/participacao-no-hackfest-do-qgis</id>
    <content type="html"><![CDATA[<p>Alguns membros integrantes do Grupo de Utilizadores QGIS PT deslocaram-se a Essen para participar na 12ª Developer Meeting do QGIS. <!-- more --> O ambiente que aqui se vive é, de facto,
   algo de extraordinário e muito especial. Deslocaram-se para este encontro cerca de 30 pessoas que de uma forma aberta e colaborativa se encontram a estabilizar a próxima versão do QGIS e a
   preparar toda a documentação adicional necessária (manual, site, &#8230;). A troca de experiências e <i>know-how</i> impera nas várias salas onde o pessoal se encontra arduamente a trabalhar (embora
   não haja horários definidos, regra geral, começa-se por volta das 9 horas da manhã e termina-se entre as 22 e 24 horas para os mais entusiasmados).
</p>

<p>O local escolhido para realização deste <i>hackfest</i> foi Essen na Alemanha num pequeno e excelente hotel que conseguiu muito facilmente colocar um grande sorriso em todos os seus 
   participantes. Nada mais, nada menos que o <b><i>LinuxHotel</i></b> (<a href="http://www.linuxhotel.de/" target="_blank">http://www.linuxhotel.de/</a>). Como poderão imaginar,
   existem muitos e simpáticos pinguins espalhados por estas bandas. Da nossa parte, ficámos todos encantados com o local e por isso não queríamos deixar de partilhar com a restante comunidade
   portuguesa algumas fotos obtidas nos útlimos dias. Nenhuma delas transmite verdadeiramente o que aqui se vive, mas ainda assim, permitem passar uma ideia aproximada.
</p>

<br />

<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
    <li data-target="#carousel-example-generic" data-slide-to="3"></li>
    <li data-target="#carousel-example-generic" data-slide-to="4"></li>
    <li data-target="#carousel-example-generic" data-slide-to="5"></li>
    <li data-target="#carousel-example-generic" data-slide-to="6"></li>
    <li data-target="#carousel-example-generic" data-slide-to="7"></li>
    <li data-target="#carousel-example-generic" data-slide-to="8"></li>
    <li data-target="#carousel-example-generic" data-slide-to="9"></li>
    <li data-target="#carousel-example-generic" data-slide-to="10"></li>
  </ol>

  <!-- Wrapper for slides -->
  <div class="carousel-inner">
    <div class="item active fixed-height">
      <img src="http://qgis.pt/blog/images/posts/linuxhotel.jpg" alt="...">
      <div class="carousel-caption">
        Linux Hotel
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/panoramica.jpg" alt="...">
      <div class="carousel-caption">
        Vista panorâmica do hotel
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/tugateam.jpg" alt="...">
      <div class="carousel-caption">
        Equipe Tuga
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/tuxsofa.jpg" alt="...">
      <div class="carousel-caption">
        Tux no sofá
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/jantar.jpg" alt="...">
      <div class="carousel-caption">
        Jantar
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/coding_1.jpg" alt="...">
      <div class="carousel-caption">
        Bug fixing, bug fixing, bug fixing &#8230;
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/coding_2.jpg" alt="...">
      <div class="carousel-caption">
        Bug fixing, bug fixing, bug fixing &#8230;
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/coding_3.jpg" alt="...">
      <div class="carousel-caption">
        Já é tarde, mas ainda se resolvem bugs à luz do candeeiro no jardim 
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/giotux.jpg" alt="...">
      <div class="carousel-caption">
        Grandes amigos!!!
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/aspirador.jpg" alt="...">
      <div class="carousel-caption">
        Hora da limpeza - <b>YES IT RUNS WITH LINUX</b>
      </div>
    </div>
    <div class="item fixed-height">
      <img src="http://qgis.pt/blog/images/posts/beer.jpg" alt="...">
      <div class="carousel-caption">
        Descontração
      </div>
    </div>
  </div>
</div>
<br />

<p>Os elementos do Grupo de Utilizadores QGIS PT têm estado activos em diferentes áreas:</p>
<ul>
    <li><b>Alexandre Neto</b>: <i>screenshots</i> para o site oficial e documentação; desenvolvimento de <i>plugins</i></li>
    <li><b>André Mano</b>: actualização do manual do utilizador</li>
    <li><b>Giovanni Manghi</b>: testes, identificação e reporte de novos <i>bugs</i></li>
    <li><b>Hugo Martins</b>: desenvolvimento de <i>plugins</i> para o grupo (iGeo Loader)</li>
</ul>

<h3><b>iGeo Loader</b> - novo <i>plugin</i> do Grupo QGIS PT em desenvolvimento</h3>
<p>O <a href="http://www.igeo.pt" target="_blank">Portal iGeo</a> foi lançado recentemente, agregando num único portal uma grande variedade se serviços abertos de dados georeferenciados
   provenientes de várias instituições portuguesas. Todos estes serviços são disponibilizados de acordo com normas <i>standard</i> definidas pelo <a href="http://www.opengeospatial.org/" target="_blank">OGC</a>,
   mais especificamente nos formatos WMS (Web Map Service) e WFS (Web Feature Service). Depois de algumas conversas entre utilizadores do grupo, pensámos que seria uma boa ideia, providenciar um <i>plugin</i>
   em QGIS que facilitasse a pesquisa e o carregamento desses dados no nosso SIG Desktop favorito. Pareceu-nos que o encontro de <i>developers</i> seria o momento ideal para começarmos o desenvolvimento
   deste <i>plugin</i>. Estamos em pleno desenvolvimento e, muito provavelmente, este <i>plugin</i> não estará pronto até ao fim do encontro, mas queremos partilhar convosco este nosso projecto e
   e deixar duas pequenas imagens que descrevem de forma muito simples o futuro do <i>plugin</i>.
</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/mockup.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/mockup.png" width="500"  alt="Planeamento da interface gráfica">
    </a>
</div>

<p class="img-leg">Planeamento da interface gráfica</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/plugin-screenshot.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/plugin-screenshot.png" width="500"  alt="Estado actual do iGeo Loader">
    </a>
</div>

<p class="img-leg">Estado actual do iGeo Loader</p>

<p>Esperamos que tenham gostado das novidades que vos apresentámos hoje! Para nós têm sido uns dias fantásticos no seio da comunidade <i>developer</i> do QGIS. Ainda não acabou
   e já estamos a pensar qual o próximo evento para podermos rever caras e contribuir <i>loucamente</i> para este fantástico projecto.
</p>
<p>Saudações geográficas!</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/5ac74272f140db2ce94bdc51869e3168></img>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Utilização De Ferramentas Opensource Para a Caracterização De Uma Paisagem. O Módulo LecoS Do QGIS]]></title>
    <link href="http://qgis.pt/2014/08/14/utilizacao-de-ferramentas-opensource-para-a-caracterizacao-de-uma-paisagem-o-modulo-lecos-do-qgis/"/>
    <updated>2014-08-14T20:03:25+01:00</updated>
    <id>http://qgis.pt/2014/08/14/utilizacao-de-ferramentas-opensource-para-a-caracterizacao-de-uma-paisagem-o-modulo-lecos-do-qgis</id>
    <content type="html"><![CDATA[<p>Este trabalho resulta de parte do projecto final da Pós-Graduação Executiva em Sistemas de Informação Geográfica leccionado pela Geopoint. <!-- more --> Propôs-se estudar uma paisagem para usar o módulo Landscape Ecology (LecoS) no Qgis 2.01 Dufour.</p>
<p>A área de estudo é o Concelho de Coimbra, com uma área total de aproximadamente 31940ha, situada na região Centro de Portugal, com coordenadas geográficas 40°12&#8217;11.84&#8221;Norte e   8°24&#8217;37.15&#8221; Oeste. Atualmente dividida em 18 freguesias por força da nova reorganização administrativa, sendo estas maioritariamente de cariz urbano (Figura 1).</p>
<p></p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/Map.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/Map.png" width="500"  alt="Figura 1 - Localização geográfica do Concelho de Coimbra">
    </a>
</div>
<p></p>
<p>A caracterização de uma paisagem é levada a cabo usando índices quantitativos designados por métricas da paisagem. Estes índices são depois utilizados para descrever as características estruturais da paisagem, para documentar a mudança ou a sua relação com a ocorrência de várias espécies ou grupo de espécies (Turner <i>et al.</i>, 2001; Olsen <i>et al.</i>, 2007; Fidalgo <i>et al.</i>, 2009). O número de métricas é enorme, podendo ser calculado ao nível da paisagem, da classe e da mancha (Turner <i>et al.</i>, 2001; Fidalgo <i>et al.</i>, 2009).</p>
<p>As métricas podem ser calculadas a partir da Corine Land Cover, da Carta de Ocupação do solo (COS 90 e COS2006) ou de mapas de Uso/Ocupação do solo por nós produzidas. Segundo Martin Jung (2012), o Landscape Ecology Stistics (LecoS) é um módulo do Qgis que serve para calcular métricas da paisagem em camadas raster. O resultado pode ficar disponível em formato <i>CSV</i>.</p>
<p></p>
<h3>Metodologia</h3>
<p>Para calcular as métricas da paisagem utilizaram-se as coberturas da Corine Land Cover (CLC) dos anos 1990 e 2006. Para o efeito houve a necessidade de transformar as coberturas em formato raster através da ferramenta r.to.raster do módulo GRASS GIS das ferramentas de processamento, tendo em conta a classificação do nível 1 da Corine Land Cover e posteriormente utilizou-se o módulo LecoS do QGIS usando o modelador gráfico (Figura 2).</p>
<p></p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/Metricas_1990.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/Metricas_1990.png" width="500"  alt="Figura 2 - Modelo para o cálculo das métricas da paisagem no ano 1990.">
    </a>
</div>
<p></p>
<p>As métricas calculadas foram a Área de cada uso do solo (Land Cover), a Proporção que cada uso tem na paisagem (Landscape Proportion), a densidade de orlas (Edge density),  Número de manchas (Number of Patches), Área da mancha maior, Área da mancha mais pequena, distância média entre manchas (Mean patch distance) e o tamanho efectivo da malha (effective meshsize) (Tabela 1). Quanto às medidas de diversidade da paisagem calculadas foram o índice de Shannon, Uniformidade e o Índice de Simpson.</p>
<p></p>
<h3>Resultados</h3>
<p>Da análise efectuada às métricas da paisagem calculadas constata-se que houve um aumento do grau de antropização e por consequência uma maior fragmentação de usos entre 1990 e 2006. O número de manchas de Florestas e meios naturais e semi-naturais e as Áreas Agricolas e Agro-Florestais diminuiram entre 1990 e 2006  (Tabela 1). Esta métrica pode dar-nos indicações sobre alguns processos ecológicos incrementando ou diminuindo relações entre populações e habitats (Viana e Aranha, 2008).</p>
<p>De salientar também a distância média entre manchas, uma das medida que nos permite entender o grau de fragmentação da paisagem, a diminuição das Florestas e meio naturais e semi-naturais de 1990 para 2006 em detrimento do aumento dos territórios artificializados (Tabela 1).</p>
<p></p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/Table_Landscape_Metrics.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/Table_Landscape_Metrics.jpg" width="500"  alt="Tabela 1 - Métricas da paisagem calculadas para as coberturas do uso do solo em 1990 e 2006.">
    </a>
</div>
<p></p>
<p>De 1990 para 2006 aumentou a diversidade, no entanto sabe-se que este resultado está directamente relacionado com a transferência entre os usos, nomeadamente a perda de áreas Agrícolas e Agro-Florestais e Florestas e meios naturais e semi-naturais. O mesmo aconteceu com a Uniformidade.</p>
<p></p>
<h3>Conclusões</h3>
<p></p>
<p>Foi possível determinar as métricas da paisagem recorrendo ao módulo <i>LecoS</i> constatando-se que a área de estudo apresenta problemas de fragmentação devido ao elevado grau de antropização.</p>
<p>O QGIS revelou-se bastante intuitivo e muito prático no cálculo das métricas da paisagem não existindo qualquer tipo de constrangimento. É de facto uma solução robusta e viável comparativamente com os softwares proprietário.</p>
<p>No futuro pretende-se aplicar este método a áreas que tenham problemas com espécies invasoras para estudar o seu comportamento na paisagem.</p>
<p></p>
<h4>Referências</h4>
<p>[1] Fidalgo, B., R. Salas, et al. (2009). &#8220;Estimation of plant diversity in a forested mosaic landscape: the role of landscape, habitat and patch features.&#8221; Revista Latinoamericana de Recursos Naturales 5 (2): 65-73.</p>
<p>[2] Viana, Hélder; Aranha, José (2008) - Estudo da alteração da cobertura do solo no Parque Nacional da Peneda Gerês (1995 e 2007). Análise temporal dos padrões espaciais e avaliação quantitativa da estrutura da paisagem. X Encontro de Utilizadores de Sistemas de Informação Geográfica, 14 a 16 de Maio de 2008 – Oeiras.</p>
<p>[3] Martin Jung (2012) LecoS - A QGIS plugin to conduct landscape ecology statistics, <a class="wrap-url" href="http://www.w3schools.com/" target="_blank">http://plugins.qgis.org/plugins/LecoS.</a></p>
<p>[4] Olsen, L., V. Dale, et al. (2007). &#8220;Landscape patterns as indicators of ecological change at Fort Benning, Georgia, USA.&#8221; Landscape and urban planning 79: 137-149.</p>
<p>[5] Turner, M. G., R. Gardner, et al. (2001). Landscape ecology in theory and practice: pattern and process. New York.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[QGIS E O Software Estatístico R]]></title>
    <link href="http://qgis.pt/2014/08/14/qgis-e-o-software-estatistico-r/"/>
    <updated>2014-08-14T16:05:24+01:00</updated>
    <id>http://qgis.pt/2014/08/14/qgis-e-o-software-estatistico-r</id>
    <content type="html"><![CDATA[<p>
    Caros Utilizadores, graças a interoperabilidade do QGIS actualmente podemos associar o QGIS com o software estatístico open source R. O R é muito versátil e é expansível para outras 
    linguagens sendo normalmente utilizado em estatística e análise de dados (data mining). <!-- more -->
</p>
<p>
    O objectivo deste artigo é explicar a sua instalação, configuração com o QGIS, compreensão da nomenclatura e a demonstração de um pequeno exemplo. Espero que seja útil para a vossa 
    rotina diária.
</p>
<p>Este artigo foi elaborado tendo como base o SO Windows 7 64-bits com o Instalador OSGeo4W 32-bits QGIS Chugiak 2.4  e o software R 3.1.1.</p>


<h3>Instalação</h3>
<p>
    Para começarmos a usar o R com o QGIS é necessário fazer a sua transferência. Pode efectuá-la através de um dos vários <i>mirrors</i> (servidores) disponíveis do projecto. Para este artigo, 
    usámos o servidor da Faculdade de <a href="http://cran.dcc.fc.up.pt/" target="_blank">Ciências da Universidade do Porto</a>. Estando neste página escolha o link que diz 
    <a href="http://cran.dcc.fc.up.pt/bin/windows/" target="_blank">Download for Windows</a> (a opção base). Em seguida, use o link base e transfira o R clicando no link 
    <a href="http://cran.dcc.fc.up.pt/bin/windows/base/R-3.1.1-win.exe" target="_blank">Download R 3.1.1 for Windows</a> (Figura 1).
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura1_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura1_r.jpg" width="500"  alt="Área de transferência do software R">
    </a>
</div>
<p class="img-leg">Figura 1 - Área de transferência do software R</p>

<h3>Configuração com o QGIS</h3>
<p>
    Após a instalação do R no seu computador, é necessário que indique ao QGIS onde é o directório do R. Para isso, tem de ir ao menu Processamento > Opções e configuração (Figura 2).
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura2_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura2_r.jpg" width="200"  alt="Menu Processamento">
    </a>
</div>
<p class="img-leg">Figura 2 - Menu Processamento</p>


<p>
    Aparecerá uma janela de diálogo denominada de opções de processamento, onde deverá expandir a opção de <b>Fornecedores</b>, e em seguida as opções do separador R scripts (Figura 3). 
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura3_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura3_r.jpg" width="500"  alt="Opções e Configurações do Menu Processamento">
    </a>
</div>
<p class="img-leg">Figura 3 - Opções e Configurações do Menu Processamento</p>

<p>O caminho padrão usado normalmente é o <i>C:\Program Files\R\R-3.1.1\</i></p>

<p>
    Após inserir o directório poderá dizer ao QGIS se pretende ou não usar a versão de 64 bits. Para finalizar clique na opção <b>Activate</b>. No caso do <i>R scripts folder</i> (pasta dos 
    seus scripts R) deixe o directório padrão.
</p>

<p>
    Concluída esta configuração, conseguirá ver no menu processamento as ferramentas relacionadas com o R. Dentro dessas ferramentas existem alguns <i>scripts</i> criados por utilizadores 
    e que vêm por defeito na instalação do QGIS. Para criar o seu próprio script R, vá a <b>R Scripts</b>, clique em <b>Tools</b> e <b>Create New Script R</b> (Figura 4).
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura4_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura4_r.jpg" width="300"  alt="Janela de criação do Script R">
    </a>
</div>
<p class="img-leg">Figura 4 - Janela de criação do Script R</p>

<p>
    Ao clicar na ferramenta <b>Create New Script R</b>, aparecerá uma janela de diálogo onde poderá começar a escrever o seu código. Na figura 5, é apresentada a janela de diálogo do 
    <i>script</i> e os seus respectivos botões.
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura5_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura5_r.jpg" width="500"  alt="Janela de diálogo do Script">
    </a>
</div>
<p class="img-leg">Figura 5 - Janela de diálogo do Script (1 – Guardar ; 2 – Guardar como; 3 – Editar ajuda do script; 4 – Correr Algoritmo; 5 – Cortar; 6 – Copiar; 7- Botões de Desfazer e Refazer)</p>


<p>
    Uma das coisas interessantes deste menu processamento, é a possibilidade de criarmos um separador ajuda que vai acompanhado com o <i>script</i> depois de ser guardado. Isto 
    permite aos outros utilizadores perceberem qual a finalidade do <i>script</i> (Figura6).
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura6_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura6_r.jpg" width="500"  alt="Janela Ajuda do Script">
    </a>
</div>
<p class="img-leg">Figura 6 - Janela Ajuda do Script</p>

<h3>Criar a ponte entre o QGIS e o Script R</h3>
<p>
    Actualmente existe um conjunto de código base para que os scripts sejam interpretados no QGIS e no menu Processamento, e que iremos descrever a seguir:
    <ul>
        <li><b>#</b> → Serve para declarar um comentário (útil para programadores que querem perceber o código)</li>
        <li><b>##</b> → Declara uma variável (todas as linhas começam com duplo cardinal)</li>
        <li><b>##QGIS-PT=group</b> → Declaração do grupo onde se insere o algoritmo</li>
        <li><b>##nome_variavel=vector</b> → Declaração de uma variável tipo vector, se no seu caso for um raster basta substituir vector por raster</li>
        <li><b>##atributo_da_tabela=Field Layer</b> → Declaração de uma variável que usa um atributo de uma camada</li>
    </ul>
</p>
<p>
    Podemos também indicar que tipo de variável esperamos:
    <ul>
        <li><b>##nome_variavel=string</b> → Declaração da variável como sendo uma cadeia de texto</li>
        <li><b>##nome_variavel=number</b> → Declaração da variável como sendo do tipo número</li>
        <li><b>##nome_variavel=boolean</b> → Declaração da variável como sendo do tipo booleano</li>
        <li><b>library(&#8216;gdal&#8217;)</b> → Declara que packages R são necessários para correr o script R. <i>Nota</i>: se um pacote exigido pelo <i>script</i>não estiver instalado na directoria do R,
               o QGIS vai automaticamente descarregá-lo à internet (através do software R). Se não tiver permissões de administrador na pasta do R ou não tiver uma ligação à internet poderá 
               não conseguir instalar os pacotes necessários e ocorrerá um erro de escução do <i>script</i>, podendo resultar em saídas em branco.</li>
    </ul>
</p>

<p>
    Agora é necessário definir que tipo de ficheiro de saída que desejamos:
    <ul>
        <li><b>##showplots</b> → Esta declaração permite gerar gráficos recorrendo às funções R (ex.: plot(), hist(), etc&#8230;)</li>
        <li><b>##ficheiro_saida=output vector</b> → Esta declaração permite que o ficheiro de saída seja uma camada vectorial, poderá também alterar o vector por raster se desejar que 
               a saída seja uma camada raster</li>
    </ul>
</p>

<p>Após estas declarações definidas poderá inserir o seu código R, com as suas respectivas variáveis e poderá guardar o seu <i>script</i>. Resumidamente, o script tem o seguinte corpo:</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1">##nome_grupo_algoritmos= group</span>
</span><span class='line'><span class="c1">##nome_variavel = vector ou raster</span>
</span><span class='line'>
</span><span class='line'>library<span class="p">(</span><span class="s">&#39;pacote R a ser usado para correr o script&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>Código do Script R
</span><span class='line'>
</span><span class='line'><span class="c1">##showplots</span>
</span><span class='line'><span class="c1">##ficheiro_saida= ouput vector</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Exemplo de criação de um <i>script</i></h3>
<p>
    Foi criado um simples script R para que os utilizadores tenham uma ideia do fluxo de trabalho. Para este exemplo foram usadas as Áreas Ardidas no período de 2000 a 2008 disponibilizadas
    pelo ICNF em formato <i>shapefile</i>.
</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'><span class="c1">##QGIS_PT=group</span>
</span><span class='line'><span class="c1">##camada= vector</span>
</span><span class='line'><span class="c1">##showplots</span>
</span><span class='line'><span class="c1">##ano= field camada</span>
</span><span class='line'><span class="c1">##hectares= field camada</span>
</span><span class='line'>plot<span class="p">(</span>camada<span class="p">[[</span>ano<span class="p">]],</span> camada<span class="p">[[</span>hectares<span class="p">]],</span> main<span class="o">=</span><span class="s">&quot;Areas Ardidas&quot;</span><span class="p">,</span>xlab<span class="o">=</span><span class="s">&quot;Ano&quot;</span><span class="p">,</span>ylab<span class="o">=</span><span class="s">&quot;hectares&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura7_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura7_r.jpg" width="500"  alt="Saída Gráfica">
    </a>
</div>
<p class="img-leg">Figura 7 - Saída Gráfica</p>

<p>
    Outro aspecto interessante, é a possibilidade de integrar os nossos <i>scripts</i> R no modelador gráfico e criar uma cadeia de algoritmos com os <i>scripts</i> previamente criados (Figura 8).
</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura8_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura8_r.jpg" width="500"  alt="Integração no modelador gráfico do Menu Processamento">
    </a>
</div>
<p class="img-leg">Figura 8 - Integração no modelador gráfico do Menu Processamento</p>

<p>Podemos ainda, utilizar o nosso <i>script</i> R para o processamento em lote, como é mostrado na figura 8.</p>
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/figura9_r.jpg" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/figura9_r.jpg" width="500"  alt="Processamento em Lote">
    </a>
</div>
<p class="img-leg">Figura 9 - Processamento em Lote</p>

<h3>Notas finais</h3>
<p>É preciso perceber que este artigo é meramente um simples exemplo da potencialidade da integração do R com o QGIS.</p>
<p>
    Existem alguns <i>bugs</i> conhecidos para a versão 32-bits e 64-bits no Windows, nomeadamente o <i>R Output</i> em branco (mas geram os resultados correctos se forem guardados 
    na pasta de destino). Os <i>bugs</i> podem ser seguidos em <a href="http://hub.qgis.org/issues/7643" target="_blank">http://hub.qgis.org/issues/7643</a> e em 
    <a href="http://hub.qgis.org/issues/9203" target="_blank">http://hub.qgis.org/issues/9203</a>.
</p>
<p>Verifque se os pacotes do R estão no directório apropriado, pois se isso não acontecer (ex.: permissão de pasta), o QGIS não vai conseguir executar <i>scripts</i> de R e notificá-lo-á como estando em falta.</p>

<h3>Fontes consultadas</h3>
<p>[1] <a class="wrap-url" href="https://conservationecology.wordpress.com/2013/08/14/port-your-r-scripts-to-qgis-using-sextante/" target="_blank">https://conservationecology.wordpress.com/2013/08/14/port-your-r-scripts-to-qgis-using-sextante/</a></p>
<p>[2] <a class="wrap-url" href="http://www.geotribu.net/node/719" target="_blank">http://www.geotribu.net/node/719</a> (Um obrigado à Alexandra Glória por ter ajudado na tradução para português)</p>
<p>[3] <a class="wrap-url" href="http://www.r-bloggers.com/getting-raster-histogram-in-qgis-using-sextante-and-r/" target="_blank">http://www.r-bloggers.com/getting-raster-histogram-in-qgis-using-sextante-and-r/</a></p>
<p>[4] <a class="wrap-url" href="http://cran.r-project.org/doc/manuals/r-release/R-intro.html" target="_blank">http://cran.r-project.org/doc/manuals/r-release/R-intro.html</a></p>
<p>[5] <a class="wrap-url" href="http://www.icnf.pt/portal/florestas/dfci/Resource/doc/cart/ar-ard-00-08" target="_blank">http://www.icnf.pt/portal/florestas/dfci/Resource/doc/cart/ar-ard-00-08</a></p>
<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/0edb9f3a1e5191476215ce32183d80a4></img>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Transformação De Coordenadas E Utilização Das Grelhas NTv2 No QGIS]]></title>
    <link href="http://qgis.pt/2014/07/13/transformacao-de-coordenadas-e-utilizacao-das-grelhas-ntv2-no-qgis/"/>
    <updated>2014-07-13T23:47:03+01:00</updated>
    <id>http://qgis.pt/2014/07/13/transformacao-de-coordenadas-e-utilizacao-das-grelhas-ntv2-no-qgis</id>
    <content type="html"><![CDATA[<p>A crescente evolução dos Sistemas de Informação Geográfica, e a sua “democratização”, tanto pela via da simplificação, como pelo desenvolvimento de software aberto para SIG de 
   grande qualidade, de onde se destaca o QGIS,<!-- more --> tem permitido a um número cada vez maior de utilizadores, oriundos das mais diversas áreas do conhecimento, trabalhar com informação 
   geográfica. Muitos desses novos utilizadores, quiçá a maioria, não possuem conhecimentos de Ciências Cartográficas ou Geodesia, e enfrentam grandes dificuldades na utilização dos 
   Sistemas de Coordenadas.</p>
   
<p>Com efeito, uma das características fundamentais da Informação Geográfica é a sua georreferenciação ou, mais simplesmente, a associação a uma posição no espaço, 
identificada por um conjunto de coordenadas.</p>

<h3>Índice</h3>

<ol>
    <li><a href="#1">Introdução</a></li>
    <li><a href="#2">Sistemas de Coordenadas no QGIS</a></li>
    <li><a href="#3">Transformações de Coordenadas <i>On The Fly</i> no QGIS, usando as grelhas NTv2 de Portugal continental</a></li>
    <li><a href="#4">Transformações de Coordenadas no QGIS usando as grelhas NTv2 de Portugal continental – Sistemas de Referência Personalizados</a></li>
    <li><a href="#5">Referências</a></li>
</ol>

<p id="1">&nbsp;</p><p>&nbsp;</p>
<h3>1. Introdução</h3>
<p>Os sistemas de coordenadas utilizados para georreferenciação podem classificar-se em três classes fundamentais [1]:</p>
<ol>
    <li>Sistemas de coordenadas cartesianos tridimensionais, geocêntricos, com sistemas de eixos com origem próximo do centro de massa da Terra e coordenadas X, Y, Z.</li>
    <li>Sistemas de coordenadas geodésicos ou elipsoidais, resultantes do ajustamento de uma superfície elipsoidal (com definição matemática conhecida) ao geóide, 
        em função de um sistema de coordenadas cartesiano tridimensional ou de observações astronómicas. As coordenadas geodésicas elipsoidais são definidas por latitude, 
        longitude e altitude elipsoidal (φ, λ, h).</li>
    <li>Sistemas de coordenadas cartográficos ou planos, obtidos a partir das coordenadas elipsoidais, por intermédio de uma projecção cartográfica, à qual se associa um 
        sistema de coordenadas cartesianas bidimensionais.</li>
</ol>

<p>Grande parte da complexidade associada aos sistemas de coordenadas advém do facto da Terra não ser uma superfície regular e plana, e da cartografia se processar, inevitavelmente, 
   num plano (folha de papel, ecrã de computador, etc.). Esta situação encontra-se bem ilustrada numa animação de 1947, denominada “The Impossible Map” [2]. 
   Assim, houve necessidade de encontrar mecanismos que permitissem solucionar esse problema.</p>
   
<p>O geóide é a figura que mais se aproxima da forma da Terra, correspondendo a uma superfície equipotencial do campo gravítico terrestre, próxima do nível médio das águas do mar.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/1_modelo_geoide.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/1_modelo_geoide.png" width="300"  alt="Modelo do geóide">
    </a>
</div>

<p class="img-leg">Modelo do geóide (GOCE-ESA [3])</p>

<p>O geóide possui uma geometria bastante complexa, difícil de definir matematicamente, pelo que se usa o elipsóide para fazer a sua aproximação.</p>

<p>A utilização de um elipsóide como superfície de referência para suporte à georreferenciação, requer a definição de um conjunto de parâmetros: dimensão, forma e posição. O estabelecimento 
   desses parâmetros, materializados num ponto, constitui a definição de um Datum Geodésico [1]. Esse ponto, designado ponto de fixação, é o ponto de uma rede geodésica que estabelece as 
   relações entre o geóide e o elipsóide de referência, e entre as coordenadas astronómicas e as coordenadas geodésicas [4].</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/2_ondulacao_geoide.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/2_ondulacao_geoide.png" width="500"  alt="Ondulação do geóide">
    </a>
</div>

<p>Um elipsóide pode ser posicionado de forma a ajustar-se melhor a uma pequena zona do geóide (por exemplo, um país), designando-se por datum local (como o datum Lisboa ou o datum 73), 
   ou pode ser ajustado à totalidade do geóide, designando-se por datum global (como o WGS84 ou o ETRS89). Nos data locais, o ponto de fixação é escolhido de forma a minimizar as 
   distâncias entre o geóide e o elipsóide.</p>
   
<p>O primeiro datum geodésico definido em Portugal foi o datum Lisboa, fixado no Castelo de S. Jorge ainda no século XIX. Mais tarde, foi definido o datum 73, fixado no vértice geodésico 
   de Melriça. Durante o séc. XX, foi também utilizado o datum Europeu ED50.</p>

<p>Com a popularização dos sistemas de navegação por satélite, começaram a privilegiar-se os sistemas de coordenadas baseados em data globais, como o WGS84 e, mais recentemente, na Europa, 
   o ETRS89, que é coincidente com o WGS84 em 1989. O ETRS89 é materializado por um conjunto de estações fixadas na placa euro-asiática, evitando assim a variação nas coordenadas do WGS84, 
   que ocorre devido ao movimento das placas tectónicas. Apesar de tudo, esse movimento é bastante lento, levando a que, para a maioria das aplicações, o WGS84 se possa considerar igual ao 
   ETRS89 [5].</p>

<p>Também ao nível das projecções, foram utilizadas diversas em Portugal, desde a projecção de Bonne, à projecção de Gauss-Kruger e ao sistema UTM.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/3_sistemas_projeccao_pt.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/3_sistemas_projeccao_pt.png" width="500"  alt="Sistemas de projecção utilizados no território do continente">
    </a>
</div>

<p class="img-leg">Sistemas de projecção utilizados no território do continente. Da esquerda para a direita: Bessel-Bonne-Lisboa, Hayford-Gauss-Lisboa, Hayford-Gauss-Melriça e 
   Hayford-Gauss-Militar. PC designa o Ponto Central da projecção; o triângulo assinala o ponto de fixação do datum; a letra O designa a origem das coordenadas cartográficas; os 
   números I a IV identificam os quadrantes em cada sistema (Gaspar, J. A., 2000, citado em [6])</p>

<p>Do anteriormente exposto se depreende que existe informação geográfica produzida em distintos sistemas de referência, que é necessário compatibilizar, através de
   operações de transformação de coordenadas.</p>
   
<p>Existem diferentes métodos de transformação, dependendo do tipo de coordenadas em que se pretende efectuar essa transformação mas, de um modo genérico, todos requerem a identificação 
   do sistema de coordenadas em que os dados se encontram e de um conjunto de parâmetros de transformação entre esse sistema e o WGS84, que acaba por funcionar como um sistema intermédio. 
   Esses parâmetros são calculados a partir de pontos de coordenadas conhecidas em diversos sistemas e são, por isso, dependentes do conjunto de pontos utilizados, motivo que explica a 
   existência de diferentes parâmetros de transformação envolvendo os mesmos sistemas e os mesmos métodos. Vamos ver mais adiante que, por exemplo, a actual Direcção-Geral do Território 
   (DGT) disponibilizou, ao longo dos anos, diferentes parâmetros [oficiais] de transformação de Bursa-Wolf e Molodensky, do datum Lisboa e do datum 73 para WGS84 e, mais recentemente, 
   para ETRS89.</p>
   
<p>A conversão entre diferentes tipos de coordenadas num mesmo datum é exacta, ou seja, a passagem de coordenadas cartesianas tridimensionais para coordenadas geodésicas, e destas para 
  cartográficas, é feita sem qualquer incerteza ou erro, pois existem fórmulas matemáticas que viabilizam essa conversão [1].</p>
  
<p>Pelo contrário, se as coordenadas se encontrarem em data diferentes, a transformação já implica algum erro, que depende de um conjunto de factores como o método de transformação, 
   os pontos referenciados em ambos os sistemas, entre outros.</p>

<p>A imagem seguinte resume o processo de conversão e transformação entre sistemas de coordenadas.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/4_Conversoes_Transformacoes_Coord.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/4_Conversoes_Transformacoes_Coord.png" width="500"  alt="Conversão e transformação entre sistemas de coordenadas">
    </a>
</div>

<p class="img-leg">Conversão e transformação entre sistemas de coordenadas (Adaptado de [1])</p>

<p>Uma vez que as transformações com funções polinomiais são de uso bastante restrito, podemos dizer que na transformação entre dois sistemas de coordenadas cartográficas, 
   cada um deles baseado num datum geodésico diferente, teremos 4 transformações, 2 de projecção e 2 de datum, podendo ainda estar envolvidas 2 conversões entre coordenadas geodésicas 
   e cartesianas tridimensionais. A imagem seguinte esquematiza esse processo, representando a passagem do sistema de coordenadas cartográficas 1 (PCS1) ao 2 (PCS2), sendo conhecidas as 
   relações de cada datum geodésico (GCS) com um datum global [7] (geralmente, o WGS84). </p>
   
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/5_conv_coordenadas_jag.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/5_conv_coordenadas_jag.png" width="500"  alt="Conversão geral entre sistemas de coordenadas projectadas">
    </a>
</div>
   
<p class="img-leg">Conversão geral entre sistemas de coordenadas projectadas (E, N): PCS1 (Projected Coordinate System), no datum local 1, para PCS2, no datum local 2. (λ, φ) são as 
   coordenadas geográficas nos diferentes GCS (Geographic Coordinate System) [7]</p>
   
<p>Os softwares de SIG, de um modo geral, lidam desta forma com as conversões de coordenadas [8]. Os métodos mais clássicos de transformação são o de Bursa-Wolf e o de Molodensky. A DGT 
   determina e disponibiliza no seu site [9], para cada datum local, os parâmetros que o relacionam com um datum global, viabilizando dessa forma qualquer conversão.</p>
   
<p>A transformação de Bursa-Wolf é uma transformação em coordenadas cartesianas tridimensionais, fazendo uso de um conjunto de 7 parâmetros, que envolvem translacção, rotação e efeito 
   de escala [5].</p>
   
<p>A transformação de Molodensky, ou de 3 parâmetros, processa-se sobre coordenadas geodésicas e é um método diferencial em que os parâmetros produzidos são diferenças a aplicar às 
   coordenadas do sistema de partida [10].</p>
   
<p>No quadro seguinte apresentam-se os erros das transformações para datum Lisboa e datum 73.</p>

<table class="table">
    <tr>
        <th rowspan="2">Transformação</th>
        <th rowspan="2">Erro</th>
        <th colspan="2">Datum Lisboa</th>
        <th colspan="2">Datum 73</th>
    </tr>
    <tr>
        <th>eM (m)</th>
        <th>eP (m)</th>
        <th>eM (m)</th>
        <th>eP (m)</th>
    </tr>
    <tr>
        <td rowspan="2">Bursa-Wolf</td>
        <td>Médio quadrático</td>
        <td>1.40</td>
        <td>1.49</td>
        <td>0.38</td>
        <td>0.36</td>
    </tr>
    <tr>
        <td>Máximo absoluto</td>
        <td>5.10</td>
        <td>4.15</td>
        <td>1.35</td>
        <td>1.08</td>
    </tr>
    <tr>
        <td rowspan="2">Molodensky</td>
        <td>Médio quadrático</td>
        <td>1.69</td>
        <td>1.60</td>
        <td>0.84</td>
        <td>0.56</td>
    </tr>
    <tr>
        <td>Máximo absoluto</td>
        <td>4.47</td>
        <td>5.03</td>
        <td>2.11</td>
        <td>1.87</td>
    </tr>
</table>

<p class="img-leg">Erros em M (Meridiano) e P (Paralelo) encontrados nas transformações (Bursa-Wolf e Molodensky) de datum ETRS89 para os data Lisboa e 73, nos pontos da rede geodésica,
    usando os parâmetros do IGP (citado em [7]).</p>
    
<p>Como se pode constatar, os erros introduzidos nas transformações, especialmente no caso do datum Lisboa, são relativamente grandes e não são compatíveis com escalas cartográficas grandes,
   como 1:2.000, 1:1.000 ou superior [7].</p>
   
<p>Assim, para essas escalas, é necessário utilizar outros métodos de transformação mais rigorosos, como é o caso do método das grelhas de diferenças de coordenadas geográficas entre um 
   datum local e um datum global. Essas grelhas são obtidas a partir de pontos de referência conhecidos nos dois sistemas, como é o caso dos pontos da Rede Geodésica Nacional.</p>
   
<p>O prof. José Alberto Gonçalves (FCUP) criou grelhas de transformação de coordenadas a partir de 940 pontos das redes geodésicas de 1ª e 2ª ordem (cujas coordenadas eram disponibilizadas 
   pelo ex-IGP), através do cálculo das diferenças de longitudes e latitudes, dos data locais para ETRS89. De seguida procedeu a uma interpolação espacial (krigagem) dessas diferenças, 
   para gerar superfícies contínuas, com espaçamento de 1 décimo de grau, que cobrem todo o território de Portugal continental, no formato NTv2 (com extensão .gsb), que é o standard 
   suportado pelos softwares de SIG.</p>
   
<p>As estatísticas dos erros obtidos na transformação de 147 pontos da rede de 3ª ordem (que não entraram na elaboração das grelhas), pelo método das grelhas, estão patentes no quadro 
   seguinte.</p>
   
<table class="table">
    <tr>
        <th rowspan="2"></th>
        <th colspan="2">Datum Lisboa</th>
        <th colspan="2">Datum 73</th>
    </tr>
    <tr>
        <th>eM (m)</th>
        <th>eP (m)</th>
        <th>eM (m)</th>
        <th>eP (m)</th>
    </tr>
    <tr>
        <td>Média</td>
        <td>-0.005</td>
        <td>0.004</td>
        <td>0.004</td>
        <td>-0.008</td>
    </tr>
    <tr>
        <td>Desvio Padrão</td>
        <td>0.073</td>
        <td>0.087</td>
        <td>0.052</td>
        <td>0.047</td>
    </tr>
    <tr>
        <td>Mínimo</td>
        <td>-0.336</td>
        <td>-0.391</td>
        <td>-0.387</td>
        <td>-0.318</td>
    </tr>
    <tr>
        <td>Máximo</td>
        <td>0.314</td>
        <td>0.479</td>
        <td>0.228</td>
        <td>0.267</td>
    </tr>
</table>

<p class="img-leg">Estatísticas dos erros da transformação com grelhas de Datum Lisboa e de Datum 73 para ETRS89, em 147 pontos da rede geodésica não utilizados na geração das grelhas
   [7].</p>
   
<p>Verifica-se, de facto, que o método das grelhas é bastante mais rigoroso do que os métodos de Bursa-Wolf ou Molodensky. No caso do datum Lisboa, o erro das transformações de 3 e 7 
   parâmetros é quase tão grande como se simplesmente se tivessem considerado as coordenadas ETRS89 projectadas, iguais às coordenadas Hayford-Gauss datum Lisboa [8], cujas diferenças 
   atingem, no máximo, 8m, no extremo Noroeste de Portugal continental [5].</p>

<p>Entretanto, a DGT também disponibilizou grelhas de transformação de coordenadas. Para a sua elaboração, utilizou 1129 vértices da Rede Geodésica Nacional, observados com GPS. Através de 
   uma interpolação por kriging, gerou as grelhas de diferenças (de datum 73 para ETRS89 e de datum Lisboa para ETRS89), com espaçamento de 1&#8217;,2. A precisão da transformação foi estimada 
   com base em 130 vértices geodésicos (que também não entraram para o cálculo das grelhas), tendo obtido os valores da tabela seguinte [11]:</p>
   
<table class="table">
    <tr>
        <th></th>
        <th>Datum Lisboa</th>
        <th>Datum 73</th>
    </tr>
    <tr>
        <td>e.m.q. (m)</td>
        <td>0.09</td>
        <td>0.06</td>
    </tr> 
    <tr>
        <td>Máximo Abs. (m)</td>
        <td>0.30</td>
        <td>0.16</td>
    </tr> 
</table>

<p>Desta forma, conclui-se que, sempre que estejam disponíveis grelhas de transformação, esse método é preferível em relação aos métodos de Bursa-Wolf ou Molodensky. Ainda assim, o 
   QGIS suporta, como veremos de seguida, através das bibliotecas PROJ.4, todos esses métodos de transformação de coordenadas, pelo que a escolha do método a adoptar dependerá da vontade 
   de cada um e do rigor necessário para a aplicação em causa.</p>

<p id="2">&nbsp;</p><p>&nbsp;</p>   
<h3>2. Sistemas de Coordenadas no QGIS</h3>

<p>Tal como a maioria dos softwares de SIG actualmente existentes, o QGIS lida com os sistemas de referência através das bibliotecas PROJ.4 e das bibliotecas GDAL. Por sua vez, estas 
   recorrem aos códigos EPSG (European Petroleum Survey Group, actualmente integrado no OGP Surveying and Positioning Committee) [12] [13], para identificar um grande número de sistemas de 
   coordenadas e transformações definidos nessa base de dados, de uma forma standard e compatível com o que é usado por diversas aplicações [8]. Os códigos e as transformações 
   disponibilizados pelo EPSG são regularmente actualizados de acordo com as alterações que lhe são solicitadas, uma vez que, como já se referiu anteriormente, esses parâmetros são 
   dependentes do conjunto de pontos utilizados, motivo que explica a existência de diferentes parâmetros de transformação envolvendo os mesmos sistemas e os mesmos métodos. Na maioria dos 
   casos, os novos parâmetros substituem os antigos.</p>
   
<p>Esta arquitectura facilita bastante a utilização e a integração dos sistemas de coordenadas, promovendo a interoperabilidade entre softwares. Assim, aquando da instalação, o QGIS 
   sincroniza a base de dados onde armazena os sistemas de coordenadas e as transformações com o GDAL e o PROJ.4. </p>
   
<p>Para o utilizador, todo este processo é totalmente transparente e apenas tem de se preocupar com duas coisas:</p>
<ul>
    <li>Sistema de referência do projecto QGIS</li>
    <li>Sistema de referência dos dados que vai utilizar</li>
</ul>

<p>Quanto ao primeiro, no menu <b>Configurações / Settings -> Opções&#8230; / Options&#8230; ->  separador SRC / CRS</b>, o utilizador pode definir o sistema de referência que pretende usar 
   por defeito, isto é, aquele que vai surgir atribuído ao projecto, sempre que abre o QGIS. A escolha deste parâmetro deverá depender dos dados com que normalmente trabalha. 
   No caso da imagem seguinte, o SRC definido por defeito é o PT-TM06/ETRS89 (EPSG:3763) porque a maioria dos dados com que se trabalha actualmente em Portugal continental, se encontra 
   nesse sistema.</p>
   
<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/6_srs_projecto.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/6_srs_projecto.png" width="500"  alt="Definição dos sistemas de referência no QGIS">
    </a>
</div>

<p>A outra opção destacada na imagem anterior, está relacionada com a segunda questão com que o utilizador de informação geográfica terá sempre de se preocupar, que é o sistema  de 
   referência dos dados que vai utilizar. Essa importância advém do facto de não se poderem usar dados em diferentes sistemas, sem proceder a uma transformação. Sem essa noção, o utilizador
   pode, muitas vezes, ver-se confrontado com situações em que dados do mesmo local, obtidos por diversos métodos (levantamentos com GPS, digitalização sobre cartografia antiga, detecção 
   remota, etc.) ou a partir de diferentes fontes ou instituições, não ficam sobrepostos e/ou correctamente alinhados.</p>

<p>Efectivamente, existe em Portugal informação geográfica numa grande diversidade de sistemas de referência. Como exemplo, pode referir-se: muita cartografia geológica que se encontra 
   ainda no sistema de Bessel-Bonne datum Lisboa; a Carta Militar de Portugal Série M888 e cartografia produzida pelo Instituto da Conservação da Natureza e das Florestas, que utilizam o 
   sistema Hayford-Gauss Militar datum Lisboa; muita cartografia urbana de maior escala, produzida no sistema Hayford-Gauss datum 73; ou as últimas séries de ortofotomapas do ex-IGP, 
   bem como as últimas versões da Carta Administrativa Oficial de Portugal, produzidas no PT-TM06/ETRS89. Esta situação levanta problemas aos utilizadores menos experientes, quando tentam 
   sobrepor cartografia em sistemas de referência diferentes.</p>

<p>Assim, a opção seleccionada na imagem, faz com que, ao adicionar uma nova layer de informação (sempre que o QGIS não consiga detectar automaticamente o seu sistema de referência), seja 
   mostrada uma janela para o utilizador indicar qual o sistema de referência da layer que está a carregar no projecto QGIS.</p>

<p>A melhor forma de saber qual o sistema em que os dados se encontram, é procurar nos metadados disponibilizados pela entidade produtora. Uma outra opção, é procurar essa informação nos 
   próprios dados. Por exemplo, no caso de uma shapefile, que, como se sabe, é constituída por um conjunto de ficheiros com o mesmo nome (extensões .shp, .dbf, .shx, .qpj, .prj, etc.), 
   pode analisar-se, com um editor de texto, o conteúdo do ficheiro .prj: </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>PROJCS<span class="p">[</span><span class="s">&quot;ETRS89 / Portugal TM06&quot;</span><span class="p">,</span>
</span><span class='line'>    GEOGCS<span class="p">[</span><span class="s">&quot;ETRS89&quot;</span><span class="p">,</span>
</span><span class='line'>        DATUM<span class="p">[</span><span class="s">&quot;European_Terrestrial_Reference_System_1989&quot;</span><span class="p">,</span>
</span><span class='line'>            SPHEROID<span class="p">[</span><span class="s">&quot;GRS 1980&quot;</span><span class="p">,</span><span class="m">6378137</span><span class="p">,</span><span class="m">298.257222101</span><span class="p">,</span>
</span><span class='line'>                AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;7019&quot;</span><span class="p">]],</span>
</span><span class='line'>            TOWGS84<span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">],</span>
</span><span class='line'>            AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;6258&quot;</span><span class="p">]],</span>
</span><span class='line'>        PRIMEM<span class="p">[</span><span class="s">&quot;Greenwich&quot;</span><span class="p">,</span><span class="m">0</span><span class="p">,</span>
</span><span class='line'>            AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;8901&quot;</span><span class="p">]],</span>
</span><span class='line'>        UNIT<span class="p">[</span><span class="s">&quot;degree&quot;</span><span class="p">,</span><span class="m">0.0174532925199433</span><span class="p">,</span>
</span><span class='line'>            AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;9122&quot;</span><span class="p">]],</span>
</span><span class='line'>        AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;4258&quot;</span><span class="p">]],</span>
</span><span class='line'>    PROJECTION<span class="p">[</span><span class="s">&quot;Transverse_Mercator&quot;</span><span class="p">],</span>
</span><span class='line'>    PARAMETER<span class="p">[</span><span class="s">&quot;latitude_of_origin&quot;</span><span class="p">,</span><span class="m">39.66825833333333</span><span class="p">],</span>
</span><span class='line'>    PARAMETER<span class="p">[</span><span class="s">&quot;central_meridian&quot;</span><span class="p">,</span><span class="m">-8.133108333333334</span><span class="p">],</span>
</span><span class='line'>    PARAMETER<span class="p">[</span><span class="s">&quot;scale_factor&quot;</span><span class="p">,</span><span class="m">1</span><span class="p">],</span>
</span><span class='line'>    PARAMETER<span class="p">[</span><span class="s">&quot;false_easting&quot;</span><span class="p">,</span><span class="m">0</span><span class="p">],</span>
</span><span class='line'>    PARAMETER<span class="p">[</span><span class="s">&quot;false_northing&quot;</span><span class="p">,</span><span class="m">0</span><span class="p">],</span>
</span><span class='line'>    UNIT<span class="p">[</span><span class="s">&quot;metre&quot;</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>
</span><span class='line'>        AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;9001&quot;</span><span class="p">]],</span>
</span><span class='line'>    AXIS<span class="p">[</span><span class="s">&quot;X&quot;</span><span class="p">,</span>EAST<span class="p">],</span>
</span><span class='line'>    AXIS<span class="p">[</span><span class="s">&quot;Y&quot;</span><span class="p">,</span>NORTH<span class="p">],</span>
</span><span class='line'>    AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;3763&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>

<p>Aí obtém-se a informação de que se necessita, nomeadamente a indicação sobre o datum, o elipsóide, a projecção e as unidades, para determinar se a layer pode ser usada directamente em 
   conjunto com outras, ou se é necessário proceder a alguma transformação. </p>

<p>Estando na posse desta informação, a utilização do QGIS torna-se bastante simples e livre de equívocos.</p>

<p>No canto inferior direito da janela do QGIS, está sempre disponível a indicação do sistema de referência do projecto.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/7_srs_projecto_qgis.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/7_srs_projecto_qgis.png" width="500"  alt="Indicação do sistema de referência do projecto no QGIS">
    </a>
</div>

<p>Quando essa indicação se encontra a cinzento, como é o caso da imagem anterior, significa que todos os dados se encontram no mesmo sistema de referência do projecto.</p>

<p>Quando se carrega no projecto uma layer num sistema de referência diferente, a informação do sistema de referência do projecto fica a preto, o que significa que foi activada a 
   transformação &#8216;on the fly&#8217;. Os parâmetros utilizados nesta transformação, são os predefinidos pelas bibliotecas GDAL e PROJ.4, que o QGIS importa durante a instalação.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/8_srs_projecto_qgis_onthefly.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/8_srs_projecto_qgis_onthefly.png" width="500"  alt="Activar transformação de SRC on the fly">
    </a>
</div>

<p>Para averiguar qual o método de transformação e os respectivos parâmetros utilizados, na tabela de conteúdos, clica-se com o botão direito do rato sobre a layer e escolhe-se 
   “Definir SRC da camada” / “Set layer CRS”. </p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/9_srs_projecto_qgis_onthefly_parametros.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/9_srs_projecto_qgis_onthefly_parametros.png" width="500"  alt="Visualização do método de transformação usado e seus parâmetros">
    </a>
</div>

<p>Verifica-se que, neste caso, se processa uma transformação de 3 parâmetros (Molodensky), com os valores de conversão para datum WGS84 (destacados a vermelho) visíveis na string proj.</p>

<p>Para transformar esta layer no datum Lisboa, de forma permanente, para ETRS89, basta clicar com o botão direito do rato sobre a layer na tabela
   de conteúdos, escolher <b>Guardar como&#8230; / Save as&#8230;</b> e seleccionar o sistema de referência de destino, neste caso, o PT-TM06/ETRS89 (EPSG:3763). O método e os parâmetros 
   utilizados nessa transformação, são os mesmos da transformação <i>on the fly</i>.</p>

<p>Deste modo, o QGIS permite aos utilizadores visualizar informação em diferentes sistemas de referência, com grande facilidade. Aliás, este processo é de tal forma simplificado pelo 
   QGIS que pode até levar a que os utilizadores menos experientes não se apercebam que os dados têm sistemas de coordenadas distintos. E os parâmetros utilizados pelo QGIS, por defeito,
   são suficientes para a maioria das utilizações.</p>

<p>Contudo, como se viu na introdução, existem métodos mais precisos que outros e parâmetros que conduzem a resultados mais rigorosos que outros, para determinadas áreas do território. 
   Assim, nos capítulos seguintes vai apresentar-se a forma de configurar novos sistemas de referência no QGIS, nomeadamente utilizando as grelhas NTv2 de transformação de coordenadas.</p>

<p id="3">&nbsp;</p><p>&nbsp;</p>
<h3>3. Transformações de Coordenadas <i>On The Fly</i> no QGIS, usando as grelhas NTv2 de Portugal continental</h3>

<p>A partir da versão 2.2 do QGIS, foi introduzida uma nova ferramenta, designada Datum Transformation, que veio facilitar a utilização dos diversos métodos de transformação de coordenadas, 
   especialmente o método das grelhas, cuja implementação nos softwares de SIG é ainda recente.</p>
   
<h4>Configuração das transformações &#8216;on the fly&#8217; de datum no QGIS para Portugal continental</h4>

<ol>
    <li>O primeiro passo consiste em descarregar os ficheiros das grelhas NTv2 dos sites do prof. José Alberto Gonçalves e da DGT:</li>
        <ul>
            <li><a href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm</a></li>
            <li><a href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/</a></li>
        </ul>
        <p>Para facilitar, essas grelhas podem ser descarregadas a partir daqui: <a href="http://qgis.pt/blog/images/dados/grelhas.zip" target="_blank">grelhas.zip</a></p>
    <li>Os ficheiros das grelhas (.gsb) obtidos em 1) colocam-se na pasta utilizada pelo PROJ.4, cuja localização vai depender do Sistema Operativo utilizado e do modo como o QGIS foi 
        instalado:</li>
        <ul>
            <li>Em Linux, os ficheiros das grelhas colocam-se na pasta <b><i>/usr/share/proj</i></b></li>
            <li>Em Windows, tendo usado o instalador OSGeo4W, os ficheiros colocam-se na pasta <b><i>..\OSGeo4W\share\proj</i></b></li>
            <li>Ainda em Windows, tendo usado o instalador standalone, os ficheiros colocam-se na pasta <b><i>..\Program Files\QGIS Chugiak\share\proj</i></b></li>
            <li>Uma outra alternativa é verificar a path da variável de ambiente PROJ_LIB e colocar os ficheiros nessa pasta</li>
        </ul>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/10_grelhas_pasta_proj.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/10_grelhas_pasta_proj.png" width="500"  alt="Colocação das grelhas nas pastas adequadas">
            </a>
        </div>
    <li>De seguida, substitui-se a base de dados srs.db que se encontra na pasta /resources, dentro da pasta de instalação do QGIS, por esta: <a href="http://qgis.pt/blog/images/dados/srs_db.zip" target="_blank">srs_db.zip</a> </li>
        <ul>
            <li>Em Linux, a pasta <b><i>/resources</i></b> encontra-se em <b><i>/usr/share/qgis/resources/</i></b></li>
            <li>Em Windows, tendo usado o instalador OSGeo4W, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\OSGeo4W\apps\QGIS\resources\</i></b></li>
            <li>Tendo usado o instalador standalone, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\Program Files\QGIS Chugiak\resources\</i></b></li>
        </ul>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/11_srs_pasta_resources.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/11_srs_pasta_resources.png" width="500"  alt="Colocação da base de dados de sistemas de referência na pasta adequada">
            </a>
        </div>
        <p>Basicamente, essa base de dados é substituída para evitar confusões nos utilizadores portugueses e disponibilizar apenas os últimos conjuntos de parâmetros de transformação de Bursa-Wolf
           e de Molodensky fornecidos pela DGT [9], bem como as grelhas NTv2 da DGT [11] e do  prof. José Alberto Gonçalves [14].</p>
    <li>Já no QGIS, no menu <b><i>Configurações / Settings -> Opções&#8230; / Options&#8230; -> separador SRC / CRS</i></b> e activa-se a opção <b><i>Transformações de datum padrão / Default datum
        transformations -> Perguntar pela transformação de datum quando não for definido um padrão / Ask for datum transformation when no default is defined</i></b>. Nesse mesmo separador, 
        selecciona-se a opção <b><i>Habilitar automaticamente a reprojeção on the fly se as camadas tiverem diferentes SRC / Automatically enable on the fly reprojection if layers have 
        different CRS</i></b></li>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/12_configurar_datum_transformation.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/12_configurar_datum_transformation.png" width="500"  alt="Configuração das transformações de datum">
            </a>
        </div>
    <li>A partir deste momento, sempre que se carregue informação geográfica (vectores, rasters, wms, wfs, postgis, etc.) no QGIS que se encontre em data diferentes, é aberta uma janela 
        que vai permitir seleccionar o método de transformação (Bursa-Wolf / Molodensky / Grelhas NTv2). A escolha vai depender da vontade de cada utilizador, mas deve basear-se naquilo 
        que é referido na introdução deste texto.</li>
</ol>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/13_janela_datum_transformation.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/13_janela_datum_transformation.png" width="500"  alt="Janela da transformação de datum">
    </a>
</div>

<p>No exemplo da imagem anterior, carregou-se a layer da Rede Geodésica Nacional no ETRS89. De seguida, carregou-se uma outra layer da Rede Geodésica Nacional, mais antiga, no datum 73. 
   O QGIS detectou automaticamente que as layers se encontram em sistemas de referência diferentes e apresentou a janela do Datum Transformation, com as 4 possibilidades de transformação 
   da layer no datum 73 para o ETRS89: método de Bursa-Wolf, método de Molodensky, grelhas NTv2 da DGT e grelhas NTv2 do prof. José Alberto Gonçalves. Na metade inferior da janela aparece  
   uma breve descrição de cada um dos métodos, bem como informação acerca do rigor de cada uma das transformações.</p>

<p>O utilizador pode optar por qualquer um dos métodos disponibilizados e pode, inclusivamente, predefinir esse método para que, no futuro, quando surgirem dados que impliquem a mesma 
   transformação, o QGIS a seleccione por defeito.</p>

<p>Ao confirmar, o QGIS activa a transformação &#8216;on the fly&#8217; e usa o método de transformação escolhido.</p>

<p>Tal como se referiu anteriormente, as transformações são definidas entre um datum local e um datum global. Este facto vai permitir executar transformações imediatas entre dois data 
   locais, sendo que o Datum Transformation se encarrega de proceder à passagem intermédia pelo datum global (comum a ambos). Deste modo, quando se carrega uma layer no datum 73 e outra 
   no datum Lisboa, num projecto QGIS, o Datum Transformation apresenta todas as possíveis combinações de métodos de transformação entre o datum Lisboa e o WGS84, e o datum 73 e o WGS84. 
   Assim, é realizada uma transformação do datum Lisboa para WGS84 e, deste, para o datum 73, permitindo fazer a transformação entre esses dois data locais pelo método das grelhas, mesmo 
   sem estas terem sido geradas através do cálculo das diferenças de longitude e latitude entre si, mas sim de cada um dos data locais para WGS84/ETRS89.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/14_datum_lx_para_d73.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/14_datum_lx_para_d73.png" width="500"  alt="Transformação de Datum Lisboa para Datum 73">
    </a>
</div>

<p>Uma questão muito importante, que é necessário ter presente, é que este tipo de transformação &#8216;on the fly&#8217; é uma transformação em tempo real, isto é, a transformação é feita sobre os 
   dados na sua forma original. Por exemplo, no caso anteriormente apresentado, as layers da Rede Geodésica Nacional mantiveram as suas propriedades originais, a primeira no sistema de 
   referência PT-TM06/ETRS89 (EPSG:3763) e a segunda no sistema de referência Hayford-Gauss datum 73 (EPSG:27493). Por outras palavras, não houve qualquer alteração dos 
   ficheiros armazenados no disco / base de dados. Este procedimento é bastante útil e prático para efeitos de visualização, mas não é suficiente quando o objectivo é efectuar 
   análise espacial e cruzamento de informação entre dados em data diferentes. Para esse efeito, é indispensável ter os dados no mesmo sistema de referência, ou seja, no caso anterior, 
   era necessário guardar uma nova layer no disco, transformada do datum 73 para ETRS89. Esse procedimento também é bastante simples no QGIS, mas implica a utilização de 
   <b><i>SRC Personalizados / Custom CRS</i></b>, isto é, têm de se criar novos sistemas de referência que incluam os parâmetros de transformação entre o datum local e um datum global, 
   neste caso, o WGS84.</p>

<p id="4">&nbsp;</p><p>&nbsp;</p>
<h3>4. Transformações de Coordenadas no QGIS usando as grelhas NTv2 de Portugal continental – Sistemas de Referência Personalizados</h3>

<p>Esta segunda forma de transformação de coordenadas no QGIS permite a criação de layers no novo sistema de referência, usando um dos métodos apresentados anteriormente.</p>

<h4>Configuração das transformações de datum no QGIS para Portugal continental através da criação de Sistemas de Referência Personalizados</h4>

<p>Os dois primeiros passos descritos de seguida são exactamente os mesmos que se efectuaram no procedimento de configuração das transformações <i>on the fly</i>, pelo que, se já os tiverem 
   realizado, podem passar para o passo 3.</p>

<ol>
    <li>O primeiro passo consiste em descarregar os ficheiros das grelhas NTv2 dos sites do prof. José Alberto Gonçalves e da DGT:</li>
        <ul>
            <li><a href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm</a></li>
            <li><a href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/</a></li>
        </ul>
        <p>Para facilitar, essas grelhas podem ser descarregadas a partir daqui: <a href="http://qgis.pt/blog/images/dados/grelhas.zip" target="_blank">grelhas.zip</a></p>
    <li>Os ficheiros das grelhas (.gsb) obtidos em 1) colocam-se na pasta utilizada pelo PROJ.4, cuja localização vai depender do Sistema Operativo utilizado e do 
        modo como o QGIS foi instalado</li>
        <ul>
            <li>Em Linux, os ficheiros das grelhas colocam-se na pasta <b><i>/usr/share/proj</i></b></li>
            <li>Em Windows, tendo usado o instalador OSGeo4W, os ficheiros colocam-se na pasta <b><i>..\OSGeo4W\share\proj</i></b></li>
            <li>Ainda em Windows, tendo usado o instalador standalone, os ficheiros colocam-se na pasta <b><i>..\Program Files\QGIS Chugiak\share\proj</i></b></li>
            <li>Uma outra alternativa é verificar a <i>path</i> da variável de ambiente PROJ_LIB e colocar os ficheiros nessa pasta</li>
        </ul>
    <li>No QGIS -> menu <b><i>Configurações / Settings -> SRC Personalizado&#8230; / Custom CRS&#8230;</i></b>, cria-se um novo sistema de referência 
        (<b><i>Adicionar novo SRC / Add New CRS</i></b>) com a seguinte definição:</li>
        <ul>
            <li><b>Nome:</b> Datum_Lisboa_Hayford_Gauss_Militar_Grelhas_JAG_20790</li>
            <li><b>Parâmetros:</b> +proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +nadgrids=ptLX_e89.gsb +wktext +pm=lisbon +units=m +no_defs</li>
        </ul>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/15_src_personalizado.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/15_src_personalizado.png" width="500"  alt="Configuração de SRC personalizado">
            </a>
        </div>
    <li>Criam-se, da forma descrita anteriormente, tantos SRC personalizados quantos se necessite. De seguida disponibilizam-se os que, eventualmente, serão mais utilizados em Portugal continental:</li>
    <table class="table">
        <tr>
            <td rowspan="2">1.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Grelhas_JAG_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +nadgrids=ptLX_e89.gsb +wktext +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">2.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Grelhas_JAG_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +nadgrids=pt73_e89.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">3.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Militar_Grelhas_JAG</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=200180.598 +y_0=299913.01 +ellps=intl +nadgrids=pt73_e89.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">4.</td>
            <td><b>Nome:</b></td>
            <td>UTM_29N_ED50_Grelhas_JAG_23029</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=utm +zone=29 +ellps=intl +nadgrids=ptED_e89.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">5.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Militar_Grelhas_DGT_20790 </td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +nadgrids=DLX_ETRS89_geo.gsb +wktext +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">6.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Grelhas_DGT_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +nadgrids=DLX_ETRS89_geo.gsb +wktext +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">7.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Grelhas_DGT_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +nadgrids=D73_ETRS89_geo.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">8.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Militar_Grelhas_DGT</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=200180.598 +y_0=299913.01 +ellps=intl +nadgrids=D73_ETRS89_geo.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">9.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Militar_Bursa_Wolf_DGT_20790</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +towgs84=-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">10.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Bursa_Wolf_DGT_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +towgs84=-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">11.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Bursa_Wolf_DGT_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +towgs84=-230.994,102.591,25.199,0.633,-0.239,0.900,1.950 +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">12.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Militar_Molodensky_DGT_20790</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +towgs84=-303.861,-60.693,103.607 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">13.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Molodensky_DGT_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +towgs84=-303.861,-60.693,103.607 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">13.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Molodensky_DGT_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +towgs84=-223.150,110.132,36.711 +units=m +no_defs</td>
        </tr>
    </table>
    <p>Em alternativa à introdução manual, disponibiliza-se uma versão da base de dados qgis.db, com os <b><i>Custom CRS</i></b> já introduzidos: <a href="http://qgis.pt/blog/images/dados/qgis_db.zip" target="_blank">qgis_db.zip</a></p>

    <p>Este ficheiro deve substituir os ficheiros com o mesmo nome que se encontram na pasta <b><i>/resources</i></b> e na pasta QGIS do utilizador (.qgis2):</p>

    <ul>
        <li>../resources/qgis.db:</li>
            <ol>
                <li>Em Linux, a pasta <b><i>/resources</i></b> encontra-se em <b><i>/usr/share/qgis/resources/</i></b></li>
                <li>Em Windows, tendo usado o instalador OSGeo4W, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\OSGeo4W\apps\QGIS\resources\</i></b></li>
                <li>Tendo usado o instalador standalone, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\Program Files\QGIS Chugiak\resources\</i></b></li>
            </ol>
        <li>~/.qgis2/qgis.db:</li>
            <ol>
                <li>Em Linux, a pasta <b><i>/.qgis2</i></b> encontra-se em <b><i>/home/nome_do_utilizador/.qgis2/</i></b></li>
                <li>Em Windows, a pasta <b><i>&#46;qgis2</i></b> encontra-se em <b><i>C:\Users\nome_do_utilizador&#46;qgis2\</i></b></li>
            </ol>
    </ul>

    <p>A base de dados qgis.db surge em dois locais diferentes porque, na primeira vez, após a instalação, que cada utilizador do computador corre o QGIS, é criada uma pasta denominada .qgis2 
       na sua pasta pessoal. Esta inclui uma qgis.db, que é cópia da base de dados existente em ../resources/qgis.db. Ou seja, se esta última estiver vazia, é criada uma cópia vazia na pasta 
       do utilizador. Se tiver alguma informação, a cópia na pasta do utilizador vai ficar com esse conteúdo. </p>

    <p>O problema é que, uma vez criada, a ~/.qgis2/qgis.db não é mais alterada por esta via. Ou seja, mesmo colocando uma versão já com os <b><i>Custom CRS</i></b> em /resources/qgis.db, 
       estes não aparecem no QGIS. Só irão aparecer se novos utilizadores do computador arrancarem o QGIS a partir das suas contas pessoais.</p>
       
    <p>Por esse motivo, quem já utiliza o QGIS, necessita de substituir ~/.qgis2/qgis.db pela versão fornecida, tendo em atenção que é também nessa base de dados que ficam guardados os 
       bookmarks do utilizador. Assim, se tiverem bookmarks criados, ao fazerem a substituição, irão perdê-los. </p>
       
    <div class="post-img">
        <a href="http://qgis.pt/blog/images/posts/16_src_personalizados.png" rel="prettyPhoto" title="">
            <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/16_src_personalizados.png" width="500"  alt="Janela dos SRC">
        </a>
    </div>
       
    <li>Tome-se agora, como exemplo, a layer da Rede Geodésica Nacional no Hayford-Gauss datum 73 e imagine-se que se pretende transformá-la, de forma permanentemente, para o ETRS89.</li>
        <ul>
            <li>Começa por se carregar essa layer no QGIS</li>
            <li>Por defeito, ela vai assumir o sistema de referência em que foi produzida, neste caso, o datum 73 com a definição do PROJ.4 (EPSG:27493)</li>
            <li>Para se usarem as grelhas, por exemplo da DGT, na transformação, é necessário indicar ao QGIS o sistema que tem, nos parâmetros de transformação, as grelhas (parâmetro 
                +nadgrids), ou seja, atribui-se à layer o sistema de referência correspondente, que se criou no passo 4</li>
            <li>Para isso, na tabela de conteúdos, clica-se com o botão direito do rato sobre a layer e escolhe-se <b><i>Definir SRC da camada / Set layer CRS</i></b>. Dentro dos 
                <b><i>Sistemas de Coordenadas definidos pelo utilizadores / User Defined Coordinate Systems</i></b>, escolhe-se o Datum73_Hayford_Gauss_Grelhas_DGT_27493</li>
                <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/17_set_user_defined_crs.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/17_set_user_defined_crs.png" width="500"  alt="Definir o SRC personalizado">
                    </a>
                </div>
            <li>De seguida, clica-se novamente com o botão direito do rato sobre a layer e escolhe-se <b><i>Guardar como&#8230; / Save as&#8230;</i></b>. Na janela que se abre, escolhe-se o 
                formato de saída, dá-se o caminho para guardar a nova layer e selecciona-se o sistema de referência de destino, neste caso, o PT-TM06/ETRS89. Ao clicar em <b><i>Ok</i></b>, 
                a layer é guardada no novo sistema de referência.</li>
                <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/18_janela_guardar_como.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/18_janela_guardar_como.png" width="500"  alt="Janela Guardar camada como">
                    </a>
                </div>
                <p>Este procedimento pode ser executado em lote, para várias layers em simultâneo, através da ferramenta <b><i>Reproject layer</i></b> do Processing [15].</p>
            <li>Para confirmar a transformação, pode abrir-se um novo projecto QGIS e carregar a layer acabada de transformar e a layer da Rede Geodésica Nacional em ETRS89.</li>
                <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/19_erro_grelhas_dgt_vg_pinhel.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/19_erro_grelhas_dgt_vg_pinhel.png" width="500"  alt="Erros associados à transformação">
                    </a>
                </div>
                <p>Na imagem consegue perceber-se que o erro na transformação com a grelha NTv2 da DGT, por exemplo, para o caso do vértice geodésico “Pinhel” foi de, aproximadamente, 
                   2.5mm. O que é um resultado excelente.</p>
                   
                <p>Para testar, em simultâneo, a transformação <b><i>on the fly</i></b>, carrega-se a layer original no datum 73 e escolhe-se a mesma grelha na janela do Datum 
                   Transformation. O resultado, visível na imagem seguinte, é elucidativo do bom funcionamento de ambas as formas de transformação presentes no QGIS, atendendo a que os 
                   pontos (estrela verde e círculo azul) surgem sobrepostos.</p>
                
                 <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/20_erro_grelhas_dgt_vg_pinhel_datum_transf.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/20_erro_grelhas_dgt_vg_pinhel_datum_transf.png" width="500"  alt="Erros associados à transformação">
                    </a>
                </div>


        </ul>
</ol>

<p>Desta forma, o utilizador dispõe agora dos melhores métodos de transformação dos sistemas de coordenadas nacionais antigos para o ETRS89, e pode efectuar essas operações, com grande 
   facilidade, no QGIS.</p>

<p id="5">&nbsp;</p><p>&nbsp;</p>   
<h3>5. Referências</h3>
<p>[1] Matos, J. (2008). “Fundamentos de Informação Geográfica” . 5ª Edição. Lisboa: Lidel</p>
<p>[2] <a class="wrap-url" href="http://www3.nfb.ca/animation/objanim/en/films/film.php?sort=title&id=14229" target="_blank">http://www3.nfb.ca/animation/objanim/en/films/film.php?sort=title&id=14229</a></p>
<p>[3] <a class="wrap-url" href="http://www.esa.int/spaceinimages/Images/2011/03/New_GOCE_geoid " target="_blank">http://www.esa.int/spaceinimages/Images/2011/03/New_GOCE_geoid </a></p>
<p>[4] <a class="wrap-url" href="http://www.aprh.pt/rgci/glossario/elipsoide-de-referencia.html." target="_blank">http://www.aprh.pt/rgci/glossario/elipsoide-de-referencia.html.</a></p>
<p>[5] Gonçalves, J., 2008. Adopção de Sistemas de Referenciação Geográfica Globais. ESIG2008 (<a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_esig2008.pdf" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_esig2008.pdf</a>)</p>
<p>[6] Fernandes, M., 2008. Cartografia - programa, conteúdos e métodos de ensino. FLUP (<a class="wrap-url" href="http://ler.letras.up.pt/uploads/ficheiros/5901.pdf" target="_blank">http://ler.letras.up.pt/uploads/ficheiros/5901.pdf</a>)</p>
<p>[7] Gonçalves, J., 2009. Conversões de Sistemas de Coordenadas Nacionais para ETRS89 Utilizando Grelhas. VI CNCG (<a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_cncg2009.pdf" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_cncg2009.pdf</a>)</p>
<p>[8] Gonçalves, J., 2008. Conversões de coordenadas com o programa PROJ - Método de conversão com grelhas. SASIG2008 (<a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_sasig2009.pdf" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_sasig2009.pdf</a>)</p>
<p>[9] <a class="wrap-url"href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/parametros_de_transformacao_de_coordenadas/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/parametros_de_transformacao_de_coordenadas/</a></p>
<p>[10] <a class="wrap-url" href="http://nsnig.igeo.pt/eventos/comunicacoes/Caldas_da_Rainha/CNCG2009-AnaBernardes.pdf" target="_blank">http://nsnig.igeo.pt/eventos/comunicacoes/Caldas_da_Rainha/CNCG2009-AnaBernardes.pdf</a></p>
<p>[11] <a class="wrap-url" href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/</a></p>
<p>[12] <a class="wrap-url" href="http://www.epsg.org/" target="_blank">http://www.epsg.org/</a></p>
<p>[13] <a class="wrap-url" href="http://epsg.io/" target="_blank">http://epsg.io/</a></p>
<p>[14] <a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm</a></p>
<p>[15] <a class="wrap-url" href="http://qgis.pt/workshops_qgis2014/ws_processing_qgis_day_2014.pdf" target="_blank">http://qgis.pt/workshops_qgis2014/ws_processing_qgis_day_2014.pdf</a></p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/8248cd896ad16c4ef53d0558d8e62a18></img>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Acções Em Python No QGIS]]></title>
    <link href="http://qgis.pt/2014/06/18/accoes-em-python-no-qgis/"/>
    <updated>2014-06-18T20:31:10+01:00</updated>
    <id>http://qgis.pt/2014/06/18/accoes-em-python-no-qgis</id>
    <content type="html"><![CDATA[<p>Este artigo demonstra como se podem rapidamente usar Acções para criar um projecto com tarefas desenvolvidas à medida em Python.</p>
<!-- more -->

<h3>Introdução às Acçções em Python</h3>
<p>Acções no QGIS permitem que o utilizador defina, para um tema, tarefas que serão despoletadas pelo utilizador. A grande utilidade das acções é que usam os valores dos 
atributos dos vectores desse tema para executar a tarefa. Assim, podemos definir uma acção que abre um documento cujo nome é obtido de um atributo. Podemos, por exemplo, abrir a 
fotografia de uma caixa de visita numa rede de águas. As acções podem ser despoletadas quando o utilizador usa a janela de identificação, a tabela de atributos, ou o botão de acções. 
Mais informação pode ser obtida no <a href="http://docs.qgis.org/2.2/pt_PT/docs/user_manual/working_with_vector/vector_properties.html#actions-menu" target="_blank">manual de utilizador</a>.</p>

<p>Este artigo não é um tutorial aprofundado sobre acções do QGIS, pretende apenas demonstrar um caso de utilização de acções programadas em Python. Acções em Python são apenas uma 
das formas de criar acções. Outros tipos de acções que não usam programação são também possíveis.</p>

<p>Para começar a explorar a forma de criar acções, pode ver um conjunto de acções pré-definidas que estão incluídas no QGIS. Para isso, basta abrir as propriedades de um tema, e 
clicar na secção Acções. Aqui, pode clicar no botão “Adicionar acções pré-definidas”.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/2_acoes_highlight.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/2_acoes_highlight.png" width="500"  alt="Criação de novas acções">
    </a>
</div>

<p>Esta é uma forma de aprender rapidamente como se criam acções. Uma das acções permite abrir uma página na web com o endereço criado a partir de um campo da tabela de atributos. 
Outra, mais interessante para o nosso artigo, é composta por uma linha de código Python que mostra o número do registo automático ao clicar sobre um elemento desse tema:</p>


<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/3_acoes_id_elemento.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/3_acoes_id_elemento.png" width="500"  alt="Acção para obter o ID do registo">
    </a>
</div>

<p>Como em todas as acções, esta estará disponível em 3 locais: janela de identificação, janela de atributos, e ao clicar no mapa quando activamos a acção no menu de acções. 
Esta última possibilidade é a mais útil neste caso, porque permite ao clicar no mapa obter uma janela com apenas a informação que precisamos, ao invés da janela de identificação 
genérica com todos os atributos.</p>


<h3>Caso Prático</h3>
<p>Avançando… o problema que se pretende resolver é o seguinte: 
tendo um tema de cadastro e uma tabela de proprietários, como selecionar na tabela um proprietário e visualizar os seus prédios no tema, de forma simples para utilizadores que não 
conhecem QGIS?</p>

<p>Claro que o QGIS é mais que capaz de resolver esta questão, usando as funções de selecção por atributo e até a fantástica nova capacidade de definir relações de 1 para muitos. 
Mais informação pode ser obtida aqui:</p>
<ul>
    <li><a href="http://docs.qgis.org/2.2/pt_PT/docs/user_manual/working_with_vector/editing_geometry_attributes.html#selecting-features-in-an-attribute-table" target="_blank">Seleccionando elementos na tabela de atributos</a></li>
    <li><a href="http://blog.vitu.ch/10112013-1201/qgis-relations" target="_blank">QGIS Relations</a></li>
    <li><a href="http://docs.qgis.org/2.2/pt_PT/docs/user_manual/working_with_vector/editing_geometry_attributes.html#creating-one-to-many-relations" target="_blank">Creating one to many relations</a></li>
</ul>

<p>Mas estes mecanismos exigem conhecimento de utilização de QGIS e até de SIG, pelo que não serviam ao nosso propósito. Era necessário criar mecanismos simples de pesquisa e cruzar 
resultados entre uma tabela e um tema.</p>

<h3>Primeira acção Python</h3>
<p>A primeira acção que se criou permitia ao utilizador clicar sobre uma linha na tabela de proprietários e selecionar todos os registos com o mesmo proprietário. É preciso explicar 
que esta tabela continha linhas para todos os prédios de cada proprietário. Ou seja, o mesmo proprietário surge tantas vezes quantos os prédios que este detém.</p>

<p>Nas propriedades da tabela de proprietários, na secção de Acções, vamos adicionar uma nova acção Python, e adicionar o código mostrado na imagem seguinte.</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/4_acao1_selecionarNIFcomoeste.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/4_acao1_selecionarNIFcomoeste.png" width="500"  alt="Acçção para seleccionar todos os registos com o mesmo proprietário">
    </a>
</div>

<p>Naturalmente, o código é um pouco difícil de ler… e a sintaxe é um pouco diferente - é necessário terminar cada linha com “;”.</p>

<p>Mas o mais interessante é que quando o utilizador abrir a tabela de atributos e clicar com o botão direito sobre um registo vai ter agora uma nova opção chamada “Seleciona NIFs 
como este”. O QGIS irá passar o valor do campo “NumContrib” para este código e executá-lo. O código irá selecionar todos os registos da tabela com este NIF, permitindo ao utilizador 
executar uma selecção sem ter de conhecer a sintaxe de selecção do QGIS, nem qual o campo a usar… passa a ser uma ferramenta rápida e de uso imediato:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/5_acao1_selecionarNIFcomoeste_interface.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/5_acao1_selecionarNIFcomoeste_interface.png" width="500"  alt="Acção para selecionar todos os atributos com um determinado NIF a partir da tabela de atributos">
    </a>
</div>

<p>E ao clicar na opção, vamos ver todos os registos com o mesmo NIF serem selecionados:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/6_acao1_selecionarNIFcomoeste_interface2.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/6_acao1_selecionarNIFcomoeste_interface2.png" width="500"  alt="Resultado da acção para selecção de registos com um mesmo NIF">
    </a>
</div>

<p>Então, o que mais poderemos fazer para ajudar a consultar a informação? Adicionámos as seguintes acções:</p>
<ul>
    <li>&#8220;&#8221;Mostra Prédios” - seleciona no tema de cadastro todos os prédios correspondentes à selecção na tabela de proprietários (note-se que nesta tabela estão listados todos os prédios detidos por todos os proprietários);</li>
    <li>“Seleciona Nomes como este” - seleciona todos os registos na tabela com o mesmo nome do registo onde se clicou;</li>
    <li>“Pesquisa NIF” - permitir que o utilizador introduza um NIF para pesquisar na tabela. Pode depois usar a opção para mostrar os prédios correspondentes no mapa;</li>
    <li>“Pesquisa Nome” - permitir que o utilizador introduza um nome para pesquisar na tabela. Pode depois também ver os prédios correspondentes no mapa; </li>
</ul>

<p>O resultado de ter estas acções definidas, é que ao clicar na tabela com o botão direito surge-nos este menu:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/7_acoes__interface_menu.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/7_acoes__interface_menu.png" width="500"  alt="Várias acções no menu de contexto na tabela de atributos">
    </a>
</div>

<p>Uma utilização típica seria pesquisar por nome e ver os prédios no mapa. O código da pesquisa por nome foi feito de forma a pesquisar todos os nomes que incluam o texto 
introduzido pelo utilizador. Assim, um exemplo de utilização seria começar pela pesquisa de todos os prédios cujo proprietário tem no nome o texto “maria de fátima”:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/8_acao_pesquisanome_1.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/8_acao_pesquisanome_1.png" width="500"  alt="Acção de selecção de prédios a partir do nome do proprietário">
    </a>
</div>

<p>Obtendo-se 57 registos. E depois bastará selecionar a opção “Mostra Prédios” para ver esses prédios no mapa:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/9_acao_pesquisanome_2.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/9_acao_pesquisanome_2.png" width="500"  alt="Resultado da execução da acção de selecção de prédios pelo nome do proprietário">
    </a>
</div>

<h3>Como comunicar com o utilizador usando Acções Python</h3>
<p>Há alguns truques interessantes nestas acções, sobretudo de como interagir com o utilizador… Como mostrar uma janela com uma mensagem?
Podemos usar um widget do Qt, dos mais simples. E a nossa mensagem pode até ser construída com os campos da tabela. Por exemplo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Prédio&quot;</span><span class="p">,</span> <span class="s">&quot;O código do prédio é [% Codigo %]&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>Como mostrar uma janela para o utilizador introduzir um valor? Podemos usar directamente no código um widget de introdução de texto do Qt:</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">texto</span><span class="p">,</span><span class="n">ok</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Titulo da janela&quot;</span><span class="p">,</span> <span class="s">&quot;Introduza um valor: &quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>Este widget mostra uma janela com o título que indicamos e uma caixa para introdução de texto, com uma mensagem indicada por nós. Note-se que temos de testar se é clicado o botão OK ou o botão de Cancelar…</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">texto</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">False</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Colocar o código num Módulo Python</h3>
<p>Quando o código da acção começa a crescer, a janela de definição da acção torna-se improductiva, e seria preferível usar o nosso editor favorito de Python. É possível criar um 
ficheiro de Python com todo o código das nossas acções e usá-lo depois no QGIS - em vez de usar todo o código na definição da acção, basta carregar o nosso módulo e invocar uma das 
suas funções:</p>

<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/11_acoes_modulo_exemplo1.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/11_acoes_modulo_exemplo1.png" width="500"  alt="Importação de acções programadas num ficheiro externo">
    </a>
</div>

<p>Como se pode ver, o código ficou muito simples:</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">acoes</span><span class="p">;</span> <span class="n">acoes</span><span class="o">.</span><span class="n">selecNomePredio</span><span class="p">(</span><span class="err">‘</span><span class="p">[</span><span class="o">%</span> <span class="err">“</span><span class="n">Nome</span><span class="err">”</span> <span class="o">%</span><span class="p">]</span><span class="err">’</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>Todo o código foi colocado num ficheiro guardado na mesma pasta do nosso projecto. Neste exemplo, o ficheiro chama-se “acoes.py”. Este ficheiro não tem nada de especial, 
apenas contém funções Python normais, que podemos invocar a partir do QGIS. Apenas temos de importar alguns módulos do QGIS, e se necessário do próprio Qt para podermos usar os 
seus widgets:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">qgis.utils</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>
</span></code></pre></td></tr></table></div></figure>

<p>Por outro lado, para garantir que não temos problemas com os caracteres portugueses, será melhor assegurar que o módulo é executado usando a codificação utf-8. Em Windows 
isto não acontece normalmente, e por isso temos de forçar o uso de utf-8 com o seguinte código logo no topo do ficheiro:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># -*- coding: UTF-8 -*-</span>
</span><span class='line'><span class="c">#assegurar que não temos problemas com o encoding de strings</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
</span><span class='line'><span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>E é tudo. Obviamente que a solução mais evoluída é construir um plugin Python que permite usar as nossas funções independentemente do projecto que usamos, e centralizar a sua 
actualização. Mas para algo rápido e simples, as acções Python têm muito para oferecer.</p>

<p>Bom trabalho!</p>

<br />
<img class="gravatar img-circle" src="http://www.gravatar.com/avatar/ad2bd7f23b8cd33f2412acdc462b6a13></img>
]]></content>
  </entry>
  
</feed>
